<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê¸‰ ê¸°ëŠ¥ - AutoTrade Pro v4.0</title>

    <!-- TradingView Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

    <!-- FullCalendar -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>

    <!-- Sortable (Drag & Drop) -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f5f5f7;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .panel {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .panel.active {
            display: block;
        }

        /* TradingView ì°¨íŠ¸ */
        #chart-container {
            width: 100%;
            height: 500px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* ì „ëµ ë¹Œë” */
        .strategy-builder {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            gap: 20px;
            min-height: 600px;
        }

        .block-palette {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .block {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: move;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .block:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .block-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .block-desc {
            font-size: 12px;
            color: #666;
        }

        .canvas {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #ccc;
            min-height: 400px;
        }

        .properties-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        /* ìº˜ë¦°ë” */
        #calendar {
            max-width: 100%;
        }

        .calendar-event {
            padding: 5px;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
        }

        .event-buy {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .event-sell {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        /* ë¦¬í”Œë ˆì´ ì»¨íŠ¸ë¡¤ */
        .replay-controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        input[type="range"] {
            flex: 1;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ê³ ê¸‰ ê¸°ëŠ¥</h1>
            <p>TradingView ì°¨íŠ¸, ì „ëµ ë¹Œë”, ìº˜ë¦°ë” ì¼ì§€, ë¦¬í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('chart')">ğŸ“ˆ ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸</div>
            <div class="tab" onclick="switchTab('builder')">ğŸ”§ ì „ëµ ë¹Œë”</div>
            <div class="tab" onclick="switchTab('calendar')">ğŸ“… ë§¤ë§¤ ì¼ì§€</div>
            <div class="tab" onclick="switchTab('replay')">â¯ï¸ ë¦¬í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</div>
        </div>

        <!-- ì°¨íŠ¸ íŒ¨ë„ -->
        <div id="panel-chart" class="panel active">
            <h2>TradingView Lightweight Charts</h2>
            <div id="chart-container"></div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="loadChart('005930')">ì‚¼ì„±ì „ì</button>
                <button class="btn btn-primary" onclick="loadChart('000660')">SKí•˜ì´ë‹‰ìŠ¤</button>
                <button class="btn btn-primary" onclick="loadChart('035720')">ì¹´ì¹´ì˜¤</button>
                <button class="btn btn-success" onclick="addIndicator('MA')">ì´ë™í‰ê·  ì¶”ê°€</button>
                <button class="btn btn-success" onclick="addIndicator('RSI')">RSI ì¶”ê°€</button>
            </div>
        </div>

        <!-- ì „ëµ ë¹Œë” íŒ¨ë„ -->
        <div id="panel-builder" class="panel">
            <h2>ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì „ëµ ë¹Œë”</h2>
            <div class="strategy-builder">
                <div class="block-palette">
                    <h3>ë¸”ë¡ íŒ”ë ˆíŠ¸</h3>
                    <div id="indicator-blocks">
                        <div class="block" draggable="true" data-type="indicator">
                            <div class="block-title">ğŸ“Š ì´ë™í‰ê· ì„ </div>
                            <div class="block-desc">MA(20)</div>
                        </div>
                        <div class="block" draggable="true" data-type="indicator">
                            <div class="block-title">ğŸ“ˆ RSI</div>
                            <div class="block-desc">RSI(14)</div>
                        </div>
                        <div class="block" draggable="true" data-type="condition">
                            <div class="block-title">ğŸ” ì¡°ê±´: ì´ìƒ</div>
                            <div class="block-desc">A > B</div>
                        </div>
                        <div class="block" draggable="true" data-type="condition">
                            <div class="block-title">ğŸ” ì¡°ê±´: ì´í•˜</div>
                            <div class="block-desc">A < B</div>
                        </div>
                        <div class="block" draggable="true" data-type="action">
                            <div class="block-title">âœ… ë§¤ìˆ˜</div>
                            <div class="block-desc">BUY</div>
                        </div>
                        <div class="block" draggable="true" data-type="action">
                            <div class="block-title">âŒ ë§¤ë„</div>
                            <div class="block-desc">SELL</div>
                        </div>
                    </div>
                </div>

                <div class="canvas" id="strategy-canvas">
                    <p style="text-align: center; color: #999; padding: 50px;">
                        ì™¼ìª½ì—ì„œ ë¸”ë¡ì„ ë“œë˜ê·¸í•˜ì—¬ ì „ëµì„ ë§Œë“œì„¸ìš”
                    </p>
                </div>

                <div class="properties-panel">
                    <h3>ë¸”ë¡ ì†ì„±</h3>
                    <p id="properties-content">ë¸”ë¡ì„ ì„ íƒí•˜ì„¸ìš”</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveStrategy()">ğŸ’¾ ì „ëµ ì €ì¥</button>
                        <button class="btn btn-success" onclick="testStrategy()">â–¶ï¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                        <button class="btn btn-danger" onclick="clearCanvas()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìº˜ë¦°ë” íŒ¨ë„ -->
        <div id="panel-calendar" class="panel">
            <h2>ë§¤ë§¤ ì¼ì§€ ìº˜ë¦°ë”</h2>
            <div id="calendar"></div>
        </div>

        <!-- ë¦¬í”Œë ˆì´ íŒ¨ë„ -->
        <div id="panel-replay" class="panel">
            <h2>ê³¼ê±° ë°ì´í„° ë¦¬í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜</h2>

            <div class="replay-controls">
                <button class="btn btn-primary" onclick="replayPlay()">â–¶ï¸ ì¬ìƒ</button>
                <button class="btn btn-danger" onclick="replayPause()">â¸ï¸ ì¼ì‹œì •ì§€</button>
                <button class="btn btn-primary" onclick="replayStop()">â¹ï¸ ì •ì§€</button>
                <label>ì†ë„:</label>
                <input type="range" id="replay-speed" min="1" max="100" value="10" onchange="updateSpeed(this.value)">
                <span id="speed-display">10x</span>
            </div>

            <div id="replay-chart-container" style="width: 100%; height: 400px; background: white; border-radius: 8px;">
                <p style="padding: 50px; text-align: center; color: #999;">ë¦¬í”Œë ˆì´ë¥¼ ì‹œì‘í•˜ì„¸ìš”</p>
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        let calendar = null;

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('panel-' + tabName).classList.add('active');

            // ìº˜ë¦°ë” íƒ­ í™œì„±í™” ì‹œ ì´ˆê¸°í™”
            if (tabName === 'calendar' && !calendar) {
                initCalendar();
            }
        }

        // TradingView ì°¨íŠ¸ ì´ˆê¸°í™”
        function initChart() {
            const container = document.getElementById('chart-container');
            chart = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 500,
                layout: {
                    background: { color: '#ffffff' },
                    textColor: '#333',
                },
                grid: {
                    vertLines: { color: '#f0f0f0' },
                    horzLines: { color: '#f0f0f0' },
                },
            });

            loadChart('005930');
        }

        // ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ
        function loadChart(stockCode) {
            if (!chart) return;

            // ìƒ˜í”Œ ë°ì´í„° ìƒì„±
            const data = [];
            let basePrice = 70000;
            let baseTime = new Date('2024-01-01').getTime() / 1000;

            for (let i = 0; i < 100; i++) {
                basePrice += (Math.random() - 0.5) * 1000;
                data.push({
                    time: baseTime + i * 86400,
                    open: basePrice,
                    high: basePrice + Math.random() * 2000,
                    low: basePrice - Math.random() * 2000,
                    close: basePrice + (Math.random() - 0.5) * 1000
                });
            }

            const candlestickSeries = chart.addCandlestickSeries();
            candlestickSeries.setData(data);
        }

        // ì§€í‘œ ì¶”ê°€
        function addIndicator(type) {
            alert(type + ' ì§€í‘œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ìº˜ë¦°ë” ì´ˆê¸°í™”
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: [
                    {
                        title: 'ë§¤ìˆ˜: ì‚¼ì„±ì „ì 10ì£¼',
                        start: '2024-11-01',
                        className: 'event-buy'
                    },
                    {
                        title: 'ë§¤ë„: SKí•˜ì´ë‹‰ìŠ¤ 5ì£¼',
                        start: '2024-11-05',
                        className: 'event-sell'
                    }
                ],
                eventClick: function(info) {
                    alert('ì´ë²¤íŠ¸: ' + info.event.title);
                }
            });
            calendar.render();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        function setupDragAndDrop() {
            const canvas = document.getElementById('strategy-canvas');

            document.querySelectorAll('.block').forEach(block => {
                block.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('text/html', e.target.outerHTML);
                });
            });

            canvas.addEventListener('dragover', e => {
                e.preventDefault();
            });

            canvas.addEventListener('drop', e => {
                e.preventDefault();
                const data = e.dataTransfer.getData('text/html');
                const div = document.createElement('div');
                div.innerHTML = data;
                canvas.appendChild(div.firstChild);
            });
        }

        // ì „ëµ ì €ì¥
        function saveStrategy() {
            alert('ì „ëµì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì „ëµ í…ŒìŠ¤íŠ¸
        function testStrategy() {
            alert('ë°±í…ŒìŠ¤íŒ…ì„ ì‹œì‘í•©ë‹ˆë‹¤...');
        }

        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        function clearCanvas() {
            document.getElementById('strategy-canvas').innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">ì™¼ìª½ì—ì„œ ë¸”ë¡ì„ ë“œë˜ê·¸í•˜ì—¬ ì „ëµì„ ë§Œë“œì„¸ìš”</p>';
        }

        // ë¦¬í”Œë ˆì´ ì»¨íŠ¸ë¡¤
        function replayPlay() {
            alert('ë¦¬í”Œë ˆì´ ì‹œì‘!');
        }

        function replayPause() {
            alert('ì¼ì‹œì •ì§€');
        }

        function replayStop() {
            alert('ì •ì§€');
        }

        function updateSpeed(value) {
            document.getElementById('speed-display').textContent = value + 'x';
        }

        // í˜ì´ì§€ ë¡œë“œ
        window.addEventListener('DOMContentLoaded', () => {
            initChart();
            setupDragAndDrop();
        });

        // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ
        window.addEventListener('resize', () => {
            if (chart) {
                chart.resize(
                    document.getElementById('chart-container').clientWidth,
                    500
                );
            }
        });
    </script>
</body>
</html>
