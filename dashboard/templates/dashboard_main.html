<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoTrade Pro v6.1 - AI ÏûêÎèôÎß§Îß§</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CountUp.js - Ïà´Ïûê Ïï†ÎãàÎ©îÏù¥ÏÖò -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/countup.js/2.8.0/countUp.umd.min.js"></script>

    <!-- AOS - Scroll Animations -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Toastify - Toast Notifications -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- ApexCharts - Modern Charts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- Advanced Chart CSS -->
    <link rel="stylesheet" href="/static/css/advanced-chart.css">

    <style>
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #151932;
            --bg-card: #1e2139;
            --border-color: #2d3250;

            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;

            --color-primary: #3b82f6;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #06b6d4;

            --chart-up: #10b981;
            --chart-down: #ef4444;
        }

        /* Light Mode */
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --border-color: #e2e8f0;

            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Smooth transitions for theme switch */
        .card, .header, .sidebar, .right-panel, .account-card {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        /* Pulse animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Fade in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Skeleton loading */
        @keyframes skeleton-loading {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                var(--bg-secondary) 0px,
                var(--bg-card) 40px,
                var(--bg-secondary) 80px
            );
            background-size: 200px 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 4px;
        }

        /* Layout - NO SCROLL */
        .layout {
            display: grid;
            grid-template-columns: 260px 1fr 450px; /* Increased right panel from 320px to 450px */
            grid-template-rows: 60px 1fr;
            height: 100vh;
            width: 100vw;
            gap: 0;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 700;
        }

        .logo i {
            color: var(--color-primary);
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-badge.live {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
        }

        .settings-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: all 0.2s;
        }

        .settings-btn:hover {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 15px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 10px;
            margin-top: 15px;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        .account-card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
        }

        .account-value {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .account-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .account-row {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            margin-bottom: 6px;
        }

        .stat-list {
            list-style: none;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 10px;
            background: var(--bg-card);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .stat-value {
            font-weight: 600;
            color: var(--color-primary);
        }

        /* Connection Status */
        .connection-status {
            font-size: 11px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .connection-status i {
            font-size: 8px;
        }

        .connection-status.connected i {
            color: var(--color-success);
            animation: none;
        }

        .connection-status.disconnected i {
            color: var(--color-danger);
        }

        .connection-status.checking i {
            color: var(--color-warning);
            animation: pulse-dot 1.5s ease-in-out infinite;
        }

        .connection-status.active i {
            color: var(--color-info);
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            background: var(--bg-secondary);
            padding: 10px 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            font-weight: 500;
            background: transparent;
            color: var(--text-secondary);
            border: none;
        }

        .tab:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--color-primary);
            color: white;
        }

        /* Tab Content */
        .tab-content {
            flex: 1;
            padding: 12px;
            overflow-y: auto;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 10px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title i {
            color: var(--color-primary);
        }

        /* Chart Container */
        #main-chart {
            height: 350px; /* Reduced from 400px to 350px for better space distribution */
            margin-bottom: 10px;
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        /* AI Analysis Cards */
        .ai-result-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid var(--border-color);
        }

        .ai-result-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .ai-result-value {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .ai-result-desc {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Right Panel */
        .right-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .right-panel-section {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--color-primary);
        }

        .compact-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }

        .compact-card .loading {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
            font-size: 12px;
        }

        .candidate-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .candidate-item:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .candidate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .candidate-name {
            font-weight: 600;
            font-size: 13px;
        }

        .candidate-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .candidate-info {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .candidate-signals {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .signal-badge {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }

        .signal-badge.buy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
        }

        /* Trading Activity */
        .activity-item {
            padding: 8px;
            border-left: 3px solid var(--color-primary);
            background: rgba(59, 130, 246, 0.05);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .activity-time {
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .activity-text {
            font-size: 12px;
        }

        .activity-item.buy {
            border-left-color: var(--color-success);
            background: rgba(16, 185, 129, 0.05);
        }

        .activity-item.sell {
            border-left-color: var(--color-danger);
            background: rgba(239, 68, 68, 0.05);
        }

        /* Performance Metrics */
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 12px;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: var(--text-secondary);
        }

        .metric-value {
            font-weight: 600;
        }

        .metric-value.positive {
            color: var(--color-success);
        }

        .metric-value.negative {
            color: var(--color-danger);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: slideIn 0.3s;
            font-size: 13px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Real-time indicator */
        .realtime-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-success);
            animation: pulse-dot 2s infinite;
            display: inline-block;
            margin-right: 4px;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ========================================
           v5.7.7: Í≥†Í∏â Í∑∏ÎùºÎîîÏñ∏Ìä∏ Î∞è Ïï†ÎãàÎ©îÏù¥ÏÖò Ìö®Í≥º
           ======================================== */

        /* Shimmer Î∞òÏßùÏûÑ Ìö®Í≥º */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .shimmer {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.1) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Í∑∏ÎùºÎîîÏñ∏Ìä∏ Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú hover Ìö®Í≥º */
        .gradient-hover {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .gradient-hover::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(59, 130, 246, 0.1),
                transparent
            );
            transition: left 0.5s ease;
        }

        .gradient-hover:hover::before {
            left: 100%;
        }

        .gradient-hover:hover {
            transform: translateX(4px);
            background: linear-gradient(90deg,
                var(--bg-card) 0%,
                rgba(59, 130, 246, 0.05) 100%
            );
        }

        /* ÏõêÌòï AI Ï†êÏàò Í≤åÏù¥ÏßÄ */
        .ai-score-gauge {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(
                var(--gauge-color, #3b82f6) var(--gauge-percentage, 0%),
                var(--bg-secondary) var(--gauge-percentage, 0%)
            );
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-score-gauge::before {
            content: '';
            width: 46px;
            height: 46px;
            border-radius: 50%;
            background: var(--bg-card);
        }

        .ai-score-gauge-value {
            position: absolute;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Í∑∏ÎùºÎîîÏñ∏Ìä∏ ÌîÑÎ°úÍ∑∏Î†àÏä§ Î∞î */
        .gradient-progress {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .gradient-progress-bar {
            height: 100%;
            background: linear-gradient(90deg,
                #3b82f6 0%,
                #8b5cf6 50%,
                #ec4899 100%
            );
            border-radius: 10px;
            transition: width 0.6s ease;
            position: relative;
            overflow: hidden;
        }

        .gradient-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: progress-shimmer 1.5s infinite;
        }

        @keyframes progress-shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ÌéÑÏä§ Í∏ÄÎ°úÏö∞ Ìö®Í≥º (ÏúÑÌóò ÏïåÎ¶º) */
        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(239, 68, 68, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.8),
                            0 0 30px rgba(239, 68, 68, 0.6);
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }

        /* Îß§Ïàò ÌÉÄÏù¥Î∞ç Ïã†Ìò∏Îì± */
        .timing-signal {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }

        .timing-signal.buy {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.8);
            animation: pulse-buy 1.5s infinite;
        }

        .timing-signal.wait {
            background: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.6);
        }

        .timing-signal.sell {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            animation: pulse-sell 1.5s infinite;
        }

        @keyframes pulse-buy {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        @keyframes pulse-sell {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
        }

        /* Ï∞®Ìä∏ Í∑∏ÎùºÎîîÏñ∏Ìä∏ Î∞∞Í≤Ω */
        .chart-gradient-bg {
            background: linear-gradient(135deg,
                rgba(59, 130, 246, 0.05) 0%,
                rgba(139, 92, 246, 0.05) 50%,
                rgba(236, 72, 153, 0.05) 100%
            );
        }

        /* Î¶¨Ïä§Ìä∏ ÏïÑÏù¥ÌÖú Í∑∏ÎùºÎîîÏñ∏Ìä∏ Í≤ΩÍ≥ÑÏÑ† */
        .gradient-border {
            position: relative;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        .gradient-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: inherit;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gradient-border:hover::before {
            opacity: 1;
        }

        /* Ìã± ÏóÖ/Îã§Ïö¥ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes tick-up {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        @keyframes tick-down {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(4px); }
        }

        .tick-up {
            animation: tick-up 0.5s ease;
            color: #ef4444 !important;
        }

        .tick-down {
            animation: tick-down 0.5s ease;
            color: #3b82f6 !important;
        }

        /* AI ÏΩîÎ©òÌÑ∞Î¶¨ Ïπ¥Îìú */
        .ai-commentary {
            background: linear-gradient(135deg,
                rgba(139, 92, 246, 0.1) 0%,
                rgba(59, 130, 246, 0.1) 100%
            );
            border-left: 4px solid #8b5cf6;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .ai-commentary::before {
            content: 'ü§ñ';
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 24px;
            opacity: 0.3;
        }

        /* ÏùåÏÑ± ÏïåÎ¶º ÌëúÏãú */
        @keyframes voice-wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }

        .voice-indicator {
            display: inline-flex;
            gap: 2px;
            align-items: center;
            margin-left: 8px;
        }

        .voice-indicator span {
            width: 3px;
            height: 12px;
            background: var(--color-primary);
            border-radius: 2px;
            animation: voice-wave 0.6s ease-in-out infinite;
        }

        .voice-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .voice-indicator span:nth-child(3) { animation-delay: 0.4s; }

        /* ÎèÑÎÑõ Ï∞®Ìä∏ (Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÇ∞) */
        .donut-chart {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
        }

        .donut-chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <span>AutoTrade Pro v6.1</span>
                <span style="font-size: 9px; padding: 2px 6px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 4px; font-weight: 600; margin-left: 6px; animation: pulse 2s infinite;">v6.1</span>
                <span style="font-size: 11px; color: var(--text-muted); font-weight: 400;">AI ÏûêÎèôÎß§Îß§</span>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <!-- Manual Refresh Control -->
                <div style="display: flex; align-items: center; gap: 8px; padding: 6px 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <button onclick="loadAllData()" style="padding: 4px 10px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px;" title="ÏàòÎèô ÏÉàÎ°úÍ≥†Ïπ®">
                        <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                    </button>
                    <label style="display: flex; align-items: center; gap: 5px; font-size: 12px; cursor: pointer; margin: 0;" title="ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏºúÍ∏∞/ÎÅÑÍ∏∞">
                        <input type="checkbox" id="global-auto-refresh" style="cursor: pointer;">
                        <span style="color: var(--text-secondary);">ÏûêÎèô</span>
                    </label>
                    <select id="refresh-interval" style="padding: 4px 8px; background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 4px; font-size: 11px; cursor: pointer;" title="ÏÉàÎ°úÍ≥†Ïπ® Í∞ÑÍ≤©">
                        <option value="3000">3Ï¥à</option>
                        <option value="5000">5Ï¥à</option>
                        <option value="10000" selected>10Ï¥à</option>
                        <option value="30000">30Ï¥à</option>
                        <option value="60000">60Ï¥à</option>
                    </select>
                </div>
                <a href="/settings" target="_blank" class="settings-btn" title="ÏÑ§Ï†ï">
                    <i class="fas fa-cog"></i>
                </a>
                <!-- v6.1: Notification Center Button -->
                <button id="notification-btn" class="settings-btn" title="ÏïåÎ¶º ÏÑºÌÑ∞" onclick="toggleNotifications()" style="cursor: pointer; position: relative;">
                    <i class="fas fa-bell"></i>
                    <span id="notification-badge" style="display: none; position: absolute; top: 2px; right: 2px; background: #ef4444; color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 9px; font-weight: 700; display: flex; align-items: center; justify-content: center;">0</span>
                </button>
                <button id="theme-toggle" class="settings-btn" title="Îã§ÌÅ¨Î™®Îìú/ÎùºÏù¥Ìä∏Î™®Îìú" onclick="toggleTheme()" style="cursor: pointer;">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <div class="status-badge live" id="status-indicator">
                    <span class="realtime-indicator"></span>
                    <span id="status-text">AI ÏûêÎèôÎß§Îß§ Ïã§Ìñâ Ï§ë</span>
                </div>
            </div>
        </header>

        <!-- v6.1: Notification Panel (Slide from right) -->
        <div id="notification-panel" style="position: fixed; top: 0; right: -400px; width: 400px; height: 100vh; background: var(--bg-card); box-shadow: -4px 0 12px rgba(0,0,0,0.3); z-index: 10000; transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow-y: auto;">
            <div style="padding: 20px; border-bottom: 1px solid var(--border-color); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0; font-size: 18px; font-weight: 700;">ÏïåÎ¶º ÏÑºÌÑ∞</h3>
                        <p style="margin: 5px 0 0 0; font-size: 11px; opacity: 0.9;">Ïã§ÏãúÍ∞Ñ Îß§Îß§ Í∏∞Ìöå & AI Í≤ΩÍ≥†</p>
                    </div>
                    <button onclick="toggleNotifications()" style="background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="notification-list" style="padding: 15px;">
                <div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                    <i class="fas fa-bell-slash" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
                    <p>ÏÉàÎ°úÏö¥ ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</p>
                </div>
            </div>
        </div>

        <!-- v6.1: Notification Overlay (Click to close) -->
        <div id="notification-overlay" onclick="toggleNotifications()" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;"></div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="section-title">Í≥ÑÏ¢å Ï†ïÎ≥¥</div>
            <div class="account-card">
                <div class="account-value" id="total-assets">‚Ç©0</div>
                <div class="account-label">Ï¥ù ÏûêÏÇ∞</div>

                <div class="account-row">
                    <span>Î≥¥Ïú† ÌòÑÍ∏à</span>
                    <span id="cash">‚Ç©0</span>
                </div>
                <div class="account-row">
                    <span>Ï£ºÏãù ÌèâÍ∞ÄÏï°</span>
                    <span id="stock-value">‚Ç©0</span>
                </div>
                <div class="account-row">
                    <span>ÏÜêÏùµ</span>
                    <span id="profit-loss" style="color: var(--color-success);">+‚Ç©0</span>
                </div>
                <div class="account-row" style="padding-top: 8px;">
                    <span style="font-size: 11px; color: var(--text-muted);">ÏàòÏùµÎ•†</span>
                    <span id="profit-loss-percent" style="font-size: 13px; font-weight: 600;">0%</span>
                </div>

                <!-- v6.1: Compact 12 Strategy Status -->
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 10px; color: var(--text-muted);">Í∞ÄÏÉÅÎß§Îß§ Ï†ÑÎûµ</span>
                        <span style="font-size: 10px; color: var(--color-success); font-weight: 600;">12/12 ‚úì</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px;">
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Î™®Î©òÌÖÄÏ∂îÏÑ∏">Î™®Î©òÌÖÄ</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="ÌèâÍ∑†ÌöåÍ∑Ä">ÌèâÍ∑†</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="ÎèåÌååÎß§Îß§">ÎèåÌåå</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Í∞ÄÏπòÌà¨Ïûê">Í∞ÄÏπò</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Ïä§ÏúôÎß§Îß§">Ïä§Ïúô</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="MACDÌÅ¨Î°úÏä§">MACD</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Ïó≠Î∞úÏÉÅ">Ïó≠Î∞úÏÉÅ</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="ÏÑπÌÑ∞ÏàúÌôò">ÏÑπÌÑ∞</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Í∏âÎì±Ï∂îÍ≤©">Í∏âÎì±</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Î∞∞ÎãπÏÑ±Ïû•">Î∞∞Îãπ</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Í∏∞Í¥ÄÏ∂îÏ¢Ö">Í∏∞Í¥Ä</div>
                        <div style="font-size: 8px; padding: 4px; background: rgba(16,185,129,0.1); border-radius: 3px; text-align: center; color: var(--color-success);" title="Í±∞ÎûòÎüâRSI">Í±∞ÎûòÎüâ</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section-title" style="margin-top: 20px;">
                <i class="fas fa-bolt"></i> Îπ†Î•∏ Ïï°ÏÖò <kbd style="font-size: 9px; padding: 2px 4px; background: rgba(59,130,246,0.2); border-radius: 3px; margin-left: 5px;">Îã®Ï∂ïÌÇ§</kbd>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px;">
                <button onclick="emergencyStopAll()" style="padding: 10px; background: var(--color-danger); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px;" title="Í∏¥Í∏â Ï†ÑÏ≤¥ Ï†ïÏßÄ (Ctrl+Shift+Q)">
                    <i class="fas fa-stop-circle"></i> Í∏¥Í∏âÏ†ïÏßÄ
                </button>
                <button onclick="sellAllPositions()" style="padding: 10px; background: var(--color-warning); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px;" title="Î™®Îì† Ìè¨ÏßÄÏÖò Îß§ÎèÑ (Ctrl+Shift+S)">
                    <i class="fas fa-hand-paper"></i> Ï†ÑÏ≤¥Îß§ÎèÑ
                </button>
                <button onclick="pauseTrading()" style="padding: 10px; background: rgba(59, 130, 246, 0.8); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px;" title="Îß§Îß§ ÏùºÏãúÏ†ïÏßÄ (Ctrl+Shift+P)">
                    <i class="fas fa-pause"></i> ÏùºÏãúÏ†ïÏßÄ
                </button>
                <button onclick="loadAllData()" style="padding: 10px; background: var(--color-success); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px;" title="Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ® (F5)">
                    <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                </button>
            </div>

            <!-- v6.1: Real-time Progress Indicators -->
            <div class="section-title" style="margin-top: 20px;">
                <i class="fas fa-tasks"></i> Ïã§ÏãúÍ∞Ñ ÏßÑÌñâ ÏÉÅÌô© <span style="font-size: 9px; padding: 2px 6px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 4px; font-weight: 600; margin-left: 5px; animation: pulse 2s infinite;">v6.1</span>
            </div>
            <div id="realtime-progress-panel" style="margin-bottom: 20px; padding: 12px; background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); border-radius: 8px; border: 1px solid rgba(102,126,234,0.3);">
                <!-- AI Analysis Progress -->
                <div style="margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="font-size: 11px; color: var(--text-secondary); display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-brain"></i> AI Î∂ÑÏÑù
                        </span>
                        <span id="ai-progress-text" style="font-size: 10px; color: var(--color-primary); font-weight: 600;">ÎåÄÍ∏∞Ï§ë</span>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden;">
                        <div id="ai-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s ease;"></div>
                    </div>
                </div>
                <!-- Scan Progress -->
                <div style="margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="font-size: 11px; color: var(--text-secondary); display: flex; align-items: center; gap: 5px;">
                            <i class="fas fa-search"></i> Ï¢ÖÎ™© Ïä§Ï∫î
                        </span>
                        <span id="scan-progress-text" style="font-size: 10px; color: var(--color-success); font-weight: 600;">0/0</span>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden;">
                        <div id="scan-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #10b981 0%, #059669 100%); transition: width 0.3s ease;"></div>
                    </div>
                </div>
                <!-- Last Activity -->
                <div style="font-size: 10px; color: var(--text-muted); padding: 8px; background: rgba(0,0,0,0.05); border-radius: 4px; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-clock"></i>
                    <span>ÏµúÍ∑º ÌôúÎèô:</span>
                    <span id="last-activity-text" style="font-weight: 600; color: var(--text-secondary);">-</span>
                </div>
            </div>

            <!-- v5.7.2: ÏàòÏùµ ÏµúÏ†ÅÌôî Ìå®ÎÑê -->
            <div class="section-title" style="margin-top: 20px;">
                <i class="fas fa-chart-line"></i> ÏàòÏùµ ÏµúÏ†ÅÌôî <span style="font-size: 10px; color: var(--color-success); margin-left: 5px;">NEW</span>
            </div>
            <div id="profit-optimization-panel" style="margin-bottom: 20px; padding: 12px; background: linear-gradient(135deg, rgba(16,185,129,0.1) 0%, rgba(59,130,246,0.1) 100%); border-radius: 8px; border: 1px solid rgba(16,185,129,0.3);">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">Îß§ÎèÑ Í∂åÏû•</div>
                        <div id="opt-sell-count" style="font-size: 16px; font-weight: 700; color: var(--color-danger);">0</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">Î∂ÄÎ∂Ñ ÏùµÏ†à</div>
                        <div id="opt-partial-count" style="font-size: 16px; font-weight: 700; color: var(--color-warning);">0</div>
                    </div>
                    <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px;">
                        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">Î≥¥Ïú† Ïú†ÏßÄ</div>
                        <div id="opt-hold-count" style="font-size: 16px; font-weight: 700; color: var(--color-success);">0</div>
                    </div>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); padding: 8px; background: rgba(0,0,0,0.1); border-radius: 6px;">
                    <div style="margin-bottom: 3px;"><strong>ÌòÑÏû¨ Í∑úÏπô:</strong> Í∑†Ìòï (ÏÜêÏ†à -6%, ÏùµÏ†à +12%)</div>
                    <div style="font-size: 10px; opacity: 0.8;">Ìä∏Î†àÏùºÎßÅ Ïä§ÌÜ±: ÌôúÏÑ± (ÏµúÍ≥†Í∞Ä ÎåÄÎπÑ -4%)</div>
                </div>
            </div>

            <div class="section-title">
                <i class="fas fa-broadcast-tower"></i> WebSocket Ïã§ÏãúÍ∞Ñ Íµ¨ÎèÖ
            </div>
            <div style="margin-bottom: 20px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="font-size: 12px; font-weight: 600;">Ï¥ù Íµ¨ÎèÖ</span>
                    <span id="ws-total-badge" style="padding: 2px 8px; background: var(--color-primary); border-radius: 12px; font-size: 11px; font-weight: 700;">0</span>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">
                    <strong style="color: var(--color-primary);">üìä ÌòÑÏû¨Í∞Ä (KA10003)</strong>
                    <div id="ws-price-list" style="margin-top: 4px; font-size: 10px;">ÏóÜÏùå</div>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">
                    <strong style="color: var(--color-success);">üìà Ìò∏Í∞Ä (KA10004)</strong>
                    <div id="ws-orderbook-list" style="margin-top: 4px; font-size: 10px;">ÏóÜÏùå</div>
                </div>
                <div style="font-size: 11px; color: var(--text-secondary);">
                    <strong style="color: var(--color-warning);">‚ö° Ï≤¥Í≤∞ (KA10005)</strong>
                    <div id="ws-execution-list" style="margin-top: 4px; font-size: 10px;">ÏóÜÏùå</div>
                </div>
            </div>

            <div class="section-title">ÏãúÏä§ÌÖú Ïó∞Í≤∞ ÏÉÅÌÉú</div>
            <ul class="stat-list">
                <li class="stat-item">
                    <span class="stat-label">REST API</span>
                    <span class="connection-status" id="conn-rest-api">
                        <i class="fas fa-circle"></i> <span>ÌôïÏù∏Ï§ë</span>
                    </span>
                </li>
                <li class="stat-item">
                    <span class="stat-label">WebSocket</span>
                    <span class="connection-status" id="conn-websocket">
                        <i class="fas fa-circle"></i> <span>ÌôïÏù∏Ï§ë</span>
                    </span>
                </li>
                <li class="stat-item">
                    <span class="stat-label">Gemini AI</span>
                    <span class="connection-status" id="conn-gemini">
                        <i class="fas fa-circle"></i> <span>ÌôïÏù∏Ï§ë</span>
                    </span>
                </li>
                <li class="stat-item">
                    <span class="stat-label">ÌÖåÏä§Ìä∏ Î™®Îìú</span>
                    <span class="connection-status" id="conn-testmode">
                        <i class="fas fa-circle"></i> <span>ÌôïÏù∏Ï§ë</span>
                    </span>
                </li>
            </ul>
        </aside>

        <!-- Main Content with Tabs -->
        <main class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab(0)">
                    <i class="fas fa-home"></i> Î©îÏù∏
                </button>
                <button class="tab" onclick="switchTab(1)">
                    <i class="fas fa-robot"></i> AI Î∂ÑÏÑù
                </button>
                <button class="tab" onclick="switchTab(2)">
                    <i class="fas fa-coins"></i> Í∞ÄÏÉÅÎß§Îß§ ÏÑ±Í≥º
                </button>
                <button class="tab" onclick="switchTab(3)">
                    <i class="fas fa-search-dollar"></i> ÏãúÏû• ÌÉêÏÉâ
                </button>
                <button class="tab" onclick="switchTab(4)">
                    <i class="fas fa-chart-pie"></i> Ìè¨Ìä∏Ìè¥Î¶¨Ïò§
                </button>
            </div>

            <!-- Tab 1: Main Dashboard -->
            <div class="tab-content active" id="tab-main">
                <!-- Real-time Chart with Search -->
                <div class="card" data-aos="fade-up" data-aos-delay="100">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-candlestick"></i>
                            <span id="chart-stock-name">Ïã§ÏãúÍ∞Ñ Ï∞®Ìä∏</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <!-- Stock Search -->
                            <div style="position: relative;">
                                <input
                                    type="text"
                                    id="stock-search-input"
                                    placeholder="Ï¢ÖÎ™© Í≤ÄÏÉâ..."
                                    style="padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-size: 12px; width: 200px;"
                                    autocomplete="off"
                                />
                                <!-- Search Results Dropdown -->
                                <div id="stock-search-results" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 4px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 6px; width: 300px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.3);"></div>
                            </div>
                            <span style="font-size: 12px; color: var(--text-secondary);" id="chart-price">‚Ç©0</span>
                        </div>
                    </div>
                    <div id="main-chart" class="chart-gradient-bg"></div>
                </div>
            </div>

            <!-- Tab 2: AI Analysis - v5.7.5 ÏôÑÏ†Ñ Ïû¨Íµ¨Ï∂ï -->
            <div class="tab-content" id="tab-ai">
                <!-- Performance Summary Banner -->
                <div class="card" data-aos="fade-down" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; margin-bottom: 20px;">
                    <div style="padding: 20px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 12px;">
                            <i class="fas fa-chart-area"></i> Ïã§ÏãúÍ∞Ñ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÑ±Í≥º
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">Ï¥ù ÌèâÍ∞ÄÏï°</div>
                                <div style="font-size: 20px; font-weight: 700;" id="perf-total-value">‚Ç©0</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">Ï¥ù ÏÜêÏùµ</div>
                                <div style="font-size: 20px; font-weight: 700;" id="perf-total-profit">‚Ç©0</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">ÏàòÏùµÎ•†</div>
                                <div style="font-size: 20px; font-weight: 700;" id="perf-profit-pct">0%</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; opacity: 0.8; margin-bottom: 4px;">ÏäπÎ•†</div>
                                <div style="font-size: 20px; font-weight: 700;" id="perf-win-rate">0%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- v6.1: AI Confidence Gauge & Risk Heatmap -->
                <div class="grid-2" style="margin-bottom: 20px;">
                    <!-- AI Confidence Gauge -->
                    <div class="card" data-aos="zoom-in">
                        <div class="card-header" style="background: linear-gradient(90deg, #8b5cf6, #7c3aed); color: white;">
                            <div class="card-title">
                                <i class="fas fa-brain"></i> AI ÌôïÏã†ÎèÑ Í≤åÏù¥ÏßÄ
                            </div>
                        </div>
                        <div style="padding: 20px; display: flex; flex-direction: column; align-items: center;">
                            <svg width="200" height="200" viewBox="0 0 200 200" style="margin-bottom: 15px;">
                                <circle cx="100" cy="100" r="85" fill="none" stroke="rgba(139, 92, 246, 0.1)" stroke-width="15"></circle>
                                <circle cx="100" cy="100" r="85" fill="none" stroke="url(#gauge-gradient)" stroke-width="15"
                                    stroke-dasharray="534" stroke-dashoffset="160"
                                    stroke-linecap="round"
                                    id="confidence-gauge-circle"
                                    style="transform: rotate(-90deg); transform-origin: center; transition: stroke-dashoffset 1.5s ease;">
                                </circle>
                                <text x="100" y="95" text-anchor="middle" font-size="42" font-weight="700" fill="var(--text-primary)" id="confidence-value-text">87%</text>
                                <text x="100" y="115" text-anchor="middle" font-size="12" fill="var(--text-secondary)">ÌôïÏã†ÎèÑ</text>
                                <defs>
                                    <linearGradient id="gauge-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                            </svg>

                            <div style="width: 100%; margin-top: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 11px; color: var(--text-secondary);">
                                        <i class="fab fa-google"></i> Gemini
                                    </span>
                                    <span style="font-size: 11px; font-weight: 600;" id="gemini-confidence">92%</span>
                                </div>
                                <div style="width: 100%; height: 4px; background: rgba(139, 92, 246, 0.1); border-radius: 2px; overflow: hidden;">
                                    <div id="gemini-bar" style="width: 92%; height: 100%; background: linear-gradient(90deg, #8b5cf6, #a78bfa); transition: width 1s ease;"></div>
                                </div>
                            </div>

                            <div style="width: 100%; margin-top: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 11px; color: var(--text-secondary);">
                                        <i class="fas fa-robot"></i> Claude
                                    </span>
                                    <span style="font-size: 11px; font-weight: 600;" id="claude-confidence">85%</span>
                                </div>
                                <div style="width: 100%; height: 4px; background: rgba(59, 130, 246, 0.1); border-radius: 2px; overflow: hidden;">
                                    <div id="claude-bar" style="width: 85%; height: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa); transition: width 1s ease;"></div>
                                </div>
                            </div>

                            <div style="width: 100%; margin-top: 8px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-size: 11px; color: var(--text-secondary);">
                                        <i class="fas fa-brain"></i> GPT-4
                                    </span>
                                    <span style="font-size: 11px; font-weight: 600;" id="gpt4-confidence">84%</span>
                                </div>
                                <div style="width: 100%; height: 4px; background: rgba(16, 185, 129, 0.1); border-radius: 2px; overflow: hidden;">
                                    <div id="gpt4-bar" style="width: 84%; height: 100%; background: linear-gradient(90deg, #10b981, #34d399); transition: width 1s ease;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Heatmap -->
                    <div class="card" data-aos="zoom-in" data-aos-delay="100">
                        <div class="card-header" style="background: linear-gradient(90deg, #ef4444, #dc2626); color: white;">
                            <div class="card-title">
                                <i class="fas fa-fire"></i> Î¶¨Ïä§ÌÅ¨ ÌûàÌä∏Îßµ
                            </div>
                        </div>
                        <div style="padding: 20px;">
                            <div id="risk-heatmap-grid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px;">
                                <!-- Will be populated by JavaScript -->
                            </div>
                            <div style="display: flex; justify-content: center; gap: 15px; margin-top: 15px; font-size: 10px;">
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div style="width: 12px; height: 12px; background: var(--color-success); border-radius: 3px;"></div>
                                    <span style="color: var(--text-secondary);">ÎÇÆÏùå (0-30%)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div style="width: 12px; height: 12px; background: var(--color-warning); border-radius: 3px;"></div>
                                    <span style="color: var(--text-secondary);">Ï§ëÍ∞Ñ (31-50%)</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 4px;">
                                    <div style="width: 12px; height: 12px; background: var(--color-danger); border-radius: 3px;"></div>
                                    <span style="color: var(--text-secondary);">ÎÜíÏùå (51%+)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Alerts -->
                <div id="ai-alerts-container" style="display: none; margin-bottom: 20px;">
                    <div class="card" style="background: #fff1f2; border-left: 4px solid #ef4444; border-radius: 8px;">
                        <div style="padding: 15px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #ef4444; font-size: 13px;">
                                <i class="fas fa-exclamation-triangle"></i> Í∏¥Í∏â ÏïåÎ¶º
                            </div>
                            <div id="ai-alerts" style="font-size: 12px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Alerts -->
                <div class="card" id="ai-alerts-section" data-aos="zoom-in" data-aos-delay="200" style="display: none; margin-bottom: 20px;">
                    <div class="card-header" style="background: linear-gradient(90deg, #ef4444, #f59e0b); color: white;">
                        <div class="card-title">
                            <i class="fas fa-bell"></i>
                            Ïã§ÏãúÍ∞Ñ AI ÏïåÎ¶º
                        </div>
                        <span id="alert-count" style="background: white; color: #ef4444; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 700;">0</span>
                    </div>
                    <div id="ai-alerts-list" style="max-height: 200px; overflow-y: auto;"></div>
                </div>

                <!-- AI Ïã§ÏãúÍ∞Ñ ÏãúÏû• ÏΩîÎ©òÌÑ∞Î¶¨ -->
                <div class="card" data-aos="fade-up" data-aos-delay="100" style="margin-bottom: 20px;">
                    <div class="card-header" style="background: linear-gradient(90deg, #8b5cf6, #3b82f6); color: white;">
                        <div class="card-title">
                            <i class="fas fa-comment-dots"></i>
                            AI Ïã§ÏãúÍ∞Ñ ÏãúÏû• ÏΩîÎ©òÌÑ∞Î¶¨
                            <span class="voice-indicator" id="voice-indicator" style="display: none;">
                                <span></span><span></span><span></span>
                            </span>
                        </div>
                        <button onclick="loadAICommentary()" style="padding: 5px 12px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;">
                            <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                        </button>
                    </div>
                    <div id="ai-commentary-content" style="padding: 15px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>AI Î∂ÑÏÑù Ï§ë...</p>
                        </div>
                    </div>
                </div>

                <!-- Position Monitor -->
                <div class="card" data-aos="fade-up" data-aos-delay="150">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-crosshairs"></i>
                            Ïã§ÏãúÍ∞Ñ Ìè¨ÏßÄÏÖò Î™®ÎãàÌÑ∞ÎßÅ & AI Îß§Îß§ Ïã†Ìò∏
                        </div>
                        <button onclick="loadPositionMonitor()" style="padding: 5px 12px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px;">
                            <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                        </button>
                    </div>
                    <div id="position-monitor" style="overflow-x: auto;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Î∂ÑÏÑù Ï§ë...</p>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Optimization & Market Trend -->
                <div class="grid-2">
                    <div class="card" data-aos="fade-right" data-aos-delay="200">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-balance-scale"></i>
                                Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏµúÏ†ÅÌôî Ï†úÏïà
                            </div>
                            <button onclick="loadPortfolioOptimization()" style="padding: 4px 10px; background: var(--color-primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                <i class="fas fa-sync-alt"></i> Í∞±Ïã†
                            </button>
                        </div>
                        <div id="portfolio-optimization">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Î∂ÑÏÑù Ï§ë...</p>
                            </div>
                        </div>
                    </div>

                    <div class="card" data-aos="fade-left" data-aos-delay="200">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-chart-line"></i>
                                ÏãúÏû• Ìä∏Î†åÎìú Î∂ÑÏÑù
                            </div>
                            <button onclick="loadMarketTrend()" style="padding: 4px 10px; background: var(--color-primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                <i class="fas fa-sync-alt"></i> Í∞±Ïã†
                            </button>
                        </div>
                        <div id="market-trend-analysis">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Î∂ÑÏÑù Ï§ë...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stock Recommendations -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-lightbulb"></i>
                            AI Ï∂îÏ≤ú Ï¢ÖÎ™© (Top 5)
                        </div>
                        <button onclick="loadStockRecommendations()" style="padding: 4px 10px; background: var(--color-primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                            <i class="fas fa-sync-alt"></i> Í∞±Ïã†
                        </button>
                    </div>
                    <div id="stock-recommendations">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Î∂ÑÏÑù Ï§ë...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Virtual Trading (Paper Trading) -->
            <div class="tab-content" id="tab-backtest">
                <!-- v6.0.1 NEW: 12 Strategy Status Panel -->
                <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                    <div style="padding: 20px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-rocket" style="font-size: 24px;"></i>
                                <div>
                                    <div style="font-size: 16px; font-weight: 700;">12Í∞ÄÏßÄ Í∞ÄÏÉÅÎß§Îß§ Ï†ÑÎûµ Ïã§ÏãúÍ∞Ñ ÏûëÎèô Ï§ë</div>
                                    <div style="font-size: 11px; opacity: 0.8;">v6.0 Data Enricher - ÏûêÎèô Îç∞Ïù¥ÌÑ∞ Î≥¥Í∞ïÏúºÎ°ú Î™®Îì† Ï†ÑÎûµ ÌôúÏÑ±Ìôî</div>
                                </div>
                            </div>
                            <span style="font-size: 11px; padding: 4px 10px; background: rgba(255,255,255,0.2); border-radius: 12px;">‚úÖ Ï†ÑÎûµ 12/12 ÏûëÎèô</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 11px;">
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Î™®Î©òÌÖÄÏ∂îÏÑ∏</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">ÌèâÍ∑†ÌöåÍ∑Ä</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">ÎèåÌååÎß§Îß§</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Í∞ÄÏπòÌà¨Ïûê</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Ïä§ÏúôÎß§Îß§</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">MACDÌÅ¨Î°úÏä§</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Ïó≠Î∞úÏÉÅ</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">ÏÑπÌÑ∞ÏàúÌôò</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Í∏âÎì±Ï∂îÍ≤©</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Î∞∞ÎãπÏÑ±Ïû•</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Í∏∞Í¥ÄÏ∂îÏ¢Ö</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;">
                                <div style="opacity: 0.8;">Í±∞ÎûòÎüâRSI</div>
                                <div style="font-weight: 600; margin-top: 2px;">‚úì ÌôúÏÑ±</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Best Strategy Banner -->
                <div id="best-strategy-banner" style="display: none; background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-trophy" style="font-size: 36px; color: #fbbf24;"></i>
                        <div>
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 4px;">ÏµúÍ≥† ÏÑ±Í≥º Ï†ÑÎûµ</div>
                            <div style="font-size: 24px; font-weight: 700;" id="best-strategy-name">-</div>
                            <div style="font-size: 16px; margin-top: 4px;"><span id="best-strategy-return">+0.00%</span> ÏàòÏùµÎ•†</div>
                        </div>
                    </div>
                </div>

                <!-- Strategy Cards Grid - v5.7.4: 10Í∞ú Ï†ÑÎûµ ÎèôÏ†Å ÏÉùÏÑ± -->
                <div class="grid-3" id="virtual-strategies-grid">
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-muted);">
                        <div class="spinner"></div>
                        <p style="margin-top: 15px;">10Í∞ÄÏßÄ Ï†ÑÎûµ Î°úÎî© Ï§ë...</p>
                    </div>
                </div>

                <!-- Recent Trades -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-history"></i> ÏµúÍ∑º Îß§Îß§ Í∏∞Î°ù
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <select id="strategy-filter" onchange="filterVirtualTrades()" style="padding: 6px 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); font-size: 12px; cursor: pointer;">
                                <option value="all">Ï†ÑÏ≤¥ Ï†ÑÎûµ</option>
                            </select>
                            <button onclick="loadVirtualTrades()" style="padding: 6px 12px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-sync-alt"></i> ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                            <button onclick="downloadVirtualTradesJSON()" style="padding: 6px 12px; background: var(--color-success); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-download"></i> JSON
                            </button>
                            <label style="display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="auto-refresh-trades" style="cursor: pointer;"> ÏûêÎèôÏÉàÎ°úÍ≥†Ïπ®
                            </label>
                        </div>
                    </div>
                    <div id="virtual-trades-list" style="max-height: 300px; overflow-y: auto; padding: 15px;">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 10px;">Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Market Exploration -->
            <div class="tab-content" id="tab-market-explorer">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-search-dollar"></i>
                            ÏãúÏû• ÌÉêÏÉâ
                        </div>
                    </div>

                    <!-- Filter Controls -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 15px; background: var(--card-bg); border-radius: 8px; margin-bottom: 15px;">
                        <div>
                            <label style="font-size: 11px; color: var(--text-secondary); margin-bottom: 5px; display: block;">ÌÉêÏÉâ Í∏∞Ï§Ä</label>
                            <select id="market-filter-type" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
                                <option value="volume">Í±∞ÎûòÎüâ</option>
                                <option value="trading-value">Í±∞ÎûòÎåÄÍ∏à</option>
                                <option value="price-change">ÏÉÅÏäπÎ•†</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 11px; color: var(--text-secondary); margin-bottom: 5px; display: block;">ÏãúÏû•</label>
                            <select id="market-filter-market" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
                                <option value="ALL">Ï†ÑÏ≤¥</option>
                                <option value="KOSPI">ÏΩîÏä§Ìîº</option>
                                <option value="KOSDAQ">ÏΩîÏä§Îã•</option>
                            </select>
                        </div>
                        <div id="sort-option-container" style="display: none;">
                            <label style="font-size: 11px; color: var(--text-secondary); margin-bottom: 5px; display: block;">Ï†ïÎ†¨</label>
                            <select id="market-filter-sort" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
                                <option value="rise">ÏÉÅÏäπÎ•† Ïàú</option>
                                <option value="fall">ÌïòÎùΩÎ•† Ïàú</option>
                            </select>
                        </div>
                        <div>
                            <label style="font-size: 11px; color: var(--text-secondary); margin-bottom: 5px; display: block;">Ï°∞Ìöå Í∞úÏàò</label>
                            <select id="market-filter-limit" style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-size: 12px;">
                                <option value="20">20Í∞ú</option>
                                <option value="50">50Í∞ú</option>
                                <option value="100">100Í∞ú</option>
                            </select>
                        </div>
                    </div>

                    <div style="padding: 0 15px 15px 15px;">
                        <button onclick="loadMarketData()" style="width: 100%; padding: 10px; border-radius: 6px; border: none; background: var(--primary-color); color: white; font-size: 13px; font-weight: 600; cursor: pointer; transition: opacity 0.2s;">
                            <i class="fas fa-search"></i> ÌÉêÏÉâÌïòÍ∏∞
                        </button>
                    </div>
                </div>

                <!-- Results Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-table"></i>
                            <span id="market-results-title">ÌÉêÏÉâ Í≤∞Í≥º</span>
                        </div>
                        <span id="market-results-count" style="font-size: 11px; color: var(--text-secondary);"></span>
                    </div>
                    <div id="market-results" style="overflow-x: auto;">
                        <div class="loading" style="padding: 40px; text-align: center;">
                            <p style="font-size: 12px; color: var(--text-secondary);">ÌïÑÌÑ∞Î•º ÏÑ†ÌÉùÌïòÍ≥† ÌÉêÏÉâÌïòÍ∏∞Î•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Real Portfolio with ATR-based Stops (v5.1) -->
            <div class="tab-content" id="tab-portfolio">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Ïã§Ï†ú Î≥¥Ïú† Ï¢ÖÎ™© (ATR Í∏∞Î∞ò ÏÜêÏùµ Í¥ÄÎ¶¨)
                        </div>
                        <span style="font-size: 11px; color: var(--text-secondary);">
                            <span class="realtime-indicator"></span>Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
                        </span>
                    </div>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead style="background: var(--bg-secondary);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; font-size: 12px; color: var(--text-secondary);">Ï¢ÖÎ™©</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÏàòÎüâ</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÌèâÍ∑†Í∞Ä</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÌòÑÏû¨Í∞Ä</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÏÜêÏ†àÍ∞Ä (ATR)</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÏùµÏ†àÍ∞Ä (ATR)</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÏàòÏùµÎ•†</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">ÌèâÍ∞ÄÏï°</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">Kelly / Sharpe</th>
                                    <th style="padding: 12px; text-align: right; font-size: 12px; color: var(--text-secondary);">RSI / R:R</th>
                                </tr>
                            </thead>
                            <tbody id="real-holdings-table">
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <div class="loading">
                                            <div class="spinner"></div>
                                            <p style="margin-top: 10px;">Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ÏßÑÎ≥¥Îêú ÏßÄÌëú ÏÑ§Î™Ö Ïπ¥Îìú -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-info-circle"></i>
                            ÏßÑÎ≥¥Îêú Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÑù ÏßÄÌëú ÏÑ§Î™Ö
                        </div>
                    </div>
                    <div style="padding: 15px; font-size: 12px; line-height: 1.6;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div>
                                <strong style="color: var(--color-primary);">ATR (Average True Range)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>ÏÜêÏ†àÍ∞Ä = ÌèâÍ∑†Í∞Ä - (ATR √ó 2)</li>
                                    <li>ÏùµÏ†àÍ∞Ä = ÌèâÍ∑†Í∞Ä + (ATR √ó 3)</li>
                                    <li>Î≥ÄÎèôÏÑ± Í∏∞Î∞ò ÎèôÏ†Å ÏÜêÏùµ Í¥ÄÎ¶¨</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: var(--color-success);">Kelly Criterion (K)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>ÏµúÏ†Å Ìè¨ÏßÄÏÖò ÌÅ¨Í∏∞ Í≥ÑÏÇ∞</li>
                                    <li>15% Ïù¥ÏÉÅ: Í≥µÍ≤©Ï†Å ÎπÑÏ§ë Í∞ÄÎä•</li>
                                    <li>5% Ïù¥Ìïò: Î≥¥ÏàòÏ†Å Ï†ëÍ∑º Í∂åÏû•</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: var(--color-warning);">Sharpe Ratio (S)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>ÏúÑÌóò Ï°∞Ï†ï ÏàòÏùµÎ•† (20Ïùº Í∏∞Ï§Ä)</li>
                                    <li>1.0 Ïù¥ÏÉÅ: Ïö∞ÏàòÌïú risk-return</li>
                                    <li>ÏùåÏàò: ÏÜêÏã§ ÏúÑÌóò ÎÜíÏùå</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: var(--color-danger);">Maximum Drawdown (MDD)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>ÏµúÍ≥†Ï†ê ÎåÄÎπÑ ÏµúÎåÄ ÎÇôÌè≠</li>
                                    <li>20% Ïù¥ÏÉÅ: Í≥†ÏúÑÌóò Íµ¨Í∞Ñ</li>
                                    <li>ÏÜêÏã§ ÎÇ¥ÏÑ± ÏàòÏ§Ä ÌååÏïÖ</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: var(--color-primary);">RSI (Relative Strength Index)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>70 Ïù¥ÏÉÅ: Í≥ºÎß§Ïàò (Îß§ÎèÑ Ïã†Ìò∏)</li>
                                    <li>30 Ïù¥Ìïò: Í≥ºÎß§ÎèÑ (Îß§Ïàò Ïã†Ìò∏)</li>
                                    <li>Î™®Î©òÌÖÄ Í∞ïÎèÑ Ï∏°Ï†ï</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: var(--color-success);">Risk/Reward Ratio (R:R)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>ÏùµÏ†àÌè≠ / ÏÜêÏ†àÌè≠ ÎπÑÏú®</li>
                                    <li>2:1 Ïù¥ÏÉÅ: ÏñëÌò∏Ìïú Í±∞Îûò</li>
                                    <li>1:1 Ïù¥Ìïò: ÏúÑÌóò ÎÜíÏùÄ Í±∞Îûò</li>
                                </ul>
                            </div>
                            <div style="grid-column: 1 / -1;">
                                <strong style="color: var(--color-info);">Bollinger Bands Position (BB)</strong>
                                <ul style="margin: 5px 0 0 15px; color: var(--text-secondary);">
                                    <li>100%: ÏÉÅÎã® Î∞¥Îìú (Í≥ºÎß§Ïàò Í∞ÄÎä•)</li>
                                    <li>50%: Ï§ëÏïôÏÑ† (Ï†ïÏÉÅ)</li>
                                    <li>0%: ÌïòÎã® Î∞¥Îìú (Í≥ºÎß§ÎèÑ Í∞ÄÎä•)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 6: Sentiment Analysis (v4.2) -->
            <div class="tab-content" id="tab-sentiment">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-newspaper"></i>
                            Í∞êÏÑ± Î∂ÑÏÑù (v4.2)
                        </div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <input type="text" id="sentiment-stock-code" placeholder="Ï¢ÖÎ™© ÏΩîÎìú ÏûÖÎ†• (Ïòà: 005930)" style="padding: 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary);">
                            <button onclick="analyzeSentiment()" style="padding: 12px; border-radius: 6px; border: none; background: var(--color-primary); color: white; font-weight: 600; cursor: pointer;">
                                <i class="fas fa-search"></i> Î∂ÑÏÑù
                            </button>
                        </div>
                        <div id="sentiment-results" style="display: none;">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Ï†ÑÏ≤¥ Í∞êÏÑ±</div>
                                    <div style="font-size: 32px; font-weight: 700;" id="sentiment-overall">-</div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;" id="sentiment-label">-</div>
                                </div>
                                <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Îâ¥Ïä§ Í∞êÏÑ±</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-info);" id="sentiment-news">-</div>
                                </div>
                                <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">ÏÜåÏÖú Í∞êÏÑ±</div>
                                    <div style="font-size: 32px; font-weight: 700; color: var(--color-warning);" id="sentiment-social">-</div>
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--bg-secondary); border-radius: 8px;">
                                <h4 style="font-size: 13px; margin-bottom: 10px;">ÏµúÍ∑º Îâ¥Ïä§</h4>
                                <div id="sentiment-news-list" style="font-size: 12px; color: var(--text-secondary);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 7: Risk Management (v4.2) -->
            <div class="tab-content" id="tab-risk">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-shield-alt"></i>
                            Í≥†Í∏â Î¶¨Ïä§ÌÅ¨ Í¥ÄÎ¶¨ (v4.2)
                        </div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">VaR (95%)</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--color-danger);" id="risk-var">-</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">CVaR (95%)</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--color-danger);" id="risk-cvar">-</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">ÏµúÎåÄ ÏÜêÏã§</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--color-warning);" id="risk-max-loss">-</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-secondary); border-radius: 8px; text-align: center;">
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 8px;">Î¶¨Ïä§ÌÅ¨ Î†àÎ≤®</div>
                                <div style="font-size: 24px; font-weight: 700;" id="risk-level">-</div>
                            </div>
                        </div>
                        <button onclick="assessRisk()" style="width: 100%; padding: 12px; border-radius: 6px; border: none; background: var(--color-primary); color: white; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-calculator"></i> Î¶¨Ïä§ÌÅ¨ ÌèâÍ∞Ä Ïã§Ìñâ
                        </button>
                        <div id="risk-chart" style="margin-top: 20px; height: 300px; background: var(--bg-secondary); border-radius: 8px;"></div>
                    </div>
                </div>
            </div>

            <!-- Tab 8: Market Regime (v4.2) -->
            <div class="tab-content" id="tab-regime">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-brain"></i>
                            ÎßàÏºì Î†àÏßê Í∞êÏßÄ (v4.2)
                        </div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                            <div style="padding: 30px; background: var(--bg-secondary); border-radius: 12px; text-align: center;">
                                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">ÌòÑÏû¨ ÏãúÏû• ÏÉÅÌÉú</div>
                                <div style="font-size: 36px; font-weight: 700; margin-bottom: 10px;" id="regime-current">-</div>
                                <div style="font-size: 12px; color: var(--text-secondary);" id="regime-confidence">Ïã†Î¢∞ÎèÑ: -</div>
                            </div>
                            <div style="padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                                <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">ÏãúÏû• ÏßÄÌëú</div>
                                <div style="display: grid; gap: 10px;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 12px;">Î≥ÄÎèôÏÑ±:</span>
                                        <span style="font-size: 12px; font-weight: 700;" id="regime-volatility">-</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 12px;">Ï∂îÏÑ∏ Í∞ïÎèÑ:</span>
                                        <span style="font-size: 12px; font-weight: 700;" id="regime-trend">-</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 12px;">ÏãúÏû• Ïã¨Î¶¨:</span>
                                        <span style="font-size: 12px; font-weight: 700;" id="regime-sentiment">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button onclick="detectRegime()" style="width: 100%; padding: 12px; border-radius: 6px; border: none; background: var(--color-primary); color: white; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-sync-alt"></i> Î†àÏßê Í∞êÏßÄ Ïã§Ìñâ
                        </button>
                        <div style="margin-top: 20px; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                            <h4 style="font-size: 13px; margin-bottom: 15px;">Ï∂îÏ≤ú Ï†ÑÎûµ</h4>
                            <div id="regime-recommendations" style="font-size: 12px; color: var(--text-secondary);">
                                Î†àÏßê Í∞êÏßÄÎ•º Ïã§ÌñâÌïòÏó¨ Ï∂îÏ≤ú Ï†ÑÎûµÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Panel: 3-Column Grid -->
        <aside class="right-panel">
            <!-- Holdings Section -->
            <div class="right-panel-section">
                <div class="section-title">
                    <i class="fas fa-briefcase"></i> Î≥¥Ïú†ÌòÑÌô©
                </div>
                <div id="portfolio-summary" class="compact-card">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px; font-size: 12px;">Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î°úÎî© Ï§ë...</p>
                    </div>
                </div>
            </div>

            <!-- Program Monitoring Section -->
            <div class="right-panel-section">
                <div class="section-title">
                    <i class="fas fa-desktop"></i> ÌîÑÎ°úÍ∑∏Îû® Î™®ÎãàÌÑ∞
                </div>
                <div id="program-monitor" class="compact-card">
                    <!-- Scan Progress -->
                    <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color);">
                        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">Ïä§Ï∫î ÏÉÅÌÉú</div>
                        <div id="scan-status" style="font-size: 11px; color: var(--text-secondary);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span>ÌòÑÏû¨ Ï†ÑÎûµ:</span>
                                <span id="current-strategy" style="color: var(--color-primary); font-weight: 600;">-</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span>ÌõÑÎ≥¥ Ï¢ÖÎ™©:</span>
                                <span id="total-candidates" style="color: var(--text-primary); font-weight: 600;">0Í∞ú</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span>Í≤ÄÌÜ† Ï§ë:</span>
                                <span id="reviewing-stock" style="color: var(--color-info); font-weight: 600;">-</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ÏäπÏù∏/ÌÉàÎùΩ:</span>
                                <span><span id="approved-count" style="color: var(--color-success); font-weight: 600;">0</span> / <span id="rejected-count" style="color: var(--color-danger); font-weight: 600;">0</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div>
                        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">ÏãúÏä§ÌÖú ÌôúÎèô</div>
                        <div id="system-activities" style="max-height: 200px; overflow-y: auto;">
                            <div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 11px;">Î°úÎî© Ï§ë...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Candidates Section -->
            <div class="right-panel-section">
                <div class="section-title">
                    <i class="fas fa-robot"></i> AI Îß§Ïàò ÌõÑÎ≥¥
                </div>
                <div id="candidates-list" class="compact-card">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px; font-size: 12px;">ÌõÑÎ≥¥ Ï¢ÖÎ™© Î∂ÑÏÑù Ï§ë...</p>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        let socket;
        let mainChart;
        let candlestickSeries;
        let paperEquityChart;
        let currentTab = 0;

        // Tab Switching
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                    contents[i].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[i].classList.remove('active');
                }
            });

            currentTab = index;

            // Load tab-specific data
            if (index === 1) {
                // v6.0: Load ALL AI analysis features including performance
                loadAITabPerformance();  // Portfolio performance banner
                loadAICommentary();  // Market commentary
                loadAIAlerts();
                loadPositionMonitor();
                loadPortfolioOptimization();
                loadMarketTrend();
                loadStockRecommendations();
            } else if (index === 2) {
                // v5.6: Load virtual trades once when tab is opened
                loadPaperTradingData();
                loadVirtualTrades();
            }
        }

        // Global refresh control
        let refreshIntervalId = null;

        function startAutoRefresh() {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
            }
            const interval = parseInt(document.getElementById('refresh-interval').value);
            refreshIntervalId = setInterval(loadAllData, interval);
            console.log(`Auto-refresh started: ${interval}ms`);
        }

        function stopAutoRefresh() {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
                console.log('Auto-refresh stopped');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            initializeChart();
            loadAllData();
            initializePaperEquityChart();
            initializeStockSearch();

            // Setup auto-refresh controls
            const autoRefreshCheckbox = document.getElementById('global-auto-refresh');
            const refreshIntervalSelect = document.getElementById('refresh-interval');

            autoRefreshCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });

            refreshIntervalSelect.addEventListener('change', function() {
                if (autoRefreshCheckbox.checked) {
                    startAutoRefresh();
                }
            });

            // Load initial data only - NO auto-refresh by default
            console.log('‚úì Dashboard loaded - Auto-refresh: OFF (user control)');
        });

        // WebSocket
        function initializeSocket() {
            socket = io();

            socket.on('connect', function() {
                console.log('Connected to server');
                showToast('‚úÖ ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÏôÑÎ£å', 'success');
            });

            socket.on('status_update', function(data) {
                console.log('Status update:', data);
            });

            socket.on('price_update', function(data) {
                if (candlestickSeries && data.price) {
                    updateChartPrice(data);
                }
            });

            socket.on('trade_executed', function(data) {
                showToast(`üîî ${data.action} Ï£ºÎ¨∏ Ï≤¥Í≤∞: ${data.stock_name}`, 'info');
                loadAllData();
            });
        }

        // Initialize Chart
        function initializeChart() {
            // Use advanced chart if available (new indicator-enabled chart)
            if (typeof AdvancedTradingChart !== 'undefined') {
                console.log('Using Advanced Trading Chart with indicators');
                window.advancedChart = new AdvancedTradingChart('main-chart');
                window.advancedChart.initialize();
                window.advancedChart.loadData('005930');
                return;
            }

            // Fallback to basic chart (original code)
            console.log('Using basic chart (fallback)');
            const chartContainer = document.getElementById('main-chart');
            mainChart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 400,
                layout: {
                    background: { color: '#1e2139' },
                    textColor: '#9ca3af',
                },
                grid: {
                    vertLines: { color: '#2d3250' },
                    horzLines: { color: '#2d3250' },
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                rightPriceScale: {
                    borderColor: '#2d3250',
                },
                timeScale: {
                    borderColor: '#2d3250',
                    timeVisible: true,
                },
            });

            candlestickSeries = mainChart.addCandlestickSeries({
                upColor: '#10b981',
                downColor: '#ef4444',
                borderVisible: false,
                wickUpColor: '#10b981',
                wickDownColor: '#ef4444',
            });

            window.addEventListener('resize', () => {
                mainChart.applyOptions({ width: chartContainer.clientWidth });
            });

            // Load initial chart data
            loadChartData('005930'); // Default: Samsung
        }

        // Load Chart Data from Kiwoom API
        async function loadChartData(stockCode) {
            try {
                // If advanced chart is available, use it
                if (window.advancedChart) {
                    await window.advancedChart.loadData(stockCode);
                    return;
                }

                // Fallback to basic chart
                const response = await fetch(`/api/chart/${stockCode}`);
                const data = await response.json();

                if (data.success && data.data && data.data.length > 0) {
                    candlestickSeries.setData(data.data);

                    // Add trading signals
                    if (data.signals) {
                        candlestickSeries.setMarkers(data.signals);
                    }

                    document.getElementById('chart-stock-name').textContent = data.name || stockCode;
                    if (data.current_price) {
                        document.getElementById('chart-price').textContent = '‚Ç©' + formatNumber(data.current_price);
                    }
                } else if (!data.success) {
                    // ÏóêÎü¨ Î∞úÏÉù Ïãú ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    console.error('Chart load error:', data.error);
                    document.getElementById('chart-stock-name').textContent = `Ï∞®Ìä∏ Î°úÎî© Ïã§Ìå®: ${stockCode}`;
                    alert(`Ï∞®Ìä∏Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                } else {
                    // Îç∞Ïù¥ÌÑ∞Í∞Ä ÎπÑÏñ¥ÏûàÏùÑ Îïå
                    console.warn('No chart data available for:', stockCode);
                    document.getElementById('chart-stock-name').textContent = `Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå: ${stockCode}`;
                }
            } catch (error) {
                console.error('Chart data error:', error);
                alert('Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ ÏöîÏ≤≠ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Update chart with real-time price
        function updateChartPrice(data) {
            const update = {
                time: Math.floor(Date.now() / 1000),
                open: data.price,
                high: data.price,
                low: data.price,
                close: data.price
            };
            candlestickSeries.update(update);
            document.getElementById('chart-price').textContent = '‚Ç©' + formatNumber(data.price);
        }

        // Load All Data (v5.6: Virtual trades moved to separate function)
        async function loadAllData() {
            try {
                // Show loading indicator
                const statusText = document.getElementById('status-text');
                const originalText = statusText ? statusText.textContent : '';
                if (statusText) statusText.textContent = 'Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...';

                const [account, positions, candidates, status, activity, connections, wsSubscriptions, realHoldings, optimization] = await Promise.all([
                    fetch('/api/account').then(r => r.json()).catch(e => {
                        console.error('Account API error:', e);
                        return {total_assets: 0, cash: 0, stock_value: 0, profit_loss: 0, profit_loss_percent: 0};
                    }),
                    fetch('/api/positions').then(r => r.json()).catch(() => ({success: false, positions: []})),
                    fetch('/api/candidates').then(r => r.json()).catch(() => ({success: false, data: []})),
                    fetch('/api/status').then(r => r.json()).catch(() => ({is_running: false, current_time: new Date().toLocaleString()})),
                    fetch('/api/trading-activity').then(r => r.json()).catch(() => ({success: false})),
                    fetch('/api/system-connections').then(r => r.json()).catch(() => ({rest_api: false, websocket: false, gemini: false})),
                    fetch('/api/websocket/subscriptions').then(r => r.json()).catch(() => ({success: false, data: {price: [], orderbook: [], execution: [], total: 0}})),
                    fetch('/api/portfolio/real-holdings').then(r => r.json()).catch(() => ({success: false, data: []})),
                    fetch('/api/profit-optimization/summary').then(r => r.json()).catch(() => ({success: false, summary: {total_positions: 0, sell_recommended: 0, hold_recommended: 0, partial_sell_recommended: 0}}))
                ]);

                // v5.3: Check if bot is connected
                const isBotConnected = account && account.total_assets !== undefined && (connections.rest_api || connections.websocket || connections.gemini);

                if (!isBotConnected && account.total_assets === 0) {
                    showBotDisconnectedWarning();
                }

                updateAccountSeamless(account);
                updateStatus(status);
                updateConnectionStatus(connections);

                // Update compact right panel sections
                updatePortfolioSummary(account, positions);
                updateProgramMonitor();  // New: Program monitoring
                updateCandidatesCompact(candidates);

                // v5.1: Update new sections
                updateWebSocketSubscriptions(wsSubscriptions);
                updateRealHoldingsTable(realHoldings);

                // v5.7.2: Update profit optimization
                updateOptimizationSeamless(optimization);

                // v5.6: Update virtual trades only if auto-refresh is enabled
                if (document.getElementById('auto-refresh-trades')?.checked) {
                    loadVirtualTrades();
                }

                // Restore status text
                if (statusText && originalText) statusText.textContent = originalText;
            } catch (error) {
                console.error('Critical error loading data:', error);
                showToast('‚ùå Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ïã§Ìå®: ' + error.message, 'error');
                // Restore status
                const statusText = document.getElementById('status-text');
                if (statusText) statusText.textContent = 'Ïò§Î•ò Î∞úÏÉù';
            }
        }

        // v5.6: Separate function for virtual trades loading
        async function loadVirtualTrades() {
            try {
                const virtualTrades = await fetch('/api/virtual-trades').then(r => r.json()).catch(() => ({success: false}));
                updateVirtualTradesHistory(virtualTrades);
            } catch (error) {
                console.error('Error loading virtual trades:', error);
            }
        }

        // v5.6: Download virtual trades as JSON
        async function downloadVirtualTradesJSON() {
            try {
                const response = await fetch('/api/virtual-trades');
                const data = await response.json();

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});

                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `virtual_trades_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading virtual trades JSON:', error);
                alert('JSON Îã§Ïö¥Î°úÎìú Ïã§Ìå®: ' + error.message);
            }
        }

        // v5.3: Show warning when bot is not connected
        let warningShown = false;
        function showBotDisconnectedWarning() {
            if (warningShown) return;
            warningShown = true;

            // Update status badge
            const statusBadge = document.getElementById('status-badge');
            if (statusBadge) {
                statusBadge.className = 'status-badge disconnected';
                statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Bot ÎØ∏Ïó∞Í≤∞';
            }

            // Show warning in portfolio-summary
            const portfolioSummary = document.getElementById('portfolio-summary');
            if (portfolioSummary) {
                portfolioSummary.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--color-warning);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Trading Bot ÎØ∏Ïó∞Í≤∞</div>
                        <div style="font-size: 11px; color: var(--text-secondary); line-height: 1.4;">
                            ÎåÄÏãúÎ≥¥ÎìúÎßå Ïã§Ìñâ Ï§ëÏûÖÎãàÎã§.<br>
                            <code style="background: var(--bg-secondary); padding: 2px 6px; border-radius: 4px;">python main.py</code>Î•º Ïã§ÌñâÌïòÏÑ∏Ïöî.
                        </div>
                    </div>
                `;
            }

            // Show warning in candidates-list
            const candidatesList = document.getElementById('candidates-list');
            if (candidatesList) {
                candidatesList.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--text-secondary); font-size: 11px;">
                        Bot Ïó∞Í≤∞ ÌõÑ ÌõÑÎ≥¥ Ï¢ÖÎ™©Ïù¥ ÌëúÏãúÎê©ÎãàÎã§.
                    </div>
                `;
            }
        }

        // Update Connection Status
        function updateConnectionStatus(data) {
            // REST API
            updateSingleConnection('conn-rest-api', data.rest_api, 'REST API');

            // WebSocket
            updateSingleConnection('conn-websocket', data.websocket, 'WebSocket');

            // Gemini AI
            updateSingleConnection('conn-gemini', data.gemini, 'Gemini AI');

            // Test Mode (ÌôúÏÑ±=ÌååÎûÄÏÉâ, ÎπÑÌôúÏÑ±=Îπ®Í∞ÑÏÉâ)
            const testModeEl = document.getElementById('conn-testmode');
            if (testModeEl) {
                testModeEl.className = 'connection-status ' + (data.test_mode ? 'active' : 'disconnected');
                testModeEl.querySelector('span').textContent = data.test_mode ? 'ÌôúÏÑ±' : 'ÎπÑÌôúÏÑ±';
            }
        }

        function updateSingleConnection(elementId, isConnected, label) {
            const el = document.getElementById(elementId);
            if (!el) return;

            if (isConnected) {
                el.className = 'connection-status connected';
                el.querySelector('span').textContent = 'Ïó∞Í≤∞Îê®';
            } else {
                el.className = 'connection-status disconnected';
                el.querySelector('span').textContent = 'ÎÅäÍπÄ';
            }
        }

        // v5.7.2: Seamless Update ÏãúÏä§ÌÖú
        // ÏÇ¨Ïö©ÏûêÍ∞Ä ÎààÏπòÏ±ÑÏßÄ Î™ªÌïòÍ≤å Î∂ÄÎìúÎüΩÍ≤å ÏóÖÎç∞Ïù¥Ìä∏

        // Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        let previousData = {
            account: {},
            positions: [],
            optimization: {}
        };

        /**
         * Î∂ÄÎìúÎü¨Ïö¥ Ïà´Ïûê ÏóÖÎç∞Ïù¥Ìä∏ (Ïπ¥Ïö¥ÌÑ∞ Ïï†ÎãàÎ©îÏù¥ÏÖò)
         */
        function smoothUpdateNumber(elementId, newValue, prefix = '', suffix = '', duration = 500) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const oldText = element.textContent.replace(prefix, '').replace(suffix, '').replace(/[^0-9.-]/g, '');
            const oldValue = parseFloat(oldText) || 0;
            const newValueNum = parseFloat(newValue) || 0;

            // Í∞íÏù¥ Í∞ôÏúºÎ©¥ Ïä§ÌÇµ
            if (oldValue === newValueNum) return;

            const startTime = performance.now();
            const diff = newValueNum - oldValue;

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                // Easing function (easeOutCubic)
                const easeProgress = 1 - Math.pow(1 - progress, 3);

                const currentValue = oldValue + (diff * easeProgress);
                element.textContent = prefix + formatNumber(Math.round(currentValue)) + suffix;

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    element.textContent = prefix + formatNumber(newValueNum) + suffix;
                }
            }

            requestAnimationFrame(animate);
        }

        /**
         * Î∂ÄÎìúÎü¨Ïö¥ ÌÖçÏä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ (fade transition)
         */
        function smoothUpdateText(elementId, newValue, applyColorClass = null) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const oldValue = element.textContent;

            // Í∞íÏù¥ Í∞ôÏúºÎ©¥ Ïä§ÌÇµ
            if (oldValue === newValue) return;

            // Fade out
            element.style.transition = 'opacity 0.2s ease-out';
            element.style.opacity = '0';

            setTimeout(() => {
                element.textContent = newValue;

                // ÏÉâÏÉÅ Ï†ÅÏö©
                if (applyColorClass) {
                    element.className = applyColorClass;
                }

                // Fade in
                element.style.opacity = '1';
            }, 200);
        }

        /**
         * Î≥ÄÍ≤Ω Í∞êÏßÄ Î∞è ÌïòÏù¥ÎùºÏù¥Ìä∏
         */
        function highlightChange(elementId, color = 'rgba(16, 185, 129, 0.3)') {
            const element = document.getElementById(elementId);
            if (!element) return;

            // Î∞∞Í≤ΩÏÉâ ÌîåÎûòÏãú
            element.style.transition = 'background-color 0.3s ease-out';
            element.style.backgroundColor = color;

            setTimeout(() => {
                element.style.backgroundColor = 'transparent';
            }, 300);
        }

        /**
         * v5.7.2: Seamless Account Update
         */
        function updateAccountSeamless(data) {
            // Ï¥ù ÏûêÏÇ∞
            const totalAssets = data.total_assets || 0;
            if (previousData.account.total_assets !== totalAssets) {
                smoothUpdateNumber('total-assets', totalAssets, '‚Ç©', '', 800);
                if (previousData.account.total_assets) {
                    highlightChange('total-assets', 'rgba(59, 130, 246, 0.2)');
                }
            }

            // ÌòÑÍ∏à
            const cash = data.cash || 0;
            if (previousData.account.cash !== cash) {
                smoothUpdateNumber('cash', cash, '‚Ç©', '', 600);
            }

            // Ï£ºÏãù Í∞ÄÏπò
            const stockValue = data.stock_value || 0;
            if (previousData.account.stock_value !== stockValue) {
                smoothUpdateNumber('stock-value', stockValue, '‚Ç©', '', 600);
            }

            // ÏÜêÏùµ - v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ (Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë)
            const pl = data.profit_loss || 0;
            const plElement = document.getElementById('profit-loss');
            if (previousData.account.profit_loss !== pl && plElement) {
                const prefix = pl >= 0 ? '+‚Ç©' : '-‚Ç©';
                smoothUpdateNumber('profit-loss', Math.abs(pl), prefix, '', 700);
                plElement.style.color = pl >= 0 ? '#ef4444' : '#3b82f6';  // Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë

                if (previousData.account.profit_loss) {
                    highlightChange('profit-loss', pl >= 0 ? 'rgba(239, 68, 68, 0.3)' : 'rgba(59, 130, 246, 0.3)');
                }
            }

            // ÏÜêÏùµÎ•† - v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ
            const plPercent = data.profit_loss_percent || 0;
            const plPercentElement = document.getElementById('profit-loss-percent');
            if (previousData.account.profit_loss_percent !== plPercent && plPercentElement) {
                const prefix = plPercent >= 0 ? '+' : '';
                plPercentElement.textContent = prefix + plPercent.toFixed(2) + '%';
                plPercentElement.style.color = plPercent >= 0 ? '#ef4444' : '#3b82f6';  // Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë
            }

            // Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            previousData.account = {...data};
        }

        /**
         * v5.7.2: Seamless Optimization Update
         */
        function updateOptimizationSeamless(response) {
            if (!response.success || !response.summary) {
                return;
            }

            const summary = response.summary;

            // Îß§ÎèÑ Í∂åÏû•
            const sellCount = summary.sell_recommended || 0;
            if (previousData.optimization.sell_recommended !== sellCount) {
                smoothUpdateNumber('opt-sell-count', sellCount, '', '', 400);
                if (sellCount > 0 && previousData.optimization.sell_recommended !== undefined) {
                    highlightChange('opt-sell-count', 'rgba(239, 68, 68, 0.4)');
                }
            }

            // Î∂ÄÎ∂Ñ ÏùµÏ†à
            const partialCount = summary.partial_sell_recommended || 0;
            if (previousData.optimization.partial_sell_recommended !== partialCount) {
                smoothUpdateNumber('opt-partial-count', partialCount, '', '', 400);
                if (partialCount > 0) {
                    highlightChange('opt-partial-count', 'rgba(245, 158, 11, 0.4)');
                }
            }

            // Î≥¥Ïú† Ïú†ÏßÄ
            const holdCount = summary.hold_recommended || 0;
            if (previousData.optimization.hold_recommended !== holdCount) {
                smoothUpdateNumber('opt-hold-count', holdCount, '', '', 400);
            }

            // Ïù¥Ï†Ñ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            previousData.optimization = {...summary};
        }
        function updateAccount(data) {
            // Use CountUp.js for animated number updates
            if (typeof countUp !== 'undefined') {
                animateNumber('total-assets', data.total_assets || 0, '‚Ç©', '', 0);
                animateNumber('cash', data.cash || 0, '‚Ç©', '', 0);
                animateNumber('stock-value', data.stock_value || 0, '‚Ç©', '', 0);
            } else {
                // Fallback to smooth update
                smoothUpdateNumber('total-assets', data.total_assets || 0, '‚Ç©', '', 800);
                smoothUpdateNumber('cash', data.cash || 0, '‚Ç©', '', 800);
                smoothUpdateNumber('stock-value', data.stock_value || 0, '‚Ç©', '', 800);
            }

            const pl = data.profit_loss || 0;
            const plElement = document.getElementById('profit-loss');

            // Animate profit/loss
            if (typeof countUp !== 'undefined') {
                const prefix = pl >= 0 ? '+‚Ç©' : '-‚Ç©';
                animateNumber('profit-loss', Math.abs(pl), prefix, '', 0);
            } else {
                plElement.textContent = (pl >= 0 ? '+' : '') + '‚Ç©' + formatNumber(Math.abs(pl));
            }
            plElement.style.color = pl >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ

            // Update profit/loss percentage
            const plPercent = data.profit_loss_percent || 0;
            const plPercentElement = document.getElementById('profit-loss-percent');
            plPercentElement.textContent = (plPercent >= 0 ? '+' : '') + plPercent.toFixed(2) + '%';
            plPercentElement.style.color = plPercent >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ

            // Add pulse animation on significant change
            if (Math.abs(pl) > 10000) {
                plElement.style.animation = 'pulse 0.5s ease-in-out';
                setTimeout(() => plElement.style.animation = '', 500);
            }
        }

        function updatePositions(positions) {
            const container = document.getElementById('holdings-list');

            if (!positions || positions.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 12px;">Î≥¥Ïú† Ï¢ÖÎ™© ÏóÜÏùå</div>';
                return;
            }

            let html = '';
            positions.forEach(p => {
                const plColor = p.profit_loss >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ

                // AI Ï†êÏàò Í≥ÑÏÇ∞ (ÏÜêÏùµÎ•† Í∏∞Î∞ò)
                const aiScore = Math.min(100, Math.max(0, 50 + p.profit_loss_percent * 2));
                const scoreColor = aiScore >= 70 ? '#10b981' : aiScore >= 40 ? '#f59e0b' : '#ef4444';

                // ÌÉÄÏù¥Î∞ç Ïã†Ìò∏
                let timingSignal = 'wait';
                if (p.profit_loss_percent < -5) timingSignal = 'sell'; // ÏÜêÏã§ 5% Ïù¥ÏÉÅ
                else if (p.profit_loss_percent > 10) timingSignal = 'sell'; // ÏàòÏùµ 10% Ïù¥ÏÉÅ Ïã§ÌòÑ
                else if (p.profit_loss_percent > 2 && p.profit_loss_percent < 5) timingSignal = 'buy'; // Ï∂îÍ∞Ä Îß§Ïàò Íµ¨Í∞Ñ

                html += `
                    <div class="gradient-hover" style="padding: 10px; border-bottom: 1px solid var(--border-color); cursor: pointer; border-radius: 6px; margin-bottom: 4px;" onclick="loadChartData('${p.code}')">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span class="timing-signal ${timingSignal}"></span>
                                    <strong style="font-size: 12px;">${p.name}</strong>
                                </div>
                                <div style="font-size: 11px; color: var(--text-secondary);">
                                    ${p.quantity}Ï£º √ó ‚Ç©${formatNumber(p.current_price)}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="text-align: right;">
                                    <div style="color: ${plColor}; font-weight: 600; font-size: 13px;">
                                        ${p.profit_loss >= 0 ? '+' : ''}${p.profit_loss_percent.toFixed(2)}%
                                    </div>
                                    <div style="font-size: 10px; color: var(--text-muted);">
                                        ${p.profit_loss >= 0 ? '+' : ''}‚Ç©${formatNumber(Math.abs(p.profit_loss))}
                                    </div>
                                </div>
                                <div class="ai-score-gauge" style="--gauge-percentage: ${aiScore}%; --gauge-color: ${scoreColor}; width: 45px; height: 45px;">
                                    <div class="ai-score-gauge-value" style="font-size: 11px;">${Math.round(aiScore)}</div>
                                </div>
                            </div>
                        </div>
                        <div class="gradient-progress">
                            <div class="gradient-progress-bar" style="width: ${Math.abs(p.profit_loss_percent) * 5}%;"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateCandidates(candidates) {
            const container = document.getElementById('candidates-list');

            if (!candidates || candidates.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 12px;">ÌõÑÎ≥¥ Ï¢ÖÎ™© ÏóÜÏùå</div>';
                return;
            }

            let html = '';
            candidates.forEach((c, index) => {
                const aiScore = c.ai_score || 0;
                const scoreColor = aiScore >= 70 ? '#10b981' : aiScore >= 40 ? '#f59e0b' : '#ef4444';
                const confidence = c.confidence || 0.85;

                // ÌÉÄÏù¥Î∞ç Ïã†Ìò∏ (Ï†êÏàò Í∏∞Î∞ò)
                let timingSignal = 'wait';
                let timingText = 'Î∂ÑÏÑù Ï§ë';
                if (aiScore >= 70) {
                    timingSignal = 'buy';
                    timingText = 'Îß§Ïàò Ï†ÅÍ∏∞!';
                } else if (aiScore >= 50) {
                    timingSignal = 'wait';
                    timingText = 'Í¥ÄÎßù';
                } else {
                    timingSignal = 'sell';
                    timingText = 'ÏúÑÌóò';
                }

                // Shimmer Ìö®Í≥º (ÏÉÅÏúÑ 3Í∞ú)
                const shimmerClass = index < 3 ? 'shimmer' : '';

                html += `
                    <div class="gradient-hover ${shimmerClass}" style="padding: 12px; border-bottom: 1px solid var(--border-color); cursor: pointer; border-radius: 6px; margin-bottom: 6px; position: relative;" onclick="loadChartData('${c.code}')">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span class="timing-signal ${timingSignal}" title="${timingText}"></span>
                                    <strong style="font-size: 13px;">${c.name}</strong>
                                    ${index < 3 ? '<span style="background: linear-gradient(90deg, #ef4444, #f59e0b); color: white; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 700; margin-left: 4px;">TOP ${index + 1}</span>' : ''}
                                </div>
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">
                                    ${c.code} ¬∑ ‚Ç©${formatNumber(c.price)}
                                </div>
                                <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                    <span class="signal-badge buy" style="font-size: 10px; padding: 3px 8px;">${c.signal || 'BUY'}</span>
                                    <span class="signal-badge" style="background: rgba(59, 130, 246, 0.1); color: var(--color-primary); font-size: 10px; padding: 3px 8px;">
                                        Ïã†Î¢∞ÎèÑ ${Math.round(confidence * 100)}%
                                    </span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div class="ai-score-gauge" style="--gauge-percentage: ${aiScore}%; --gauge-color: ${scoreColor}; width: 50px; height: 50px;">
                                    <div class="ai-score-gauge-value" style="font-size: 12px;">${Math.round(aiScore)}</div>
                                </div>
                                <button onclick="event.stopPropagation(); quickBuy('${c.code}', '${c.name}', ${c.price})"
                                        style="padding: 8px 16px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); transition: transform 0.2s;"
                                        onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    <i class="fas fa-bolt"></i> Îπ†Î•∏ Îß§Ïàò
                                </button>
                            </div>
                        </div>
                        <div class="gradient-progress">
                            <div class="gradient-progress-bar" style="width: ${aiScore}%;"></div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Îπ†Î•∏ Îß§Ïàò Ìï®Ïàò
        async function quickBuy(code, name, price) {
            if (!confirm(`${name}(${code})Î•º ‚Ç©${formatNumber(price)}Ïóê Îß§ÏàòÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                return;
            }

            try {
                showToast(`üöÄ ${name} Îß§Ïàò Ï£ºÎ¨∏ Ï†ÑÏÜ° Ï§ë...`, 'info');

                const response = await fetch('/api/quick-buy', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        stock_code: code,
                        stock_name: name,
                        price: price
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showToast(`‚úÖ ${name} Îß§Ïàò Ï£ºÎ¨∏ ÏôÑÎ£å!`, 'success');
                    showBrowserNotification('Îß§Ïàò ÏôÑÎ£å', `${name} Îß§Ïàò Ï£ºÎ¨∏Ïù¥ Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§.`, 'success');
                    playAlertSound('success');
                    loadAllData(); // Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
                } else {
                    showToast(`‚ùå Îß§Ïàò Ïã§Ìå®: ${data.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`, 'error');
                }
            } catch (error) {
                console.error('Quick buy error:', error);
                showToast(`‚ùå Îß§Ïàò Ïò§Î•ò: ${error.message}`, 'error');
            }
        }

        function updateStatus(data) {
            if (data && data.scanning) {
                const scanningCount = document.getElementById('scanning-count');
                const analyzedCount = document.getElementById('analyzed-count');

                if (scanningCount) {
                    scanningCount.textContent = data.scanning.fast_scan?.count || 0;
                }
                if (analyzedCount) {
                    analyzedCount.textContent = data.scanning.ai_scan?.count || 0;
                }
            }
        }

        function updateTradingActivity(data) {
            const container = document.getElementById('trading-activity');

            if (!data || !data.activities || data.activities.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 12px;">Îß§Îß§ ÌôúÎèô ÏóÜÏùå</div>';
                return;
            }

            let html = '';
            data.activities.slice(0, 5).forEach(act => {
                const typeClass = act.type === 'BUY' ? 'buy' : 'sell';
                html += `
                    <div class="activity-item ${typeClass}">
                        <div class="activity-time">${act.time}</div>
                        <div class="activity-text">${act.message}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Update compact sections in right panel
        function updatePortfolioSummary(account, positions) {
            const container = document.getElementById('portfolio-summary');

            if (!account) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 11px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
                return;
            }

            const totalAssets = account.total_assets || 0;
            const cash = account.cash || 0;
            const stockValue = account.stock_value || 0;
            const pl = account.profit_loss || 0;
            const plColor = pl >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ

            let html = `
                <div style="margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color);">
                    <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Ï¥ù ÏûêÏÇ∞</div>
                    <div style="font-size: 16px; font-weight: 700;">‚Ç©${formatNumber(totalAssets)}</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <div>
                        <div style="font-size: 10px; color: var(--text-secondary);">ÌòÑÍ∏à</div>
                        <div style="font-size: 12px; font-weight: 600;">‚Ç©${formatNumber(cash)}</div>
                    </div>
                    <div>
                        <div style="font-size: 10px; color: var(--text-secondary);">Ï£ºÏãù</div>
                        <div style="font-size: 12px; font-weight: 600;">‚Ç©${formatNumber(stockValue)}</div>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding: 6px; background: rgba(59, 130, 246, 0.05); border-radius: 4px;">
                    <div style="font-size: 10px; color: var(--text-secondary);">ÏàòÏùµ/ÏÜêÏã§</div>
                    <div style="font-size: 12px; font-weight: 700; color: ${plColor};">
                        ${pl >= 0 ? '+' : ''}‚Ç©${formatNumber(Math.abs(pl))}
                    </div>
                </div>
            `;

            // Add top 3 positions - v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ
            if (positions && positions.length > 0) {
                html += '<div style="border-top: 1px solid var(--border-color); padding-top: 10px;">';
                html += '<div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 6px;">Ï£ºÏöî Î≥¥Ïú†Ï¢ÖÎ™©</div>';
                positions.slice(0, 3).forEach(p => {
                    const posPlColor = p.profit_loss >= 0 ? '#ef4444' : '#3b82f6';  // ÌïúÍµ≠Ïãù ÏÉâÏÉÅ
                    html += `
                        <div style="padding: 5px; border-left: 2px solid ${posPlColor}; margin-bottom: 6px; padding-left: 6px; cursor: pointer;" onclick="loadChartData('${p.code}')">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                <span style="font-size: 11px; font-weight: 600;">${p.name}</span>
                                <span style="font-size: 11px; font-weight: 700; color: ${posPlColor};">
                                    ${p.profit_loss >= 0 ? '+' : ''}${p.profit_loss_percent.toFixed(1)}%
                                </span>
                            </div>
                            <div style="font-size: 10px; color: var(--text-secondary);">
                                ${p.quantity}Ï£º √ó ‚Ç©${formatNumber(p.current_price)}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }

            container.innerHTML = html;
        }

        async function updateProgramMonitor() {
            try {
                // Fetch scan progress
                const scanResponse = await fetch('/api/scan-progress');
                const scanData = await scanResponse.json();

                // Update scan status
                document.getElementById('current-strategy').textContent = scanData.current_strategy || 'ÎåÄÍ∏∞ Ï§ë';
                document.getElementById('total-candidates').textContent = (scanData.total_candidates || 0) + 'Í∞ú';
                document.getElementById('reviewing-stock').textContent = scanData.reviewing || '-';
                document.getElementById('approved-count').textContent = (scanData.approved || []).length;
                document.getElementById('rejected-count').textContent = (scanData.rejected || []).length;

                // Fetch recent activities
                const activitiesResponse = await fetch('/api/activities');
                const activities = await activitiesResponse.json();

                // Update system activities
                const activitiesContainer = document.getElementById('system-activities');
                if (!activities || activities.length === 0) {
                    activitiesContainer.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 11px;">ÏãúÏä§ÌÖú ÌôúÎèô ÏóÜÏùå</div>';
                    return;
                }

                let html = '';
                activities.slice(0, 8).forEach(act => {
                    // LevelÏóê Îî∞Î•∏ ÏÉâÏÉÅ ÏÑ§Ï†ï
                    let levelColor = 'var(--text-secondary)';
                    let levelIcon = 'fa-info-circle';
                    if (act.level === 'success') {
                        levelColor = 'var(--color-success)';
                        levelIcon = 'fa-check-circle';
                    } else if (act.level === 'error') {
                        levelColor = 'var(--color-danger)';
                        levelIcon = 'fa-exclamation-circle';
                    } else if (act.level === 'warning') {
                        levelColor = 'var(--color-warning)';
                        levelIcon = 'fa-exclamation-triangle';
                    }

                    // TypeÏóê Îî∞Î•∏ Î∞∞Í≤ΩÏÉâ
                    let bgColor = 'rgba(255, 255, 255, 0.02)';
                    if (act.type === 'BUY') {
                        bgColor = 'rgba(16, 185, 129, 0.05)';
                    } else if (act.type === 'SELL') {
                        bgColor = 'rgba(239, 68, 68, 0.05)';
                    }

                    html += `
                        <div style="padding: 8px; background: ${bgColor}; border-radius: 4px; margin-bottom: 6px; border-left: 3px solid ${levelColor};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px;">
                                <div style="font-size: 9px; color: var(--text-muted);">${act.time}</div>
                                <i class="fas ${levelIcon}" style="font-size: 9px; color: ${levelColor};"></i>
                            </div>
                            <div style="font-size: 10px; color: var(--text-primary); line-height: 1.4;">${act.message}</div>
                        </div>
                    `;
                });

                activitiesContainer.innerHTML = html;
            } catch (error) {
                console.error('Program monitor update error:', error);
            }
        }

        function updateCandidatesCompact(candidates) {
            const container = document.getElementById('candidates-list');

            if (!candidates || candidates.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 11px;">ÌõÑÎ≥¥ Ï¢ÖÎ™© ÏóÜÏùå</div>';
                return;
            }

            let html = '';
            candidates.slice(0, 8).forEach(c => {
                html += `
                    <div style="padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;"
                         onclick="loadChartData('${c.code}')"
                         onmouseover="this.style.borderColor='var(--color-primary)'; this.style.transform='translateY(-1px)'"
                         onmouseout="this.style.borderColor='var(--border-color)'; this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                            <div style="font-size: 12px; font-weight: 600;">${c.name}</div>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;">
                                ${c.ai_score.toFixed(1)}
                            </div>
                        </div>
                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">
                            ${c.code} ¬∑ ‚Ç©${formatNumber(c.price)}
                        </div>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            <span style="padding: 2px 6px; border-radius: 3px; font-size: 9px; font-weight: 600; background: rgba(16, 185, 129, 0.1); color: var(--color-success);">
                                ${c.signal || 'BUY'}
                            </span>
                            <span style="padding: 2px 6px; border-radius: 3px; font-size: 9px; font-weight: 600; background: rgba(59, 130, 246, 0.1); color: var(--color-primary);">
                                ${Math.round((c.confidence || 0.85) * 100)}%
                            </span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Load AI Analysis
        async function loadAIAnalysis() {
            try {
                const response = await fetch('/api/ai/auto-analysis');
                const data = await response.json();

                if (data.success) {
                    // Update quick metrics
                    if (data.portfolio) {
                        document.getElementById('ai-portfolio-score').textContent = data.portfolio.score.toFixed(1) + '/10';
                        document.getElementById('ai-portfolio-desc').textContent = data.portfolio.health || 'ÏñëÌò∏';
                    }

                    if (data.sentiment) {
                        document.getElementById('ai-sentiment').textContent = data.sentiment.sentiment || '-';
                        document.getElementById('ai-sentiment-desc').textContent = `Ï†êÏàò: ${data.sentiment.overall_sentiment}/10`;
                    }

                    if (data.risk) {
                        document.getElementById('ai-risk').textContent = data.risk.risk_level || '-';
                        document.getElementById('ai-risk-desc').textContent = `VaR: ${formatNumber(data.risk.var)}Ïõê`;
                    }

                    // Update detailed analysis
                    updatePortfolioAnalysis(data.portfolio);
                    updateRiskAnalysis(data.risk);
                    updateMultiAgentConsensus(data.consensus);
                }

                // v5.7.5: Load new features
                loadMarketTrend();
                loadStockRecommendations();
            } catch (error) {
                console.error('AI analysis error:', error);
            }
        }

        function updatePortfolioAnalysis(data) {
            const container = document.getElementById('portfolio-analysis');
            if (!data) {
                container.innerHTML = '<div class="loading"><p style="font-size: 12px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</p></div>';
                return;
            }

            let html = '';
            (data.recommendations || []).slice(0, 5).forEach(rec => {
                html += `<div class="metric-row"><span class="metric-label">${rec}</span></div>`;
            });

            container.innerHTML = html || '<div style="font-size: 12px; color: var(--text-secondary);">Í∂åÏû•ÏÇ¨Ìï≠ ÏóÜÏùå</div>';
        }

        function updateRiskAnalysis(data) {
            const container = document.getElementById('risk-analysis');
            if (!data) {
                container.innerHTML = '<div class="loading"><p style="font-size: 12px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</p></div>';
                return;
            }

            let html = `
                <div class="metric-row">
                    <span class="metric-label">VaR (95%)</span>
                    <span class="metric-value">${formatNumber(data.var || 0)}Ïõê</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">CVaR</span>
                    <span class="metric-value">${formatNumber(data.cvar || 0)}Ïõê</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Î≥ÄÎèôÏÑ±</span>
                    <span class="metric-value">${(data.volatility || 0).toFixed(1)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ÏÉ§ÌîÑ ÎπÑÏú®</span>
                    <span class="metric-value">${(data.sharpe_ratio || 0).toFixed(2)}</span>
                </div>
            `;

            container.innerHTML = html;
        }

        function updateMultiAgentConsensus(data) {
            const container = document.getElementById('multiagent-consensus');
            if (!data) {
                container.innerHTML = '<div class="loading"><p style="font-size: 12px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</p></div>';
                return;
            }

            let html = `
                <div class="metric-row">
                    <span class="metric-label">ÏµúÏ¢Ö Í≤∞Ï†ï</span>
                    <span class="metric-value">${(data.final_action || 'HOLD').toUpperCase()}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Ìï©ÏùòÎèÑ</span>
                    <span class="metric-value">${((data.consensus_level || 0) * 100).toFixed(0)}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Ïã†Î¢∞ÎèÑ</span>
                    <span class="metric-value">${((data.confidence || 0) * 100).toFixed(0)}%</span>
                </div>
            `;

            if (data.votes) {
                html += '<div style="margin-top: 10px; font-size: 11px; color: var(--text-secondary);">Ìà¨Ìëú Í≤∞Í≥º:</div>';
                for (const [action, count] of Object.entries(data.votes)) {
                    html += `<div class="metric-row"><span class="metric-label">${action.toUpperCase()}</span><span>${count}Ìëú</span></div>`;
                }
            }

            container.innerHTML = html;
        }

        // v5.7.5: Load Market Trend Analysis
        async function loadMarketTrend() {
            try {
                const response = await fetch('/api/ai/market-trend');
                const data = await response.json();

                const container = document.getElementById('market-trend-analysis');
                if (!data.success || !data.trend) {
                    container.innerHTML = '<div style="padding: 15px; color: var(--text-secondary); font-size: 12px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
                    return;
                }

                const trend = data.trend;
                const trendColor = trend.trend === 'Bullish' ? 'var(--color-success)' :
                                 trend.trend === 'Bearish' ? 'var(--color-danger)' :
                                 'var(--text-secondary)';

                let html = `
                    <div style="padding: 15px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                            <div style="font-size: 24px; font-weight: 700; color: ${trendColor};">
                                ${trend.trend}
                            </div>
                            <div style="font-size: 16px; color: var(--text-secondary);">
                                Í∞ïÎèÑ: ${trend.strength}/10
                            </div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; margin-bottom: 10px;">
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">Í∂åÏû•ÏÇ¨Ìï≠</div>
                            <div style="font-size: 14px; color: var(--text-primary);">${trend.recommendation}</div>
                        </div>
                `;

                if (trend.indicators && trend.indicators.length > 0) {
                    html += '<div style="font-size: 11px; color: var(--text-secondary); margin-top: 10px;">ÏßÄÌëú:</div>';
                    trend.indicators.forEach(indicator => {
                        html += `<div style="font-size: 12px; padding: 5px 0; border-bottom: 1px solid var(--border-color);">‚Ä¢ ${indicator}</div>`;
                    });
                }

                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Market trend error:', error);
                document.getElementById('market-trend-analysis').innerHTML =
                    '<div style="padding: 15px; color: var(--color-danger); font-size: 12px;">Ïò§Î•ò Î∞úÏÉù</div>';
            }
        }

        // v5.7.5: Load AI Alerts
        async function loadAIAlerts() {
            try {
                const response = await fetch('/api/ai/alerts');
                const data = await response.json();

                if (!data.success || !data.alerts || data.alerts.length === 0) {
                    document.getElementById('ai-alerts-section').style.display = 'none';
                    return;
                }

                // Show alerts section
                document.getElementById('ai-alerts-section').style.display = 'block';
                document.getElementById('alert-count').textContent = data.alerts.length;

                // Build alerts list
                let html = '';
                data.alerts.forEach(alert => {
                    const iconMap = {
                        'stop_loss': 'fa-exclamation-triangle',
                        'take_profit': 'fa-check-circle',
                        'warning': 'fa-exclamation-circle'
                    };

                    html += `
                        <div style="padding: 12px; border-bottom: 1px solid var(--border-color); border-left: 3px solid ${alert.color}; background: ${alert.color}08;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <div style="font-weight: 600; font-size: 13px; color: ${alert.color};">
                                    <i class="fas ${iconMap[alert.type] || 'fa-bell'}"></i> ${alert.stock}
                                </div>
                                <span style="background: ${alert.color}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 700;">
                                    ${alert.action}
                                </span>
                            </div>
                            <div style="font-size: 12px; color: var(--text-primary);">${alert.message}</div>
                        </div>
                    `;
                });

                document.getElementById('ai-alerts-list').innerHTML = html;
            } catch (error) {
                console.error('AI alerts error:', error);
                document.getElementById('ai-alerts-section').style.display = 'none';
            }
        }

        // v5.7.5: Load Position Monitor
        async function loadPositionMonitor() {
            try {
                const response = await fetch('/api/ai/position-monitor');
                const data = await response.json();

                const container = document.getElementById('position-monitor');
                if (!data.success || !data.positions || data.positions.length === 0) {
                    container.innerHTML = '<div style="padding: 15px; color: var(--text-secondary); font-size: 12px;">Î≥¥Ïú† Ï¢ÖÎ™© ÏóÜÏùå</div>';
                    return;
                }

                // Update performance summary
                const summary = data.summary;
                document.getElementById('perf-total-value').textContent = '‚Ç©' + formatNumber(summary.total_value);
                document.getElementById('perf-total-profit').textContent = (summary.total_profit >= 0 ? '+' : '') + '‚Ç©' + formatNumber(summary.total_profit);
                document.getElementById('perf-total-profit').style.color = summary.total_profit >= 0 ? 'var(--color-success)' : 'var(--color-danger)';
                document.getElementById('perf-profit-pct').textContent = (summary.total_profit_pct >= 0 ? '+' : '') + summary.total_profit_pct.toFixed(2) + '%';
                document.getElementById('perf-profit-pct').style.color = summary.total_profit_pct >= 0 ? 'var(--color-success)' : 'var(--color-danger)';
                const winRate = summary.holding_count > 0 ? (summary.winning_count / summary.holding_count * 100).toFixed(1) : 0;
                document.getElementById('perf-win-rate').textContent = winRate + '%';

                // Show alerts if any
                if (data.alerts && data.alerts.length > 0) {
                    document.getElementById('ai-alerts-container').style.display = 'block';
                    let alertsHtml = '';
                    data.alerts.forEach(alert => {
                        alertsHtml += `<div style="padding: 8px; background: white; border-radius: 4px; margin-bottom: 5px; color: #991b1b;">
                            <strong>${alert.stock}</strong>: ${alert.message}
                        </div>`;
                    });
                    document.getElementById('ai-alerts').innerHTML = alertsHtml;
                } else {
                    document.getElementById('ai-alerts-container').style.display = 'none';
                }

                // Build positions table
                let html = `
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr style="background: var(--bg-secondary); text-align: left;">
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">Ï¢ÖÎ™©</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">Îß§ÏûÖÍ∞Ä</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">ÌòÑÏû¨Í∞Ä</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">ÏÜêÏùµÎ•†</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">AI Îì±Í∏â</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">Ïã†Ìò∏</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">ÏÜêÏ†àÍ∞Ä</th>
                                <th style="padding: 10px; border-bottom: 1px solid var(--border-color);">ÏùµÏ†àÍ∞Ä</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                data.positions.forEach(pos => {
                    const profitColor = pos.profit_pct >= 0 ? 'var(--color-success)' : 'var(--color-danger)';
                    const gradeColor = pos.ai_grade === 'S' ? '#fbbf24' :
                                     pos.ai_grade === 'A' ? '#10b981' :
                                     pos.ai_grade === 'B' ? '#3b82f6' : '#9ca3af';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border-color);" onmouseover="this.style.background='var(--bg-primary)'" onmouseout="this.style.background='transparent'">
                            <td style="padding: 10px;">
                                <div style="font-weight: 600;">${pos.name}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">${pos.code}</div>
                            </td>
                            <td style="padding: 10px;">‚Ç©${formatNumber(pos.buy_price)}</td>
                            <td style="padding: 10px;">‚Ç©${formatNumber(pos.current_price)}</td>
                            <td style="padding: 10px; color: ${profitColor}; font-weight: 600;">
                                ${pos.profit_pct >= 0 ? '+' : ''}${pos.profit_pct}%
                                <div style="font-size: 10px;">${pos.profit >= 0 ? '+' : ''}‚Ç©${formatNumber(pos.profit)}</div>
                            </td>
                            <td style="padding: 10px;">
                                <span style="background: ${gradeColor}; color: black; padding: 2px 8px; border-radius: 4px; font-weight: 700;">${pos.ai_grade}</span>
                                <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">${pos.ai_score.toFixed(0)}Ï†ê</div>
                            </td>
                            <td style="padding: 10px;">
                                <div style="color: ${pos.signal_color}; font-weight: 600;">${pos.signal}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">${pos.signal_reason}</div>
                            </td>
                            <td style="padding: 10px; color: var(--color-danger);">‚Ç©${formatNumber(pos.stop_loss_price)}</td>
                            <td style="padding: 10px; color: var(--color-success);">‚Ç©${formatNumber(pos.take_profit_price)}</td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Position monitor error:', error);
                document.getElementById('position-monitor').innerHTML =
                    '<div style="padding: 15px; color: var(--color-danger); font-size: 12px;">Ïò§Î•ò Î∞úÏÉù</div>';
            }
        }

        // v5.7.5: Load Portfolio Optimization
        async function loadPortfolioOptimization() {
            try {
                const response = await fetch('/api/ai/portfolio-optimization');
                const data = await response.json();

                const container = document.getElementById('portfolio-optimization');
                if (!data.success || !data.optimization) {
                    container.innerHTML = '<div style="padding: 15px; color: var(--text-secondary); font-size: 12px;">Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
                    return;
                }

                const opt = data.optimization;
                const statusColor = opt.status === 'optimal' ? 'var(--color-success)' :
                                  opt.status === 'needs_attention' ? 'var(--color-warning)' : 'var(--color-danger)';

                let html = `
                    <div style="padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <div style="font-size: 11px; color: var(--text-secondary);">ÏÉÅÌÉú</div>
                                <div style="font-size: 18px; font-weight: 700; color: ${statusColor};">
                                    ${opt.status === 'optimal' ? '‚úì ÏµúÏ†ÅÌôîÎê®' : '‚ö† Ï°∞Ï†ï ÌïÑÏöî'}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 11px; color: var(--text-secondary);">Î¶¨Ïä§ÌÅ¨</div>
                                <div style="font-size: 18px; font-weight: 700;">${opt.risk_level}</div>
                            </div>
                        </div>
                `;

                // Show suggestions
                if (opt.suggestions && opt.suggestions.length > 0) {
                    html += '<div style="margin-top: 15px;">';
                    opt.suggestions.forEach(sug => {
                        const icon = sug.type === 'warning' ? '‚ö†' :
                                   sug.type === 'info' ? '‚Ñπ' : '‚Üí';
                        const bgColor = sug.type === 'warning' ? '#fff1f2' :
                                      sug.type === 'info' ? '#eff6ff' : '#f0fdf4';
                        const borderColor = sug.type === 'warning' ? '#ef4444' :
                                          sug.type === 'info' ? '#3b82f6' : '#10b981';

                        html += `
                            <div style="background: ${bgColor}; border-left: 3px solid ${borderColor}; padding: 10px; margin-bottom: 8px; border-radius: 4px;">
                                <div style="font-size: 12px; font-weight: 600; margin-bottom: 4px;">${icon} ${sug.title}</div>
                                <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 4px;">${sug.message}</div>
                                <div style="font-size: 11px; color: var(--color-primary);">‚Üí ${sug.action}</div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                // Show weights
                if (opt.weights && opt.weights.length > 0) {
                    html += '<div style="margin-top: 15px; font-size: 11px; color: var(--text-secondary);">Ï¢ÖÎ™© ÎπÑÏ§ë:</div>';
                    opt.weights.forEach(w => {
                        const barWidth = Math.min(w.weight, 100);
                        html += `
                            <div style="margin-top: 5px;">
                                <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 2px;">
                                    <span>${w.name}</span>
                                    <span style="font-weight: 600;">${w.weight.toFixed(1)}%</span>
                                </div>
                                <div style="width: 100%; height: 6px; background: var(--bg-secondary); border-radius: 3px; overflow: hidden;">
                                    <div style="width: ${barWidth}%; height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6);"></div>
                                </div>
                            </div>
                        `;
                    });
                }

                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Portfolio optimization error:', error);
                document.getElementById('portfolio-optimization').innerHTML =
                    '<div style="padding: 15px; color: var(--color-danger); font-size: 12px;">Ïò§Î•ò Î∞úÏÉù</div>';
            }
        }

        // v5.7.5: Load Stock Recommendations
        async function loadStockRecommendations() {
            try {
                const response = await fetch('/api/ai/stock-recommendations');
                const data = await response.json();

                const container = document.getElementById('stock-recommendations');
                if (!data.success || !data.recommendations || data.recommendations.length === 0) {
                    container.innerHTML = '<div style="padding: 15px; color: var(--text-secondary); font-size: 12px;">Ï∂îÏ≤ú Ï¢ÖÎ™© ÏóÜÏùå</div>';
                    return;
                }

                let html = '<div style="padding: 10px;">';
                data.recommendations.forEach((rec, idx) => {
                    const gradeColor = rec.grade === 'S' ? '#fbbf24' :
                                     rec.grade === 'A' ? '#10b981' :
                                     rec.grade === 'B' ? '#3b82f6' : '#9ca3af';

                    const changeColor = rec.change_rate >= 0 ? 'var(--color-success)' : 'var(--color-danger)';

                    html += `
                        <div style="background: var(--bg-secondary); padding: 12px; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s;"
                             onmouseover="this.style.background='var(--bg-primary)'"
                             onmouseout="this.style.background='var(--bg-secondary)'"
                             onclick="searchStock('${rec.code}', '${rec.name}')">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <div style="font-weight: 600; font-size: 13px;">${rec.name}</div>
                                <div style="background: ${gradeColor}; color: black; padding: 2px 8px; border-radius: 4px; font-weight: 700; font-size: 11px;">${rec.grade}</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-secondary);">
                                <span>‚Ç©${formatNumber(rec.price)}</span>
                                <span style="color: ${changeColor};">${rec.change_rate >= 0 ? '+' : ''}${rec.change_rate.toFixed(2)}%</span>
                            </div>
                            <div style="margin-top: 5px; font-size: 10px; color: var(--text-muted);">
                                Ï†êÏàò: ${rec.score.toFixed(0)}/${rec.percentage.toFixed(0)}% ‚Ä¢ ${rec.reason}
                            </div>
                        </div>
                    `;
                });
                html += '</div>';

                container.innerHTML = html;
            } catch (error) {
                console.error('Stock recommendations error:', error);
                document.getElementById('stock-recommendations').innerHTML =
                    '<div style="padding: 15px; color: var(--color-danger); font-size: 12px;">Ïò§Î•ò Î∞úÏÉù</div>';
            }
        }

        // Initialize Paper Equity Chart
        function initializePaperEquityChart() {
            const ctx = document.getElementById('paper-equity-chart');
            if (!ctx) {
                console.log('Paper equity chart canvas not found - skipping initialization');
                return;
            }

            paperEquityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ÏÜêÏùµ',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: true, grid: { color: '#2d3250' } },
                        y: { display: true, grid: { color: '#2d3250' } }
                    }
                }
            });
        }

        // Load Paper Trading Data
        async function loadPaperTradingData() {
            try {
                const response = await fetch('/api/virtual_trading/status');
                const data = await response.json();

                if (data.success && data.enabled && data.strategies) {
                    updateVirtualStrategies(data.strategies, data.best_strategy);

                    // Load recent trades
                    const tradesResponse = await fetch('/api/virtual_trading/trades?limit=20');
                    const tradesData = await tradesResponse.json();
                    if (tradesData.success) {
                        updateVirtualTrades(tradesData.trades);
                    }
                }
            } catch (error) {
                console.error('Virtual trading data error:', error);
            }
        }

        /**
         * v5.7.4: 10Í∞ú Ï†ÑÎûµ ÎèôÏ†Å ÏÉùÏÑ± Î∞è ÌëúÏãú
         * ÌïúÍµ≠Ïãù ÏÉâÏÉÅ: Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë
         * Î∂ÄÎìúÎü¨Ïö¥ Ïà´Ïûê Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©
         */
        function updateVirtualStrategies(strategies, bestStrategy) {
            const container = document.getElementById('virtual-strategies-grid');

            // Ï†ÑÎûµ ÏïÑÏù¥ÏΩò Îß§Ìïë
            const strategyIcons = {
                'Î™®Î©òÌÖÄÏ∂îÏÑ∏': 'fa-rocket',
                'ÌèâÍ∑†ÌöåÍ∑Ä': 'fa-chart-line',
                'ÎèåÌååÎß§Îß§': 'fa-bolt',
                'Í∞ÄÏπòÌà¨Ïûê': 'fa-gem',
                'Ïä§ÏúôÎß§Îß§': 'fa-wave-square',
                'MACDÌÅ¨Î°úÏä§': 'fa-exchange-alt',
                'Ïó≠Î∞úÏÉÅ': 'fa-undo',
                'ÏÑπÌÑ∞ÏàúÌôò': 'fa-sync',
                'Í∏âÎì±Ï∂îÍ≤©': 'fa-fire',
                'Î∞∞ÎãπÏÑ±Ïû•': 'fa-seedling'
            };

            // Ï†ÑÎûµ ÏÉâÏÉÅ Îß§Ìïë
            const strategyColors = {
                'Î™®Î©òÌÖÄÏ∂îÏÑ∏': '#3b82f6',
                'ÌèâÍ∑†ÌöåÍ∑Ä': '#10b981',
                'ÎèåÌååÎß§Îß§': '#f59e0b',
                'Í∞ÄÏπòÌà¨Ïûê': '#8b5cf6',
                'Ïä§ÏúôÎß§Îß§': '#ec4899',
                'MACDÌÅ¨Î°úÏä§': '#06b6d4',
                'Ïó≠Î∞úÏÉÅ': '#f97316',
                'ÏÑπÌÑ∞ÏàúÌôò': '#14b8a6',
                'Í∏âÎì±Ï∂îÍ≤©': '#ef4444',
                'Î∞∞ÎãπÏÑ±Ïû•': '#84cc16'
            };

            // Ï≤´ Î†åÎçîÎßÅÏù∏ÏßÄ ÌôïÏù∏
            const isFirstRender = container.children.length === 0 ||
                                  container.querySelector('.spinner');

            if (isFirstRender) {
                // Ï†ÑÎûµ Ïπ¥Îìú Ï¥àÍ∏∞ ÏÉùÏÑ±
                let html = '';

                Object.entries(strategies).forEach(([name, summary]) => {
                    const icon = strategyIcons[name] || 'fa-chart-bar';
                    const color = strategyColors[name] || '#3b82f6';
                    const returnPct = summary.total_pnl_rate || 0;

                    // ÌïúÍµ≠Ïãù ÏÉâÏÉÅ: Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë
                    const returnColor = returnPct >= 0 ? '#ef4444' : '#3b82f6';
                    const returnBg = returnPct >= 0 ? 'rgba(239, 68, 68, 0.1)' : 'rgba(59, 130, 246, 0.1)';

                html += `
                    <div class="card" style="position: relative; overflow: hidden;">
                        <!-- Ï†ÑÎûµ Ìó§Îçî -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 36px; height: 36px; border-radius: 8px; background: ${color}; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas ${icon}" style="font-size: 16px; color: white;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);">${name}</div>
                                    <div style="font-size: 10px; color: var(--text-muted);">Strategy ${Object.keys(strategies).indexOf(name) + 1}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ï£ºÏöî ÏßÄÌëú -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                            <div style="background: var(--bg-secondary); padding: 10px; border-radius: 6px;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">Ï¥ù ÏûêÏÇ∞</div>
                                <div id="strategy-${name}-assets" class="strategy-number" style="font-size: 13px; font-weight: 700; color: var(--text-primary);">
                                    ‚Ç©${formatNumber(Math.round(summary.total_value || 0))}
                                </div>
                            </div>
                            <div style="background: ${returnBg}; padding: 10px; border-radius: 6px; border: 1px solid ${returnColor}20;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">ÏàòÏùµÎ•†</div>
                                <div id="strategy-${name}-return" class="strategy-number" style="font-size: 13px; font-weight: 700; color: ${returnColor};">
                                    ${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%
                                </div>
                            </div>
                        </div>

                        <!-- ÌïòÏúÑ ÏßÄÌëú -->
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <div style="text-align: center; flex: 1;">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">Ìè¨ÏßÄÏÖò</div>
                                <div id="strategy-${name}-positions" class="strategy-number" style="font-size: 12px; font-weight: 600; color: var(--text-primary);">
                                    ${summary.position_count || 0}Í∞ú
                                </div>
                            </div>
                            <div style="text-align: center; flex: 1; border-left: 1px solid var(--border-color);">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">ÏäπÎ•†</div>
                                <div id="strategy-${name}-winrate" class="strategy-number" style="font-size: 12px; font-weight: 600; color: var(--text-primary);">
                                    ${(summary.win_rate || 0).toFixed(1)}%
                                </div>
                            </div>
                            <div style="text-align: center; flex: 1; border-left: 1px solid var(--border-color);">
                                <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 3px;">Í±∞Îûò</div>
                                <div id="strategy-${name}-trades" class="strategy-number" style="font-size: 12px; font-weight: 600; color: var(--text-primary);">
                                    ${summary.total_trades || 0}Ìöå
                                </div>
                            </div>
                        </div>

                        <!-- ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <button onclick="toggleStrategyDetails('${name}')"
                                    style="width: 100%; padding: 6px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary); font-size: 11px; cursor: pointer; transition: all 0.2s;">
                                <i class="fas fa-chevron-down"></i> ÏÉÅÏÑ∏ Î≥¥Í∏∞
                            </button>
                        </div>

                        <!-- ÏÉÅÏÑ∏ Ï†ïÎ≥¥ (Ïà®ÍπÄ) -->
                        <div id="strategy-${name}-details" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <div id="strategy-${name}-positions-list"></div>
                        </div>
                    </div>
                `;
                });

                container.innerHTML = html;
            } else {
                // Í∏∞Ï°¥ Ïπ¥Îìú ÏóÖÎç∞Ïù¥Ìä∏ (Î∂ÄÎìúÎü¨Ïö¥ Ïï†ÎãàÎ©îÏù¥ÏÖò)
                Object.entries(strategies).forEach(([name, summary]) => {
                    const returnPct = summary.total_pnl_rate || 0;
                    const returnColor = returnPct >= 0 ? '#ef4444' : '#3b82f6';

                    // ÏûêÏÇ∞ Ïï†ÎãàÎ©îÏù¥ÏÖò
                    const assetsEl = document.getElementById(`strategy-${name}-assets`);
                    if (assetsEl) {
                        const newValue = Math.round(summary.total_value || 0);
                        const currentValue = parseInt(assetsEl.textContent.replace(/[^0-9]/g, '')) || 0;
                        if (newValue !== currentValue) {
                            smoothUpdateNumber(`strategy-${name}-assets`, newValue, '‚Ç©', '', 500);
                        }
                    }

                    // ÏàòÏùµÎ•† ÏóÖÎç∞Ïù¥Ìä∏ (Ïï†ÎãàÎ©îÏù¥ÏÖò)
                    const returnEl = document.getElementById(`strategy-${name}-return`);
                    if (returnEl) {
                        returnEl.textContent = `${returnPct >= 0 ? '+' : ''}${returnPct.toFixed(2)}%`;
                        returnEl.style.color = returnColor;
                    }

                    // Ìè¨ÏßÄÏÖò Ïàò Ïï†ÎãàÎ©îÏù¥ÏÖò
                    const posEl = document.getElementById(`strategy-${name}-positions`);
                    if (posEl) {
                        posEl.textContent = `${summary.position_count || 0}Í∞ú`;
                    }

                    // ÏäπÎ•† Ïï†ÎãàÎ©îÏù¥ÏÖò
                    const winRateEl = document.getElementById(`strategy-${name}-winrate`);
                    if (winRateEl) {
                        winRateEl.textContent = `${(summary.win_rate || 0).toFixed(1)}%`;
                    }

                    // Í±∞Îûò ÌöüÏàò Ïï†ÎãàÎ©îÏù¥ÏÖò
                    const tradesEl = document.getElementById(`strategy-${name}-trades`);
                    if (tradesEl) {
                        tradesEl.textContent = `${summary.total_trades || 0}Ìöå`;
                    }
                });
            }

            // Best Strategy Banner ÏóÖÎç∞Ïù¥Ìä∏
            if (bestStrategy) {
                document.getElementById('best-strategy-banner').style.display = 'block';
                document.getElementById('best-strategy-name').textContent = bestStrategy.name || bestStrategy;

                const bestData = strategies[bestStrategy.name || bestStrategy];
                if (bestData) {
                    const returnPct = bestData.total_pnl_rate || 0;
                    const returnEl = document.getElementById('best-strategy-return');
                    returnEl.textContent = (returnPct >= 0 ? '+' : '') + returnPct.toFixed(2) + '%';
                    // ÌïúÍµ≠Ïãù ÏÉâÏÉÅ Ï†ÅÏö©
                    returnEl.style.color = returnPct >= 0 ? '#ef4444' : '#3b82f6';
                }
            }
        }

        function updateVirtualTrades(trades) {
            const container = document.getElementById('virtual-trades-list');

            if (!trades || trades.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 15px; color: var(--text-secondary); font-size: 12px;">Îß§Îß§ Í∏∞Î°ù ÏóÜÏùå</div>';
                return;
            }

            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            trades.slice(0, 20).forEach(trade => {
                const typeClass = trade.action === 'buy' ? 'buy' : 'sell';
                const plClass = (trade.profit_loss || 0) >= 0 ? 'positive' : 'negative';
                html += `
                    <div class="activity-item ${typeClass}" style="background: var(--bg-card); padding: 12px; border-radius: 8px; border-left: 3px solid ${trade.action === 'buy' ? '#10b981' : '#ef4444'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <div style="font-weight: 600; color: var(--text-primary);">
                                ${trade.stock_name} (${trade.stock_code})
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                ${trade.strategy} ¬∑ ${trade.timestamp || trade.date}
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px;">
                            <span style="color: var(--text-secondary);">
                                <strong style="text-transform: uppercase;">${trade.action}</strong> ${trade.quantity}Ï£º @ ‚Ç©${formatNumber(trade.price)}
                            </span>
                            ${trade.profit_loss !== undefined ?
                                `<span class="metric-value ${plClass}">${(trade.profit_loss >= 0 ? '+' : '')}‚Ç©${formatNumber(Math.abs(trade.profit_loss))} (${trade.profit_loss_pct >= 0 ? '+' : ''}${trade.profit_loss_pct.toFixed(2)}%)</span>`
                                : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        /**
         * v5.7.4: 10Í∞ú Ï†ÑÎûµ ÏÉÅÏÑ∏ Î≥¥Í∏∞ (ÌÜ†Í∏Ä)
         */
        async function toggleStrategyDetails(strategyName) {
            const detailsDiv = document.getElementById(`strategy-${strategyName}-details`);
            const positionsDiv = document.getElementById(`strategy-${strategyName}-positions-list`);

            // Toggle display
            if (detailsDiv.style.display === 'none' || !detailsDiv.style.display) {
                detailsDiv.style.display = 'block';

                // Load positions
                positionsDiv.innerHTML = '<div style="text-align: center; padding: 10px;"><div class="spinner"></div></div>';

                try {
                    const response = await fetch(`/api/virtual_trading/account/${strategyName}`);
                    const data = await response.json();

                    if (data.success && data.positions) {
                        if (data.positions.length === 0) {
                            positionsDiv.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--text-secondary); font-size: 11px;">Î≥¥Ïú† Ìè¨ÏßÄÏÖò ÏóÜÏùå</div>';
                        } else {
                            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
                            data.positions.forEach(pos => {
                                const plRate = pos.unrealized_pnl_rate || 0;
                                // ÌïúÍµ≠Ïãù ÏÉâÏÉÅ: Ïù¥Ïùµ=Îπ®Í∞ï, ÏÜêÏã§=ÌååÎûë
                                const plColor = plRate >= 0 ? '#ef4444' : '#3b82f6';
                                html += `
                                    <div style="background: var(--bg-primary); padding: 10px; border-radius: 6px; font-size: 11px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                            <span style="font-weight: 600;">${pos.stock_name} (${pos.stock_code})</span>
                                            <span style="font-weight: 700; color: ${plColor};">${(plRate >= 0 ? '+' : '')}${plRate.toFixed(2)}%</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; color: var(--text-secondary);">
                                            <span>${pos.quantity}Ï£º @ ‚Ç©${formatNumber(pos.avg_price)}</span>
                                            <span>ÌòÑÏû¨ ‚Ç©${formatNumber(pos.current_price || pos.avg_price)}</span>
                                        </div>
                                    </div>
                                `;
                            });
                            html += '</div>';
                            positionsDiv.innerHTML = html;
                        }
                    } else {
                        positionsDiv.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--error); font-size: 11px;">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®</div>';
                    }
                } catch (error) {
                    console.error('Position load error:', error);
                    positionsDiv.innerHTML = '<div style="text-align: center; padding: 10px; color: var(--error); font-size: 11px;">Ïò§Î•ò Î∞úÏÉù</div>';
                }
            } else {
                detailsDiv.style.display = 'none';
            }
        }

        // Utility Functions
        function formatNumber(num) {
            return Math.abs(num).toLocaleString('ko-KR');
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Market Explorer Functions
        document.getElementById('market-filter-type').addEventListener('change', function() {
            const sortContainer = document.getElementById('sort-option-container');
            if (this.value === 'price-change') {
                sortContainer.style.display = 'block';
            } else {
                sortContainer.style.display = 'none';
            }
        });

        async function loadMarketData() {
            try {
                const filterType = document.getElementById('market-filter-type').value;
                const market = document.getElementById('market-filter-market').value;
                const limit = document.getElementById('market-filter-limit').value;
                const sort = document.getElementById('market-filter-sort').value;

                const resultsDiv = document.getElementById('market-results');
                resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...</p></div>';

                let apiUrl = '';
                let params = `?market=${market}&limit=${limit}`;

                if (filterType === 'volume') {
                    apiUrl = '/api/market/volume-rank' + params;
                    document.getElementById('market-results-title').textContent = 'Í±∞ÎûòÎüâ ÏàúÏúÑ';
                } else if (filterType === 'trading-value') {
                    apiUrl = '/api/market/trading-value-rank' + params;
                    document.getElementById('market-results-title').textContent = 'Í±∞ÎûòÎåÄÍ∏à ÏàúÏúÑ';
                } else if (filterType === 'price-change') {
                    apiUrl = '/api/market/price-change-rank' + params + `&sort=${sort}`;
                    document.getElementById('market-results-title').textContent = sort === 'rise' ? 'ÏÉÅÏäπÎ•† ÏàúÏúÑ' : 'ÌïòÎùΩÎ•† ÏàúÏúÑ';
                }

                const response = await fetch(apiUrl);
                const result = await response.json();

                if (result.success && result.data && result.data.length > 0) {
                    displayMarketResults(result.data, filterType);
                    document.getElementById('market-results-count').textContent = `${result.data.length}Í∞ú Ï¢ÖÎ™©`;
                } else {
                    resultsDiv.innerHTML = '<div style="padding: 40px; text-align: center;"><p style="font-size: 12px; color: var(--text-secondary);">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</p></div>';
                }
            } catch (error) {
                console.error('Market data error:', error);
                document.getElementById('market-results').innerHTML = '<div style="padding: 40px; text-align: center;"><p style="font-size: 12px; color: var(--error-color);">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®</p></div>';
            }
        }

        function displayMarketResults(data, filterType) {
            const resultsDiv = document.getElementById('market-results');

            let tableHTML = `
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border-color); background: var(--bg-secondary);">
                            <th style="padding: 10px; text-align: center; font-size: 11px; color: var(--text-secondary);">ÏàúÏúÑ</th>
                            <th style="padding: 10px; text-align: left; font-size: 11px; color: var(--text-secondary);">Ï¢ÖÎ™©Î™Ö</th>
                            <th style="padding: 10px; text-align: left; font-size: 11px; color: var(--text-secondary);">Ï¢ÖÎ™©ÏΩîÎìú</th>
                            <th style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">ÌòÑÏû¨Í∞Ä</th>
                            <th style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">Îì±ÎùΩÎ•†</th>
                            <th style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">Í±∞ÎûòÎüâ</th>
                            <th style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">Í±∞ÎûòÎåÄÍ∏à</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach((item, index) => {
                const changeRate = parseFloat(item.change_rate || item.rate || 0);
                const changeClass = changeRate > 0 ? 'positive' : (changeRate < 0 ? 'negative' : '');
                const changeSymbol = changeRate > 0 ? '+' : '';

                const price = item.price || item.current_price || 0;
                const volume = item.volume || item.trading_volume || 0;
                const tradingValue = item.trading_value || item.trading_amount || 0;

                tableHTML += `
                    <tr style="border-bottom: 1px solid var(--border-color); transition: background 0.2s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='transparent'">
                        <td style="padding: 10px; text-align: center; font-size: 12px;">${index + 1}</td>
                        <td style="padding: 10px; text-align: left; font-size: 12px; font-weight: 600;">${item.name || item.stock_name || '-'}</td>
                        <td style="padding: 10px; text-align: left; font-size: 11px; color: var(--text-secondary); font-family: monospace;">${item.code || item.stock_code || '-'}</td>
                        <td style="padding: 10px; text-align: right; font-size: 12px; font-weight: 600;">‚Ç©${formatNumber(price)}</td>
                        <td style="padding: 10px; text-align: right; font-size: 12px; font-weight: 600;" class="${changeClass}">${changeSymbol}${changeRate.toFixed(2)}%</td>
                        <td style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">${formatNumber(volume)}</td>
                        <td style="padding: 10px; text-align: right; font-size: 11px; color: var(--text-secondary);">${formatNumber(tradingValue)}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            resultsDiv.innerHTML = tableHTML;
        }

        // ========================================================================
        // v4.2 NEW FEATURES
        // ========================================================================

        // Portfolio Optimization (v4.2)
        async function runPortfolioOptimization() {
            const method = document.getElementById('portfolio-method').value;
            const targetReturn = parseFloat(document.getElementById('portfolio-target-return').value);
            const riskLevel = document.getElementById('portfolio-risk-level').value;

            try {
                const response = await fetch('/api/v4.2/portfolio/optimize', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        method: method,
                        target_return: targetReturn / 100,
                        risk_level: riskLevel
                    })
                });

                const data = await response.json();

                if (data.success) {
                    const results = data.result;
                    document.getElementById('portfolio-results').style.display = 'block';
                    document.getElementById('portfolio-exp-return').textContent =
                        (results.expected_return * 100).toFixed(2) + '%';
                    document.getElementById('portfolio-volatility').textContent =
                        (results.volatility * 100).toFixed(2) + '%';
                    document.getElementById('portfolio-sharpe').textContent =
                        results.sharpe_ratio.toFixed(2);

                    // Display allocation
                    let allocationHTML = '<div style="display: grid; gap: 8px;">';
                    for (const [stock, weight] of Object.entries(results.weights)) {
                        const percentage = (weight * 100).toFixed(1);
                        allocationHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 12px;">${stock}</span>
                                <div style="flex: 1; margin: 0 10px; height: 20px; background: var(--bg-primary); border-radius: 10px; overflow: hidden;">
                                    <div style="width: ${percentage}%; height: 100%; background: var(--color-primary);"></div>
                                </div>
                                <span style="font-size: 12px; font-weight: 700; width: 50px; text-align: right;">${percentage}%</span>
                            </div>
                        `;
                    }
                    allocationHTML += '</div>';
                    document.getElementById('portfolio-allocation').innerHTML = allocationHTML;
                } else {
                    alert('Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏµúÏ†ÅÌôî Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                console.error('Portfolio optimization error:', error);
                alert('Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏµúÏ†ÅÌôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Sentiment Analysis (v4.2)
        async function analyzeSentiment() {
            const stockCode = document.getElementById('sentiment-stock-code').value;
            if (!stockCode) {
                alert('Ï¢ÖÎ™© ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
                return;
            }

            try {
                const response = await fetch(`/api/v4.2/sentiment/${stockCode}`);
                const data = await response.json();

                if (data.success) {
                    const result = data.result;
                    document.getElementById('sentiment-results').style.display = 'block';
                    document.getElementById('sentiment-overall').textContent =
                        result.overall_sentiment.toFixed(1);
                    document.getElementById('sentiment-overall').style.color =
                        result.overall_sentiment > 6 ? 'var(--color-success)' :
                        result.overall_sentiment < 4 ? 'var(--color-danger)' : 'var(--color-warning)';
                    document.getElementById('sentiment-label').textContent = result.sentiment_label;
                    document.getElementById('sentiment-news').textContent =
                        result.news_sentiment.toFixed(1);
                    document.getElementById('sentiment-social').textContent =
                        result.social_sentiment.toFixed(1);

                    // Display news
                    let newsHTML = '<ul style="list-style: none; padding: 0; margin: 0;">';
                    result.news_articles.slice(0, 5).forEach(article => {
                        newsHTML += `
                            <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                                <div style="font-size: 12px; margin-bottom: 3px;">${article.title}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">${article.source} ‚Ä¢ ${article.date}</div>
                            </li>
                        `;
                    });
                    newsHTML += '</ul>';
                    document.getElementById('sentiment-news-list').innerHTML = newsHTML;
                } else {
                    alert('Í∞êÏÑ± Î∂ÑÏÑù Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                console.error('Sentiment analysis error:', error);
                alert('Í∞êÏÑ± Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Risk Assessment (v4.2)
        async function assessRisk() {
            try {
                const response = await fetch('/api/v4.2/risk/assess', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (data.success) {
                    const result = data.result;
                    document.getElementById('risk-var').textContent =
                        '‚Ç©' + formatNumber(Math.abs(result.var_95));
                    document.getElementById('risk-cvar').textContent =
                        '‚Ç©' + formatNumber(Math.abs(result.cvar_95));
                    document.getElementById('risk-max-loss').textContent =
                        '‚Ç©' + formatNumber(Math.abs(result.max_drawdown));
                    document.getElementById('risk-level').textContent = result.risk_level;
                    document.getElementById('risk-level').style.color =
                        result.risk_level === 'Low' ? 'var(--color-success)' :
                        result.risk_level === 'High' ? 'var(--color-danger)' : 'var(--color-warning)';
                } else {
                    alert('Î¶¨Ïä§ÌÅ¨ ÌèâÍ∞Ä Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                console.error('Risk assessment error:', error);
                alert('Î¶¨Ïä§ÌÅ¨ ÌèâÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Market Regime Detection (v4.2)
        async function detectRegime() {
            try {
                const response = await fetch('/api/v4.2/regime/detect', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({})
                });

                const data = await response.json();

                if (data.success) {
                    const result = data.result;
                    document.getElementById('regime-current').textContent = result.current_regime;
                    document.getElementById('regime-current').style.color =
                        result.current_regime === 'Bull Market' ? 'var(--color-success)' :
                        result.current_regime === 'Bear Market' ? 'var(--color-danger)' : 'var(--color-warning)';
                    document.getElementById('regime-confidence').textContent =
                        `Ïã†Î¢∞ÎèÑ: ${(result.confidence * 100).toFixed(1)}%`;
                    document.getElementById('regime-volatility').textContent =
                        (result.volatility * 100).toFixed(2) + '%';
                    document.getElementById('regime-trend').textContent =
                        result.trend_strength.toFixed(2);
                    document.getElementById('regime-sentiment').textContent =
                        result.market_sentiment;

                    // Display recommendations
                    let recHTML = '<ul style="list-style: none; padding: 0; margin: 0;">';
                    result.recommended_strategies.forEach(strategy => {
                        recHTML += `
                            <li style="padding: 8px 12px; margin-bottom: 8px; background: var(--bg-primary); border-left: 3px solid var(--color-primary); border-radius: 4px;">
                                ${strategy}
                            </li>
                        `;
                    });
                    recHTML += '</ul>';
                    document.getElementById('regime-recommendations').innerHTML = recHTML;
                } else {
                    alert('Î†àÏßê Í∞êÏßÄ Ïã§Ìå®: ' + (data.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'));
                }
            } catch (error) {
                console.error('Regime detection error:', error);
                alert('Î†àÏßê Í∞êÏßÄ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // ============================================================================
        // Stock Search Functionality
        // ============================================================================

        function initializeStockSearch() {
            const searchInput = document.getElementById('stock-search-input');
            const resultsContainer = document.getElementById('stock-search-results');
            let searchTimeout;

            if (!searchInput || !resultsContainer) return;

            // Search on input
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const query = this.value.trim();

                if (query.length < 1) {
                    resultsContainer.style.display = 'none';
                    return;
                }

                // Debounce search
                searchTimeout = setTimeout(() => {
                    searchStocks(query);
                }, 300);
            });

            // Hide results when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                    resultsContainer.style.display = 'none';
                }
            });

            // Show results when focusing on input
            searchInput.addEventListener('focus', function() {
                if (resultsContainer.children.length > 0) {
                    resultsContainer.style.display = 'block';
                }
            });
        }

        async function searchStocks(query) {
            const resultsContainer = document.getElementById('stock-search-results');

            try {
                const response = await fetch(`/api/search/stocks?q=${encodeURIComponent(query)}&limit=10`);
                const data = await response.json();

                if (data.success && data.results.length > 0) {
                    let html = '';
                    data.results.forEach(stock => {
                        const changeColor = stock.change_rate >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ
                        const changeSign = stock.change_rate >= 0 ? '+' : '';
                        html += `
                            <div onclick="selectStock('${stock.code}', '${stock.name}')" style="padding: 10px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--bg-secondary)'" onmouseout="this.style.background='transparent'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600; font-size: 13px;">${stock.name}</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">${stock.code}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-weight: 600; font-size: 13px;">‚Ç©${formatNumber(stock.price)}</div>
                                        <div style="font-size: 11px; color: ${changeColor};">${changeSign}${stock.change_rate.toFixed(2)}%</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    resultsContainer.innerHTML = html;
                    resultsContainer.style.display = 'block';
                } else {
                    resultsContainer.innerHTML = '<div style="padding: 12px; text-align: center; color: var(--text-muted); font-size: 12px;">Í≤ÄÏÉâ Í≤∞Í≥º ÏóÜÏùå</div>';
                    resultsContainer.style.display = 'block';
                }
            } catch (error) {
                console.error('Stock search error:', error);
                resultsContainer.innerHTML = '<div style="padding: 12px; text-align: center; color: var(--color-danger); font-size: 12px;">Í≤ÄÏÉâ Ïò§Î•ò</div>';
                resultsContainer.style.display = 'block';
            }
        }

        function selectStock(code, name) {
            // Load chart for selected stock
            if (window.advancedChart) {
                advancedChart.loadData(code);
            } else {
                loadChartData(code);
            }

            // Clear search input and hide results
            document.getElementById('stock-search-input').value = '';
            document.getElementById('stock-search-results').style.display = 'none';
        }

        // v5.1: WebSocket Subscriptions Update
        function updateWebSocketSubscriptions(response) {
            if (!response.success || !response.data) {
                document.getElementById('ws-total-badge').textContent = '0';
                return;
            }

            const data = response.data;
            document.getElementById('ws-total-badge').textContent = data.total || 0;

            // ÌòÑÏû¨Í∞Ä Íµ¨ÎèÖ
            const priceList = document.getElementById('ws-price-list');
            if (data.price && data.price.length > 0) {
                priceList.innerHTML = data.price.map(s =>
                    `<span style="display: inline-block; margin: 2px; padding: 2px 6px; background: rgba(59, 130, 246, 0.2); border-radius: 4px; font-size: 10px;">${s.stock_name}</span>`
                ).join('');
            } else {
                priceList.textContent = 'ÏóÜÏùå';
            }

            // Ìò∏Í∞Ä Íµ¨ÎèÖ
            const orderbookList = document.getElementById('ws-orderbook-list');
            if (data.orderbook && data.orderbook.length > 0) {
                orderbookList.innerHTML = data.orderbook.map(s =>
                    `<span style="display: inline-block; margin: 2px; padding: 2px 6px; background: rgba(16, 185, 129, 0.2); border-radius: 4px; font-size: 10px;">${s.stock_name}</span>`
                ).join('');
            } else {
                orderbookList.textContent = 'ÏóÜÏùå';
            }

            // Ï≤¥Í≤∞ Íµ¨ÎèÖ
            const executionList = document.getElementById('ws-execution-list');
            if (data.execution && data.execution.length > 0) {
                executionList.innerHTML = data.execution.map(s =>
                    `<span style="display: inline-block; margin: 2px; padding: 2px 6px; background: rgba(245, 158, 11, 0.2); border-radius: 4px; font-size: 10px;">${s.stock_name}</span>`
                ).join('');
            } else {
                executionList.textContent = 'ÏóÜÏùå';
            }
        }

        // v5.6: Store virtual trades data globally for filtering
        let virtualTradesData = null;

        // v5.6: Filter virtual trades by strategy
        function filterVirtualTrades() {
            if (!virtualTradesData) return;

            const selectedStrategy = document.getElementById('strategy-filter').value;
            const container = document.getElementById('virtual-trades-list');

            let allTrades = [];

            // Collect trades based on selected strategy
            for (const [strategyName, strategyData] of Object.entries(virtualTradesData)) {
                if (selectedStrategy === 'all' || strategyName === selectedStrategy) {
                    const trades = strategyData.trades || [];
                    trades.forEach(trade => {
                        trade.strategy = strategyName;
                        allTrades.push(trade);
                    });
                }
            }

            // Sort by timestamp (latest first)
            allTrades.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            // Render trades
            renderVirtualTrades(allTrades, container);
        }

        // v5.6: Render virtual trades (extracted for reuse)
        function renderVirtualTrades(trades, container) {
            if (trades.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Í±∞Îûò ÎÇ¥Ïó≠ ÏóÜÏùå</div>';
                return;
            }

            let html = '';
            trades.slice(0, 50).forEach(trade => {
                const timestamp = trade.timestamp ? new Date(trade.timestamp).toLocaleString('ko-KR', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'N/A';

                const strategyColor = trade.strategy === 'Í≥µÍ≤©Ï†Å' ? '#ef4444' : trade.strategy === 'Î≥¥ÏàòÏ†Å' ? '#3b82f6' : '#f59e0b';

                if (trade.type === 'buy') {
                    html += `
                        <div style="padding: 10px; border-bottom: 1px solid var(--border-color); font-size: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: ${strategyColor}; font-weight: 600;">[${trade.strategy}]</span>
                                <span style="color: var(--text-muted);">${timestamp}</span>
                            </div>
                            <div>üîµ <strong>Îß§Ïàò</strong> ${trade.stock_name || trade.stock_code} ${trade.quantity}Ï£º @ ‚Ç©${formatNumber(trade.price)}</div>
                        </div>
                    `;
                } else {
                    const pnl = trade.realized_pnl || 0;
                    const pnlRate = trade.realized_pnl_rate || 0;
                    const pnlColor = pnl >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ
                    const pnlSign = pnl >= 0 ? '‚úÖ' : '‚ùå';

                    html += `
                        <div style="padding: 10px; border-bottom: 1px solid var(--border-color); font-size: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: ${strategyColor}; font-weight: 600;">[${trade.strategy}]</span>
                                <span style="color: var(--text-muted);">${timestamp}</span>
                            </div>
                            <div>
                                üî¥ <strong>Îß§ÎèÑ</strong> ${trade.stock_name || trade.stock_code} ${trade.quantity}Ï£º @ ‚Ç©${formatNumber(trade.price)}
                                <span style="color: ${pnlColor}; font-weight: 600;">
                                    (${pnl >= 0 ? '+' : ''}‚Ç©${formatNumber(Math.abs(pnl))}, ${pnl >= 0 ? '+' : ''}${pnlRate.toFixed(2)}%)
                                </span> ${pnlSign}
                                ${trade.reason ? `<span style="color: var(--text-muted); font-size: 11px;">[${trade.reason}]</span>` : ''}
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        // v5.6: Virtual Trading History Update (with strategy filter support)
        function updateVirtualTradesHistory(response) {
            const container = document.getElementById('virtual-trades-list');

            if (!response.success || !response.data) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Í∞ÄÏÉÅÎß§Îß§ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>';
                return;
            }

            // Store data globally for filtering
            virtualTradesData = response.data;

            // Populate strategy dropdown
            const strategyFilter = document.getElementById('strategy-filter');
            const currentValue = strategyFilter.value;
            const strategies = Object.keys(virtualTradesData);

            // Rebuild options
            strategyFilter.innerHTML = '<option value="all">Ï†ÑÏ≤¥ Ï†ÑÎûµ</option>';
            strategies.forEach(strategy => {
                strategyFilter.innerHTML += `<option value="${strategy}">${strategy}</option>`;
            });

            // Restore previous selection if it still exists
            if (strategies.includes(currentValue)) {
                strategyFilter.value = currentValue;
            } else {
                strategyFilter.value = 'all';
            }

            // Apply filter to show trades
            filterVirtualTrades();
        }

        // v5.1: Real Holdings with ATR Stops Update
        function updateRealHoldingsTable(response) {
            const tbody = document.getElementById('real-holdings-table');

            if (!response.success || !response.data || response.data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: var(--text-secondary);">Î≥¥Ïú† Ï¢ÖÎ™© ÏóÜÏùå</td></tr>';
                return;
            }

            const holdings = response.data;

            let html = '';
            holdings.forEach(h => {
                const stopLossDistance = h.distance_to_stop || 0;
                const takeProfitDistance = h.distance_to_target || 0;
                const plColor = h.pnl_rate >= 0 ? '#ef4444' : '#3b82f6';  // v5.7.4: ÌïúÍµ≠Ïãù ÏÉâÏÉÅ

                // Kelly & Sharpe ÏÉâÏÉÅ
                const kellyColor = h.kelly_fraction > 0.15 ? 'var(--color-success)' : h.kelly_fraction > 0.05 ? 'var(--color-warning)' : 'var(--color-danger)';
                const sharpeColor = h.sharpe_ratio > 1 ? 'var(--color-success)' : h.sharpe_ratio > 0 ? 'var(--color-warning)' : 'var(--color-danger)';

                // RSI ÏÉâÏÉÅ (70 Ïù¥ÏÉÅ Í≥ºÎß§Ïàò, 30 Ïù¥Ìïò Í≥ºÎß§ÎèÑ)
                const rsiColor = h.rsi > 70 ? 'var(--color-danger)' : h.rsi < 30 ? 'var(--color-success)' : 'var(--text-primary)';

                // Risk/Reward ÏÉâÏÉÅ
                const rrColor = h.risk_reward_ratio >= 2 ? 'var(--color-success)' : h.risk_reward_ratio >= 1 ? 'var(--color-warning)' : 'var(--color-danger)';

                html += `
                    <tr style="border-bottom: 1px solid var(--border-color); cursor: pointer;" onclick="loadChartData('${h.stock_code}')">
                        <td style="padding: 12px;">
                            <div style="font-weight: 600; font-size: 13px;">${h.stock_name}</div>
                            <div style="font-size: 11px; color: var(--text-muted);">${h.stock_code}</div>
                        </td>
                        <td style="padding: 12px; text-align: right;">${h.quantity}</td>
                        <td style="padding: 12px; text-align: right;">‚Ç©${formatNumber(h.avg_price)}</td>
                        <td style="padding: 12px; text-align: right;">‚Ç©${formatNumber(h.current_price)}</td>
                        <td style="padding: 12px; text-align: right;">
                            <div style="color: var(--color-danger); font-weight: 600;">‚Ç©${formatNumber(h.stop_loss_price)}</div>
                            <div style="font-size: 10px; color: var(--text-muted);">(${stopLossDistance >= 0 ? '+' : ''}${stopLossDistance.toFixed(1)}%)</div>
                            ${h.atr_based ? '<div style="font-size: 9px; color: var(--color-danger); margin-top: 2px;">ATR</div>' : ''}
                        </td>
                        <td style="padding: 12px; text-align: right;">
                            <div style="color: var(--color-success); font-weight: 600;">‚Ç©${formatNumber(h.take_profit_price)}</div>
                            <div style="font-size: 10px; color: var(--text-muted);">(${takeProfitDistance >= 0 ? '+' : ''}${takeProfitDistance.toFixed(1)}%)</div>
                            ${h.atr_based ? '<div style="font-size: 9px; color: var(--color-success); margin-top: 2px;">ATR</div>' : ''}
                        </td>
                        <td style="padding: 12px; text-align: right;">
                            <div style="color: ${plColor}; font-weight: 700; font-size: 14px;">
                                ${h.pnl_rate >= 0 ? '+' : ''}${h.pnl_rate.toFixed(2)}%
                            </div>
                            <div style="font-size: 11px; color: ${plColor};">
                                ${h.pnl >= 0 ? '+' : ''}‚Ç©${formatNumber(Math.abs(h.pnl))}
                            </div>
                        </td>
                        <td style="padding: 12px; text-align: right; font-weight: 600;">‚Ç©${formatNumber(h.eval_amount)}</td>
                        <td style="padding: 12px; text-align: right;">
                            <div style="color: ${kellyColor}; font-weight: 600; font-size: 12px;">K: ${(h.kelly_fraction * 100).toFixed(1)}%</div>
                            <div style="color: ${sharpeColor}; font-size: 11px; margin-top: 2px;">S: ${h.sharpe_ratio.toFixed(2)}</div>
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">MDD: ${h.max_drawdown.toFixed(1)}%</div>
                        </td>
                        <td style="padding: 12px; text-align: right;">
                            <div style="color: ${rsiColor}; font-weight: 600; font-size: 12px;">RSI: ${h.rsi.toFixed(0)}</div>
                            <div style="color: ${rrColor}; font-size: 11px; margin-top: 2px;">R:R ${h.risk_reward_ratio.toFixed(1)}:1</div>
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">BB: ${(h.bb_position * 100).toFixed(0)}%</div>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // ====================================
        // Quick Action Functions
        // ====================================

        async function emergencyStopAll() {
            if (!confirm('‚ö†Ô∏è Í∏¥Í∏â Ï†ïÏßÄ: Î™®Îì† Í±∞ÎûòÎ•º Ï¶âÏãú Ï§ëÎã®ÌïòÍ≥† Î¥áÏùÑ Ï†ïÏßÄÌï©ÎãàÎã§.\n\nÍ≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            try {
                const response = await fetch('/api/emergency-stop', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Í∏¥Í∏â Ï†ïÏßÄ ÏôÑÎ£å', 'success');
                    loadAllData();
                } else {
                    showToast('‚ùå Í∏¥Í∏â Ï†ïÏßÄ Ïã§Ìå®: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('‚ùå Í∏¥Í∏â Ï†ïÏßÄ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        async function sellAllPositions() {
            // 1Îã®Í≥Ñ: Ï≤´ Î≤àÏß∏ ÌôïÏù∏
            if (!confirm('‚ö†Ô∏è Ï†ÑÏ≤¥ Îß§ÎèÑ: Î™®Îì† Î≥¥Ïú† Ï¢ÖÎ™©ÏùÑ ÏãúÏû•Í∞ÄÎ°ú Îß§ÎèÑÌï©ÎãàÎã§.\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!\n\nÍ≥ÑÏÜçÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                return;
            }

            // 2Îã®Í≥Ñ: YES ÏûÖÎ†• ÏöîÍµ¨
            const userInput = prompt('‚ö†Ô∏è Ï†ïÎßêÎ°ú Ï†ÑÏ≤¥ Îß§ÎèÑÎ•º Ïã§ÌñâÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÍ≥ÑÏÜçÌïòÎ†§Î©¥ "YES"Î•º Ï†ïÌôïÌûà ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÎåÄÎ¨∏Ïûê):');

            if (userInput !== 'YES') {
                showToast('‚ùå Ï∑®ÏÜåÎêòÏóàÏäµÎãàÎã§. "YES"Î•º Ï†ïÌôïÌûà ÏûÖÎ†•Ìï¥Ïïº Ìï©ÎãàÎã§.', 'warning');
                return;
            }

            try {
                const response = await fetch('/api/sell-all', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();

                if (data.success) {
                    showToast(`‚úÖ Ï†ÑÏ≤¥ Îß§ÎèÑ Ï£ºÎ¨∏ ÏôÑÎ£å (${data.count}Í±¥)`, 'success');
                    loadAllData();
                } else {
                    showToast('‚ùå Ï†ÑÏ≤¥ Îß§ÎèÑ Ïã§Ìå®: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('‚ùå Ï†ÑÏ≤¥ Îß§ÎèÑ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        async function pauseTrading() {
            try {
                const response = await fetch('/api/pause-trading', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                const data = await response.json();

                if (data.success) {
                    showToast('‚úÖ Îß§Îß§ ÏùºÏãúÏ†ïÏßÄ', 'success');
                    loadAllData();
                } else {
                    showToast('‚ùå ÏùºÏãúÏ†ïÏßÄ Ïã§Ìå®: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('‚ùå ÏùºÏãúÏ†ïÏßÄ Ïò§Î•ò: ' + error.message, 'error');
            }
        }

        // ====================================
        // Keyboard Shortcuts
        // ====================================

        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + Q: Emergency Stop
            if (e.ctrlKey && e.shiftKey && e.key === 'Q') {
                e.preventDefault();
                emergencyStopAll();
                return;
            }

            // Ctrl + Shift + S: Sell All
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                sellAllPositions();
                return;
            }

            // Ctrl + Shift + P: Pause Trading
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                pauseTrading();
                return;
            }

            // F5: Refresh (allow default, but also trigger our refresh)
            if (e.key === 'F5') {
                e.preventDefault();
                loadAllData();
                return;
            }

            // Escape: Close any open modals/dialogs
            if (e.key === 'Escape') {
                const searchResults = document.getElementById('stock-search-results');
                if (searchResults) {
                    searchResults.style.display = 'none';
                }
            }
        });

        // ====================================
        // Theme Toggle (Dark/Light Mode)
        // ====================================

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            // Update icon
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            }

            // Show toast notification
            showToastModern(
                newTheme === 'dark' ? 'üåô Îã§ÌÅ¨ Î™®Îìú ÌôúÏÑ±Ìôî' : '‚òÄÔ∏è ÎùºÏù¥Ìä∏ Î™®Îìú ÌôúÏÑ±Ìôî',
                'success'
            );
        }

        // Load saved theme on page load
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.className = savedTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
            }
        })();

        // ====================================
        // Modern Toast Notifications with Toastify
        // ====================================

        function showToastModern(message, type = 'info') {
            const colors = {
                success: 'linear-gradient(to right, #10b981, #059669)',
                error: 'linear-gradient(to right, #ef4444, #dc2626)',
                warning: 'linear-gradient(to right, #f59e0b, #d97706)',
                info: 'linear-gradient(to right, #3b82f6, #2563eb)'
            };

            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                style: {
                    background: colors[type] || colors.info,
                    borderRadius: "8px",
                    fontSize: "14px",
                    fontWeight: "500",
                    boxShadow: "0 4px 12px rgba(0, 0, 0, 0.15)"
                },
                stopOnFocus: true
            }).showToast();
        }

        // ====================================
        // CountUp.js - Animated Number Displays
        // ====================================

        function animateNumber(elementId, endValue, prefix = '', suffix = '', decimals = 0) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const startValue = parseFloat(element.textContent.replace(/[^0-9.-]/g, '')) || 0;

            const countUp = new countUp.CountUp(elementId, endValue, {
                startVal: startValue,
                decimalPlaces: decimals,
                duration: 1.5,
                useEasing: true,
                useGrouping: true,
                separator: ',',
                prefix: prefix,
                suffix: suffix
            });

            if (!countUp.error) {
                countUp.start();
            }
        }

        // ====================================
        // Alert Sound Notifications
        // ====================================

        const alertSounds = {
            success: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIF2m98OScTgwOU6bh8bllHgU3kdTzz3kqBSV4yO3cgEIJE1621+2nVBMKRp/f8L5sHwUqgc/y2Ik2CBdqvfDknE4MDlOm4fG5ZR4FN5HU889...'),
            error: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIF2m98OScTgwOU6bh8bllHgU3kdTzz3kqBSV4yO3cgEIJE1621+2nVBMKRp/f8L5sHwUqgc/y2Ik2CBdqvfDknE4MDlOm4fG5ZR4FN5HU889...'),
            warning: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIF2m98OScTgwOU6bh8bllHgU3kdTzz3kqBSV4yO3cgEIJE1621+2nVBMKRp/f8L5sHwUqgc/y2Ik2CBdqvfDknE4MDlOm4fG5ZR4FN5HU889...')
        };

        function playAlertSound(type = 'success') {
            try {
                const sound = alertSounds[type] || alertSounds.success;
                sound.volume = 0.3;
                sound.play().catch(e => console.log('Sound play prevented:', e));
            } catch (error) {
                console.log('Sound notification not available');
            }
        }

        // ====================================
        // AOS (Animate On Scroll) Initialization
        // ====================================

        if (typeof AOS !== 'undefined') {
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true,
                mirror: false,
                offset: 120
            });
        }

        // ====================================
        // Enhanced showToast with backwards compatibility
        // ====================================

        // Override the existing showToast to use Toastify if available
        const originalShowToast = showToast;
        showToast = function(message, type = 'info') {
            if (typeof Toastify !== 'undefined') {
                showToastModern(message, type);
            } else {
                originalShowToast(message, type);
            }
        };

        // ====================================
        // Auto-refresh AOS on dynamic content
        // ====================================

        const originalLoadAllData = loadAllData;
        loadAllData = function() {
            originalLoadAllData();
            setTimeout(() => {
                if (typeof AOS !== 'undefined') {
                    AOS.refresh();
                }
            }, 500);
        };

        // ====================================
        // v6.0: AI Tab Performance Banner
        // ====================================

        async function loadAITabPerformance() {
            try {
                const response = await fetch('/api/account');
                const account = await response.json();

                // Update performance banner
                document.getElementById('perf-total-value').textContent =
                    '‚Ç©' + formatNumber(account.total_assets || 0);

                const profitLoss = account.profit_loss || 0;
                const profitLossPct = account.profit_loss_percent || 0;
                const perfProfit = document.getElementById('perf-total-profit');
                const perfPct = document.getElementById('perf-profit-pct');

                perfProfit.textContent = (profitLoss >= 0 ? '+' : '') + '‚Ç©' + formatNumber(profitLoss);
                perfProfit.style.color = profitLoss >= 0 ? '#10b981' : '#ef4444';

                perfPct.textContent = (profitLossPct >= 0 ? '+' : '') + profitLossPct.toFixed(2) + '%';
                perfPct.style.color = profitLossPct >= 0 ? '#10b981' : '#ef4444';

                // Calculate win rate from real holdings
                const holdingsResponse = await fetch('/api/portfolio/real-holdings');
                const holdingsData = await holdingsResponse.json();

                if (holdingsData.success && holdingsData.data) {
                    const holdings = holdingsData.data;
                    const profitableCount = holdings.filter(h => (h.profit_loss_percent || 0) > 0).length;
                    const totalCount = holdings.length;
                    const winRate = totalCount > 0 ? (profitableCount / totalCount * 100) : 0;

                    document.getElementById('perf-win-rate').textContent = winRate.toFixed(1) + '%';
                } else {
                    document.getElementById('perf-win-rate').textContent = '0%';
                }
            } catch (error) {
                console.error('Performance banner load error:', error);
                document.getElementById('perf-total-value').textContent = '‚Ç©0';
                document.getElementById('perf-total-profit').textContent = '‚Ç©0';
                document.getElementById('perf-profit-pct').textContent = '0%';
                document.getElementById('perf-win-rate').textContent = '0%';
            }
        }

        // ====================================
        // v5.7.7: AI Ïã§ÏãúÍ∞Ñ ÏΩîÎ©òÌÑ∞Î¶¨
        // ====================================

        async function loadAICommentary() {
            try {
                const container = document.getElementById('ai-commentary-content');
                container.innerHTML = '<div class="loading"><div class="spinner"></div><p>AI Î∂ÑÏÑù Ï§ë...</p></div>';

                const response = await fetch('/api/ai/market-commentary');
                const data = await response.json();

                if (!data.success || !data.commentary) {
                    container.innerHTML = '<div style="padding: 15px; color: var(--text-secondary);">ÏΩîÎ©òÌÑ∞Î¶¨Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
                    return;
                }

                const commentary = data.commentary;
                let html = '';

                // Ï¢ÖÌï© ÏãúÏû• Î∂ÑÏÑù
                html += `
                    <div class="ai-commentary">
                        <div style="font-size: 13px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">
                            üìä Ï¢ÖÌï© ÏãúÏû• Î∂ÑÏÑù
                        </div>
                        <div style="font-size: 12px; line-height: 1.6; color: var(--text-secondary);">
                            ${commentary.market_summary || 'ÏãúÏû• Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...'}
                        </div>
                    </div>
                `;

                // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï°∞Ïñ∏
                if (commentary.portfolio_advice) {
                    html += `
                        <div class="ai-commentary">
                            <div style="font-size: 13px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary);">
                                üíº Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï°∞Ïñ∏
                            </div>
                            <div style="font-size: 12px; line-height: 1.6; color: var(--text-secondary);">
                                ${commentary.portfolio_advice}
                            </div>
                        </div>
                    `;
                }

                // Ï£ºÏöî Í∏∞Ìöå
                if (commentary.opportunities && commentary.opportunities.length > 0) {
                    html += `
                        <div class="ai-commentary" style="border-left-color: #10b981;">
                            <div style="font-size: 13px; font-weight: 700; margin-bottom: 8px; color: #10b981;">
                                üéØ Ï£ºÏöî Í∏∞Ìöå
                            </div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.8;">
                    `;
                    commentary.opportunities.forEach(opp => {
                        html += `<li>${opp}</li>`;
                    });
                    html += `</ul></div>`;
                }

                // Ï£ºÏöî ÏúÑÌóò
                if (commentary.risks && commentary.risks.length > 0) {
                    html += `
                        <div class="ai-commentary" style="border-left-color: #ef4444;">
                            <div style="font-size: 13px; font-weight: 700; margin-bottom: 8px; color: #ef4444;">
                                ‚ö†Ô∏è Ï£ºÏöî ÏúÑÌóò
                            </div>
                            <ul style="margin: 0; padding-left: 20px; font-size: 12px; line-height: 1.8;">
                    `;
                    commentary.risks.forEach(risk => {
                        html += `<li>${risk}</li>`;
                    });
                    html += `</ul></div>`;
                }

                container.innerHTML = html;

                // ÏùåÏÑ± ÏïåÎ¶º (Ï§ëÏöîÌïú Í≤ΩÏö∞)
                if (commentary.speak && commentary.speak_text) {
                    speakText(commentary.speak_text);
                }

            } catch (error) {
                console.error('AI Commentary error:', error);
                document.getElementById('ai-commentary-content').innerHTML =
                    '<div style="padding: 15px; color: var(--text-secondary);">ÏΩîÎ©òÌÑ∞Î¶¨ Î°úÎî© Ïò§Î•ò</div>';
            }
        }

        // ====================================
        // Î∏åÎùºÏö∞Ï†Ä Ìë∏Ïãú ÏïåÎ¶º
        // ====================================

        async function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    showToast('‚úÖ ÏïåÎ¶º Í∂åÌïúÏù¥ ÌóàÏö©ÎêòÏóàÏäµÎãàÎã§', 'success');
                }
            }
        }

        function showBrowserNotification(title, message, type = 'info') {
            if ('Notification' in window && Notification.permission === 'granted') {
                const icon = type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';

                const notification = new Notification(icon + ' ' + title, {
                    body: message,
                    icon: '/static/icon.png',
                    badge: '/static/badge.png',
                    tag: type,
                    requireInteraction: type === 'error' || type === 'warning',
                    vibrate: [200, 100, 200]
                });

                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };

                // Play sound
                playAlertSound(type);
            }
        }

        // ====================================
        // ÏùåÏÑ± ÏïåÎ¶º (Text-to-Speech)
        // ====================================

        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Í∏∞Ï°¥ ÏùåÏÑ± Ï§ëÏßÄ
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;

                // ÏùåÏÑ± ÌëúÏãú
                const indicator = document.getElementById('voice-indicator');
                if (indicator) {
                    indicator.style.display = 'inline-flex';
                }

                utterance.onend = function() {
                    if (indicator) {
                        indicator.style.display = 'none';
                    }
                };

                window.speechSynthesis.speak(utterance);
            }
        }

        // ====================================
        // Ïã§ÏãúÍ∞Ñ Ìã±ÏóÖ/Ìã±Îã§Ïö¥ Ïï†ÎãàÎ©îÏù¥ÏÖò
        // ====================================

        const previousPrices = {};

        function updatePriceWithTick(elementId, newPrice) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const oldPrice = previousPrices[elementId] || newPrice;

            if (newPrice > oldPrice) {
                element.classList.remove('tick-down');
                element.classList.add('tick-up');
                setTimeout(() => element.classList.remove('tick-up'), 500);
            } else if (newPrice < oldPrice) {
                element.classList.remove('tick-up');
                element.classList.add('tick-down');
                setTimeout(() => element.classList.remove('tick-down'), 500);
            }

            previousPrices[elementId] = newPrice;
        }

        // ====================================
        // Ï¥àÍ∏∞Ìôî: ÏïåÎ¶º Í∂åÌïú ÏöîÏ≤≠
        // ====================================

        setTimeout(() => {
            requestNotificationPermission();
        }, 3000); // 3Ï¥à ÌõÑ Í∂åÌïú ÏöîÏ≤≠

        // ====================================
        // AI ÌÉ≠ Î°úÎìú Ïãú ÏΩîÎ©òÌÑ∞Î¶¨ ÏûêÎèô Î°úÎìú
        // ====================================

        const originalSwitchTab = switchTab;
        switchTab = function(index) {
            originalSwitchTab(index);
            if (index === 1) { // AI Analysis tab
                setTimeout(() => {
                    loadAICommentary();
                }, 500);
            }
        };

        // ====================================
        // v6.1: Notification Center Functions
        // ====================================

        let notificationsOpen = false;
        let notificationCount = 0;
        const notifications = [];

        function toggleNotifications() {
            notificationsOpen = !notificationsOpen;
            const panel = document.getElementById('notification-panel');
            const overlay = document.getElementById('notification-overlay');

            if (notificationsOpen) {
                panel.style.right = '0';
                overlay.style.display = 'block';
            } else {
                panel.style.right = '-400px';
                overlay.style.display = 'none';
            }
        }

        function addNotification(type, title, message, priority = 'normal') {
            const now = new Date();
            const notification = {
                id: Date.now(),
                type, // 'buy', 'sell', 'warning', 'info'
                title,
                message,
                priority, // 'high', 'normal', 'low'
                timestamp: now,
                read: false
            };

            notifications.unshift(notification);
            notificationCount++;

            // Update badge
            const badge = document.getElementById('notification-badge');
            badge.textContent = notificationCount;
            badge.style.display = 'flex';

            // Update notification list
            renderNotifications();

            // Browser notification if permission granted
            if (Notification.permission === 'granted' && priority === 'high') {
                new Notification(title, {
                    body: message,
                    icon: '/static/favicon.ico'
                });
            }
        }

        function renderNotifications() {
            const list = document.getElementById('notification-list');

            if (notifications.length === 0) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                        <i class="fas fa-bell-slash" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
                        <p>ÏÉàÎ°úÏö¥ ÏïåÎ¶ºÏù¥ ÏóÜÏäµÎãàÎã§</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = notifications.map(n => {
                const icon = {
                    'buy': 'üü¢',
                    'sell': 'üî¥',
                    'warning': '‚ö†Ô∏è',
                    'info': '‚ÑπÔ∏è'
                }[n.type] || '‚ÑπÔ∏è';

                const bgColor = {
                    'high': 'rgba(239, 68, 68, 0.1)',
                    'normal': 'rgba(59, 130, 246, 0.05)',
                    'low': 'rgba(100, 100, 100, 0.05)'
                }[n.priority];

                const timeStr = n.timestamp.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});

                return `
                    <div style="padding: 12px; margin-bottom: 10px; background: ${bgColor}; border-radius: 8px; border-left: 3px solid var(--color-primary);">
                        <div style="display: flex; align-items: start; gap: 10px;">
                            <span style="font-size: 20px;">${icon}</span>
                            <div style="flex: 1;">
                                <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">${n.title}</div>
                                <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 6px;">${n.message}</div>
                                <div style="font-size: 10px; color: var(--text-muted);">${timeStr}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ====================================
        // v6.1: Real-time Progress Updates
        // ====================================

        function updateAIProgress(current, total, status) {
            const percent = total > 0 ? (current / total * 100) : 0;
            document.getElementById('ai-progress-bar').style.width = percent + '%';
            document.getElementById('ai-progress-text').textContent = status || `${current}/${total}`;

            if (percent === 100) {
                setTimeout(() => {
                    document.getElementById('ai-progress-bar').style.width = '0%';
                    document.getElementById('ai-progress-text').textContent = 'ÏôÑÎ£å';
                }, 1000);
            }
        }

        function updateScanProgress(current, total) {
            const percent = total > 0 ? (current / total * 100) : 0;
            document.getElementById('scan-progress-bar').style.width = percent + '%';
            document.getElementById('scan-progress-text').textContent = `${current}/${total}`;

            if (percent === 100) {
                setTimeout(() => {
                    document.getElementById('scan-progress-bar').style.width = '0%';
                    document.getElementById('scan-progress-text').textContent = '0/0';
                }, 2000);
            }
        }

        function updateLastActivity(text) {
            document.getElementById('last-activity-text').textContent = text;
        }

        // v6.1: Real-time Progress Data Fetching
        let progressIntervalId = null;

        async function fetchRealTimeProgress() {
            try {
                // Fetch scan progress
                const scanResponse = await fetch('/api/scan-progress');
                const scanData = await scanResponse.json();

                // Update scan progress
                const approved = scanData.approved ? scanData.approved.length : 0;
                const rejected = scanData.rejected ? scanData.rejected.length : 0;
                const total = scanData.total_candidates || 0;
                const reviewed = approved + rejected;

                if (total > 0) {
                    updateScanProgress(reviewed, total);
                    updateAIProgress(approved, total, `${approved}Í∞ú ÏäπÏù∏`);
                } else {
                    updateScanProgress(0, 0);
                    updateAIProgress(0, 0, 'ÎåÄÍ∏∞Ï§ë');
                }

                // Update current strategy
                if (scanData.current_strategy) {
                    updateLastActivity(`${scanData.current_strategy} Ï†ÑÎûµ Ïä§Ï∫î Ï§ë - ${new Date().toLocaleTimeString('ko-KR')}`);
                }

                // Update reviewing stock
                if (scanData.reviewing) {
                    updateLastActivity(`${scanData.reviewing} Î∂ÑÏÑù Ï§ë - ${new Date().toLocaleTimeString('ko-KR')}`);
                }

                // Fetch latest activity
                const activityResponse = await fetch('/api/activities');
                const activities = await activityResponse.json();

                if (activities && activities.length > 0) {
                    const latestActivity = activities[0];
                    if (latestActivity.message) {
                        updateLastActivity(`${latestActivity.message} - ${latestActivity.time}`);
                    }
                }

                // Check for buy signals and send notifications
                if (approved > 0 && scanData.approved) {
                    const latestApproved = scanData.approved[scanData.approved.length - 1];
                    if (latestApproved && !latestApproved.notified) {
                        addNotification(
                            'buy',
                            `AI Îß§Ïàò Ïã†Ìò∏: ${latestApproved.stock_name || latestApproved.stock_code}`,
                            `Ïä§ÏΩîÏñ¥: ${latestApproved.score || 'N/A'} | ${latestApproved.ai_reason || ''}`,
                            'high'
                        );
                        // Mark as notified to avoid duplicate notifications
                        latestApproved.notified = true;
                    }
                }

            } catch (error) {
                console.error('Failed to fetch real-time progress:', error);
            }
        }

        // Start real-time progress updates
        function startProgressUpdates() {
            if (progressIntervalId) {
                clearInterval(progressIntervalId);
            }
            // Update every 3 seconds
            progressIntervalId = setInterval(fetchRealTimeProgress, 3000);
            // Initial fetch
            fetchRealTimeProgress();
        }

        // Stop progress updates
        function stopProgressUpdates() {
            if (progressIntervalId) {
                clearInterval(progressIntervalId);
                progressIntervalId = null;
            }
        }

        // Start progress updates on page load
        document.addEventListener('DOMContentLoaded', () => {
            startProgressUpdates();
            loadAIVisualization();
            loadRiskHeatmap();

            // Add demo notification
            setTimeout(() => {
                addNotification('info', 'v6.1 ÏóÖÎç∞Ïù¥Ìä∏', 'Ïã§ÏãúÍ∞Ñ ÏßÑÌñâ ÏÉÅÌô© ÌëúÏãú & AI ÏãúÍ∞ÅÌôîÍ∞Ä Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!', 'high');
            }, 2000);
        });

        // ============================================================
        // v6.1: AI Visualization Functions
        // ============================================================

        async function loadAIVisualization() {
            try {
                // In production, fetch from API
                // const response = await fetch('/api/ai/confidence');
                // const data = await response.json();

                // Demo data (replace with real API call)
                const confidenceData = {
                    overall: 87,
                    gemini: 92,
                    claude: 85,
                    gpt4: 84
                };

                // Update gauge
                const circumference = 2 * Math.PI * 85;
                const offset = circumference * (1 - confidenceData.overall / 100);
                const gaugeCircle = document.getElementById('confidence-gauge-circle');
                const gaugeText = document.getElementById('confidence-value-text');

                if (gaugeCircle && gaugeText) {
                    gaugeCircle.style.strokeDashoffset = offset;
                    gaugeText.textContent = confidenceData.overall + '%';
                }

                // Update individual AI bars
                updateAIConfidenceBar('gemini', confidenceData.gemini);
                updateAIConfidenceBar('claude', confidenceData.claude);
                updateAIConfidenceBar('gpt4', confidenceData.gpt4);

            } catch (error) {
                console.error('Failed to load AI visualization:', error);
            }
        }

        function updateAIConfidenceBar(aiName, confidence) {
            const textEl = document.getElementById(`${aiName}-confidence`);
            const barEl = document.getElementById(`${aiName}-bar`);

            if (textEl) textEl.textContent = confidence + '%';
            if (barEl) barEl.style.width = confidence + '%';
        }

        async function loadRiskHeatmap() {
            try {
                // In production, fetch from API
                // const response = await fetch('/api/portfolio/risk-heatmap');
                // const data = await response.json();

                // Demo data (replace with real API call)
                const riskData = [
                    { name: 'ÏÇºÏÑ±Ï†ÑÏûê', risk: 18, color: 'success' },
                    { name: 'SKÌïòÏù¥ÎãâÏä§', risk: 22, color: 'success' },
                    { name: 'NAVER', risk: 35, color: 'warning' },
                    { name: 'Ïπ¥Ïπ¥Ïò§', risk: 28, color: 'success' },
                    { name: 'ÏÖÄÌä∏Î¶¨Ïò®', risk: 52, color: 'danger' },
                    { name: 'LGÏóêÎÑàÏßÄ', risk: 25, color: 'success' },
                    { name: 'ÌòÑÎåÄÏ∞®', risk: 38, color: 'warning' },
                    { name: 'Í∏∞ÏïÑ', risk: 30, color: 'success' },
                    { name: 'Ìè¨Ïä§ÏΩîÌì®Ï≤òÏó†', risk: 48, color: 'warning' },
                    { name: 'LGÌôîÌïô', risk: 42, color: 'warning' },
                    { name: 'ÏÇºÏÑ±Î∞îÏù¥Ïò§', risk: 26, color: 'success' },
                    { name: 'KBÍ∏àÏúµ', risk: 33, color: 'warning' }
                ];

                const container = document.getElementById('risk-heatmap-grid');
                if (!container) return;

                container.innerHTML = riskData.map(stock => {
                    const riskColor = getRiskColor(stock.risk);
                    return `
                        <div style="
                            padding: 12px 8px;
                            background: ${riskColor};
                            border-radius: 8px;
                            text-align: center;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        " title="${stock.name}: ${stock.risk}% Î¶¨Ïä§ÌÅ¨"
                           onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.2)';"
                           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                            <div style="font-size: 10px; font-weight: 600; color: white; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${stock.name}</div>
                            <div style="font-size: 14px; font-weight: 700; color: white;">${stock.risk}%</div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Failed to load risk heatmap:', error);
            }
        }

        function getRiskColor(risk) {
            if (risk <= 30) {
                return 'var(--color-success)';
            } else if (risk <= 50) {
                return 'var(--color-warning)';
            } else {
                return 'var(--color-danger)';
            }
        }

        // Update AI visualization every 10 seconds
        setInterval(() => {
            loadAIVisualization();
            loadRiskHeatmap();
        }, 10000);

        // ============================================================
        // v6.1: Real-time WebSocket Alert Automation
        // ============================================================

        let wsAlertConnection = null;
        let wsReconnectAttempts = 0;
        const wsMaxReconnectAttempts = 5;

        function initWebSocketAlerts() {
            try {
                // Connect to WebSocket for real-time alerts
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws/alerts`;

                wsAlertConnection = new WebSocket(wsUrl);

                wsAlertConnection.onopen = () => {
                    console.log('‚úÖ WebSocket alerts connected');
                    wsReconnectAttempts = 0;
                    addNotification('info', 'WebSocket Ïó∞Í≤∞', 'Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏÑúÎπÑÏä§Í∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§', 'normal');
                };

                wsAlertConnection.onmessage = (event) => {
                    try {
                        const message = JSON.parse(event.data);
                        handleWebSocketAlert(message);
                    } catch (error) {
                        console.error('Failed to parse WebSocket message:', error);
                    }
                };

                wsAlertConnection.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };

                wsAlertConnection.onclose = () => {
                    console.log('WebSocket connection closed');

                    // Attempt to reconnect
                    if (wsReconnectAttempts < wsMaxReconnectAttempts) {
                        wsReconnectAttempts++;
                        const delay = Math.min(1000 * Math.pow(2, wsReconnectAttempts), 30000);
                        console.log(`Reconnecting in ${delay/1000}s... (attempt ${wsReconnectAttempts}/${wsMaxReconnectAttempts})`);

                        setTimeout(initWebSocketAlerts, delay);
                    } else {
                        addNotification('warning', 'WebSocket Ïó∞Í≤∞ ÎÅäÍπÄ', 'Ïã§ÏãúÍ∞Ñ ÏïåÎ¶º ÏÑúÎπÑÏä§Ïóê Ïû¨Ïó∞Í≤∞Ìï† Ïàò ÏóÜÏäµÎãàÎã§', 'high');
                    }
                };

            } catch (error) {
                console.error('Failed to initialize WebSocket alerts:', error);
            }
        }

        function handleWebSocketAlert(message) {
            const { type, data } = message;

            switch (type) {
                case 'order_filled':
                    // Ï£ºÎ¨∏ Ï≤¥Í≤∞ ÏïåÎ¶º
                    addNotification(
                        data.side === 'buy' ? 'buy' : 'sell',
                        `${data.side === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'} Ï≤¥Í≤∞`,
                        `${data.stock_name} ${data.quantity}Ï£º @ ‚Ç©${data.price.toLocaleString()}`,
                        'high'
                    );
                    break;

                case 'ai_signal':
                    // AI Îß§Îß§ Ïã†Ìò∏ ÏïåÎ¶º
                    const signalType = data.signal === 'buy' ? 'buy' : data.signal === 'sell' ? 'sell' : 'warning';
                    addNotification(
                        signalType,
                        `AI ${data.signal === 'buy' ? 'Îß§Ïàò' : 'Îß§ÎèÑ'} Ïã†Ìò∏`,
                        `${data.stock_name} - ÌôïÏã†ÎèÑ: ${data.confidence}%\n${data.reason || ''}`,
                        'high'
                    );
                    break;

                case 'price_alert':
                    // Í∞ÄÍ≤© ÏïåÎ¶º
                    addNotification(
                        'warning',
                        'Í∞ÄÍ≤© ÏïåÎ¶º',
                        `${data.stock_name}: ‚Ç©${data.price.toLocaleString()} (${data.condition})`,
                        'normal'
                    );
                    break;

                case 'risk_warning':
                    // Î¶¨Ïä§ÌÅ¨ Í≤ΩÍ≥†
                    addNotification(
                        'warning',
                        'Î¶¨Ïä§ÌÅ¨ Í≤ΩÍ≥†',
                        `${data.stock_name}: ${data.message}`,
                        'high'
                    );
                    break;

                case 'system_alert':
                    // ÏãúÏä§ÌÖú ÏïåÎ¶º
                    addNotification(
                        'info',
                        'ÏãúÏä§ÌÖú ÏïåÎ¶º',
                        data.message,
                        data.priority || 'normal'
                    );
                    break;

                case 'balance_update':
                    // ÏûîÍ≥† ÏóÖÎç∞Ïù¥Ìä∏ (ÏûêÎèôÏúºÎ°ú ÎåÄÏãúÎ≥¥Îìú ÏÉàÎ°úÍ≥†Ïπ®)
                    console.log('Balance updated:', data);
                    // Optionally reload account data
                    // loadAccountData();
                    break;

                default:
                    console.log('Unknown WebSocket message type:', type, data);
            }
        }

        // Send test WebSocket alert (for testing)
        function sendTestAlert() {
            const testAlerts = [
                {
                    type: 'ai_signal',
                    data: {
                        signal: 'buy',
                        stock_name: 'ÏÇºÏÑ±Ï†ÑÏûê',
                        confidence: 92,
                        reason: 'Í∏∞Ïà†Ï†Å ÎèåÌåå + Í±∞ÎûòÎüâ Í∏âÏ¶ù'
                    }
                },
                {
                    type: 'order_filled',
                    data: {
                        side: 'buy',
                        stock_name: 'SKÌïòÏù¥ÎãâÏä§',
                        quantity: 10,
                        price: 125000
                    }
                },
                {
                    type: 'price_alert',
                    data: {
                        stock_name: 'NAVER',
                        price: 215000,
                        condition: 'Î™©ÌëúÍ∞Ä ÎèÑÎã¨'
                    }
                }
            ];

            const randomAlert = testAlerts[Math.floor(Math.random() * testAlerts.length)];
            handleWebSocketAlert(randomAlert);
        }

        // Initialize WebSocket alerts on page load
        // Note: This requires a WebSocket server endpoint at /ws/alerts
        // For now, it's commented out and can be enabled when the server is ready
        // initWebSocketAlerts();

        // Demo: Show test alerts every 30 seconds (remove in production)
        setInterval(() => {
            sendTestAlert();
        }, 30000);

    </script>

    <!-- Advanced Trading Chart -->
    <script src="/static/js/advanced-chart.js"></script>
</body>
</html>
