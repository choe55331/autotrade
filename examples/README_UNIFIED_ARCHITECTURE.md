# 64ë¹„íŠ¸ REST API + 32ë¹„íŠ¸ koapy í†µí•© ì•„í‚¤í…ì²˜

## ğŸ¯ í•µì‹¬ ê°œë…

**í•˜ë‚˜ì˜ main.pyë¡œ ëª¨ë“  ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py (64ë¹„íŠ¸ Python)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI REST API Server                              â”‚  â”‚
â”‚  â”‚  - GET /stock/{code}                                  â”‚  â”‚
â”‚  â”‚  - GET /accounts                                      â”‚  â”‚
â”‚  â”‚  - POST /login                                        â”‚  â”‚
â”‚  â”‚  ...                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚ import koapy                              â”‚
â”‚                  â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  koapy í´ë¼ì´ì–¸íŠ¸ (64ë¹„íŠ¸)                             â”‚  â”‚
â”‚  â”‚  - KiwoomOpenApiPlusEntrypoint                        â”‚  â”‚
â”‚  â”‚  - High-level API                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ gRPC (localhost:5943)
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  koapy ì„œë²„ (32ë¹„íŠ¸ Python - ìë™ ì‹¤í–‰)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  gRPC Server                                          â”‚  â”‚
â”‚  â”‚  - QApplication                                       â”‚  â”‚
â”‚  â”‚  - Event Handlers                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚ win32com                                  â”‚
â”‚                  â†“                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  í‚¤ì›€ OCX (32ë¹„íŠ¸)                                     â”‚  â”‚
â”‚  â”‚  - KHOpenAPI.ocx                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… ì¥ì 

1. **í•˜ë‚˜ì˜ íŒŒì¼ë¡œ ê´€ë¦¬**
   - main.py í•˜ë‚˜ì— ëª¨ë“  ë¡œì§
   - 64ë¹„íŠ¸ Pythonìœ¼ë¡œ ì‹¤í–‰
   - REST API + í‚¤ì›€ API í†µí•©

2. **ìë™ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬**
   - koapyê°€ 32ë¹„íŠ¸ ì„œë²„ë¥¼ ìë™ìœ¼ë¡œ ì‹¤í–‰
   - ìˆ˜ë™ ê´€ë¦¬ ë¶ˆí•„ìš”
   - í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ë¡œ ì•ˆì •ì„±

3. **64ë¹„íŠ¸ í™˜ê²½ ì§€ì›**
   - pandas, numpy ë“± 64ë¹„íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê°€ëŠ¥
   - ë©”ëª¨ë¦¬ ì œí•œ ì—†ìŒ
   - ìµœì‹  Python ë²„ì „ ì‚¬ìš© ê°€ëŠ¥

## ğŸ“¦ ì„¤ì¹˜

### 1. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
# 64ë¹„íŠ¸ Pythonì—ì„œ ì‹¤í–‰
pip install koapy fastapi uvicorn pandas
```

### 2. í‚¤ì›€ Open API+ ì„¤ì¹˜

- í‚¤ì›€ì¦ê¶Œ í™ˆí˜ì´ì§€ì—ì„œ Open API+ ë‹¤ìš´ë¡œë“œ
- ì„¤ì¹˜ í›„ ë“±ë¡ (32ë¹„íŠ¸ OCX)

### 3. koapy 32ë¹„íŠ¸ ì„œë²„ í™˜ê²½ ì¤€ë¹„

koapyëŠ” ìë™ìœ¼ë¡œ 32ë¹„íŠ¸ ì„œë²„ë¥¼ ì°¾ì•„ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤:

**ì˜µì…˜ A: Conda í™˜ê²½ (ê¶Œì¥)**
```bash
# 32ë¹„íŠ¸ Conda í™˜ê²½ ìƒì„±
conda create -n koapy32 python=3.9
conda activate koapy32
pip install koapy

# koapy ì„œë²„ ì‹¤í–‰ (ìë™ìœ¼ë¡œ ì°¾ì•„ì§‘ë‹ˆë‹¤)
```

**ì˜µì…˜ B: 32ë¹„íŠ¸ Python ì„¤ì¹˜**
```bash
# 32ë¹„íŠ¸ Python ë³„ë„ ì„¤ì¹˜
# https://www.python.org/downloads/

# 32ë¹„íŠ¸ Python ê²½ë¡œì—ì„œ:
pip install koapy
```

**ì˜µì…˜ C: ìë™ ê°ì§€ (ê°€ì¥ ì‰¬ì›€)**
- koapyê°€ ì‹œìŠ¤í…œì—ì„œ 32ë¹„íŠ¸ Pythonì„ ìë™ìœ¼ë¡œ ì°¾ìŠµë‹ˆë‹¤
- ì—†ìœ¼ë©´ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ ì•ˆë‚´

## ğŸš€ ì‹¤í–‰

### í†µí•© ì„œë²„ ì‹¤í–‰

```bash
# 64ë¹„íŠ¸ Pythonìœ¼ë¡œ ì‹¤í–‰
python examples/unified_main_example.py
```

ì‹¤í–‰ë˜ë©´:
```
ğŸš€ ì„œë²„ ì‹œì‘ ì¤‘...
âœ“ Python: 64-bit
âœ“ koapy ë¡œë“œ ì„±ê³µ
âœ“ 32ë¹„íŠ¸ ì„œë²„ ìë™ ì‹¤í–‰ ì¤‘...
âœ“ koapy ì´ˆê¸°í™” ì™„ë£Œ

âœ… ì„œë²„ ì¤€ë¹„ ì™„ë£Œ!
   - REST API: http://localhost:8000
   - API Docs: http://localhost:8000/docs
   - koapy gRPC: localhost:5943

INFO:     Uvicorn running on http://0.0.0.0:8000
```

### API í…ŒìŠ¤íŠ¸

ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†:
```
http://localhost:8000/docs
```

Swagger UIì—ì„œ ëª¨ë“  APIë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

### ê¸°ë³¸

- `GET /` - ì„œë²„ ì •ë³´
- `GET /health` - í—¬ìŠ¤ ì²´í¬

### ë¡œê·¸ì¸

- `POST /login` - í‚¤ì›€ ë¡œê·¸ì¸
  ```json
  {
    "user_id": "your_id",
    "user_password": "your_password",
    "cert_password": "cert_password",
    "is_simulation": true
  }
  ```

### ê³„ì¢Œ

- `GET /accounts` - ê³„ì¢Œ ëª©ë¡ ì¡°íšŒ
- `GET /account/{account_no}/balance` - ì˜ˆìˆ˜ê¸ˆ ì¡°íšŒ
- `GET /account/{account_no}/stocks` - ë³´ìœ  ì¢…ëª© ì¡°íšŒ

### ì£¼ì‹ ì •ë³´

- `GET /stock/{code}` - ì£¼ì‹ ê¸°ë³¸ ì •ë³´
  ```
  GET /stock/005930
  ```

- `GET /stock/{code}/daily?days=20` - ì¼ë³„ ì£¼ê°€ ë°ì´í„°
  ```
  GET /stock/005930/daily?days=30
  ```

## ğŸ’» ì½”ë“œ ì˜ˆì œ

### Python í´ë¼ì´ì–¸íŠ¸

```python
import requests

# ì„œë²„ URL
BASE_URL = "http://localhost:8000"

# ë¡œê·¸ì¸
response = requests.post(f"{BASE_URL}/login", json={
    "is_simulation": True  # ìˆ˜ë™ ë¡œê·¸ì¸
})
print(response.json())

# ì£¼ì‹ ì •ë³´ ì¡°íšŒ
response = requests.get(f"{BASE_URL}/stock/005930")
stock_info = response.json()
print(stock_info)

# ì¼ë³„ ë°ì´í„° ì¡°íšŒ
response = requests.get(f"{BASE_URL}/stock/005930/daily?days=30")
daily_data = response.json()
print(daily_data)
```

### JavaScript (fetch)

```javascript
// ì£¼ì‹ ì •ë³´ ì¡°íšŒ
fetch('http://localhost:8000/stock/005930')
  .then(response => response.json())
  .then(data => console.log(data));

// ì¼ë³„ ë°ì´í„° ì¡°íšŒ
fetch('http://localhost:8000/stock/005930/daily?days=30')
  .then(response => response.json())
  .then(data => console.log(data));
```

### curl

```bash
# ì£¼ì‹ ì •ë³´ ì¡°íšŒ
curl http://localhost:8000/stock/005930

# ì¼ë³„ ë°ì´í„° ì¡°íšŒ
curl http://localhost:8000/stock/005930/daily?days=30

# ë¡œê·¸ì¸
curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"is_simulation": true}'
```

## ğŸ”§ ì„¤ì •

### koapy ì„¤ì • íŒŒì¼

`~/.koapy.conf` ë˜ëŠ” `.koapy.conf` íŒŒì¼ ìƒì„±:

```hocon
koapy.backend.kiwoom_open_api_plus {
    grpc {
        port = 5943
        max_workers = 8
    }

    credential {
        user_id = "your_id"
        user_password = "your_password"
        cert_password = "cert_password"
        is_simulation = true
    }
}
```

ì„¤ì • íŒŒì¼ì´ ìˆìœ¼ë©´ ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.

## ğŸ¯ í”„ë¡œë•ì…˜ ë°°í¬

### 1. í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©

```python
import os

credential = {
    'user_id': os.getenv('KIWOOM_USER_ID'),
    'user_password': os.getenv('KIWOOM_PASSWORD'),
    'cert_password': os.getenv('KIWOOM_CERT_PASSWORD'),
    'is_simulation': os.getenv('KIWOOM_SIMULATION', 'true') == 'true'
}
```

### 2. í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ (PM2, systemd ë“±)

```bash
# PM2 ì‚¬ìš©
pm2 start unified_main_example.py --name autotrade-api --interpreter python

# systemd ì„œë¹„ìŠ¤
sudo systemctl start autotrade-api
```

### 3. ë¡œê·¸ ê´€ë¦¬

```python
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(name)s: %(message)s',
    handlers=[
        logging.FileHandler('autotrade.log'),
        logging.StreamHandler()
    ]
)
```

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### Q1: 64ë¹„íŠ¸ Pythonì—ì„œ ì‹¤í–‰ë˜ë‚˜ìš”?

**A:** ë„¤! main.pyëŠ” 64ë¹„íŠ¸ Pythonìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. koapyê°€ ë‚´ë¶€ì ìœ¼ë¡œ 32ë¹„íŠ¸ ì„œë²„ë¥¼ ìë™ ì‹¤í–‰í•©ë‹ˆë‹¤.

### Q2: 32ë¹„íŠ¸ ì„œë²„ëŠ” ì–´ë–»ê²Œ ì‹¤í–‰ë˜ë‚˜ìš”?

**A:** koapyê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤:
1. ì‹œìŠ¤í…œì—ì„œ 32ë¹„íŠ¸ Python ê²€ìƒ‰
2. ë³„ë„ í”„ë¡œì„¸ìŠ¤ë¡œ ì„œë²„ ì‹¤í–‰
3. gRPCë¡œ í†µì‹  ì—°ê²°

### Q3: ìˆ˜ë™ìœ¼ë¡œ 32ë¹„íŠ¸ ì„œë²„ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ë‚˜ìš”?

**A:** ì•„ë‹ˆìš”! koapyê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ë‹¨, 32ë¹„íŠ¸ Pythonì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

### Q4: ê¸°ì¡´ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ë‚˜ìš”?

**A:** ìµœì†Œí•œì˜ ìˆ˜ì •ë§Œ í•„ìš”í•©ë‹ˆë‹¤:
```python
# ê¸°ì¡´ ì½”ë“œ
import win32com.client
ocx = win32com.client.Dispatch("KHOPENAPI.KHOpenAPICtrl.1")

# ìƒˆ ì½”ë“œ (koapy ì‚¬ìš©)
from koapy import KiwoomOpenApiPlusEntrypoint
with KiwoomOpenApiPlusEntrypoint() as context:
    context.EnsureConnected()
    # High-level API ì‚¬ìš©
```

### Q5: ì„±ëŠ¥ì€ ì–´ë–¤ê°€ìš”?

**A:** gRPC í†µì‹ ì´ë¯€ë¡œ ì•½ê°„ì˜ ì˜¤ë²„í—¤ë“œê°€ ìˆì§€ë§Œ:
- ë„¤íŠ¸ì›Œí¬ I/Oê°€ ì•„ë‹Œ localhost í†µì‹ 
- í”„ë¡œí† ì½œ ë²„í¼ë¡œ íš¨ìœ¨ì ì¸ ì§ë ¬í™”
- ì‹¤ì œ ì‚¬ìš©ì—ì„œ ì²´ê° ì°¨ì´ ê±°ì˜ ì—†ìŒ

### Q6: ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´?

**A:** ì¼ë°˜ì ì¸ ë¬¸ì œì™€ í•´ê²°ì±…:

```python
# ImportError: koapy ì—†ìŒ
pip install koapy

# 32ë¹„íŠ¸ Python ì—†ìŒ
# â†’ 32ë¹„íŠ¸ Python ì„¤ì¹˜ ë˜ëŠ” Conda í™˜ê²½ ìƒì„±

# ë¡œê·¸ì¸ ì‹¤íŒ¨
# â†’ credential í™•ì¸ ë˜ëŠ” ìˆ˜ë™ ë¡œê·¸ì¸ ì‹œë„
```

## ğŸ“š ì°¸ê³  ìë£Œ

- koapy ê³µì‹: https://github.com/elbakramer/koapy
- AutomaticPosting-koapy: https://github.com/meteormin/AutomaticPosting-koapy
- FastAPI: https://fastapi.tiangolo.com/
- í‚¤ì›€ Open API+ ë¬¸ì„œ: https://www.kiwoom.com/

## ğŸ‰ ê²°ë¡ 

**í•˜ë‚˜ì˜ main.pyë¡œ ëª¨ë“  ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!**

- âœ… 64ë¹„íŠ¸ Pythonìœ¼ë¡œ ì‹¤í–‰
- âœ… REST API ì„œë²„ (FastAPI)
- âœ… í‚¤ì›€ Open API ì—°ë™ (koapy)
- âœ… ìë™ 32ë¹„íŠ¸ ì„œë²„ ê´€ë¦¬
- âœ… í”„ë¡œì„¸ìŠ¤ ê²©ë¦¬ë¡œ ì•ˆì •ì„±

ë” ì´ìƒ 32ë¹„íŠ¸/64ë¹„íŠ¸ ë¬¸ì œë¡œ ê³ ë¯¼í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤!
