# AutoTrade Pro 시스템 개선 로드맵

현재 시스템의 부족한 기능과 성능 이슈를 분석하고 우선순위별로 정리합니다.

---

## 🚨 심각한 문제 (즉시 해결 필요)

### 1. **분할 매수 전략이 실제로 실행 안됨**
**현재 상태:**
- AI가 "1차 40% 현재가, 2차 30% -2%, 3차 20% -4%" 같은 전략을 제시
- 하지만 `_execute_buy()`는 1회만 매수하고 끝
- `# TODO: split_strategy에 따라 분할 매수 실행` 주석만 있음

**문제점:**
- AI의 분할 매수 전략을 완전히 무시
- 평단가 낮추기 전략 미작동
- 리스크 분산 효과 없음

**해결 방안:**
```
1. SplitBuyManager 클래스 필요
   - AI 분할 전략 파싱 ("1차 40% 현재가" → {stage: 1, ratio: 0.4, price_offset: 0})
   - 각 단계별 주문 스케줄링
   - 가격 조건 모니터링 (현재가 -2%, -4% 도달 시 자동 매수)
   - 미체결 단계 관리

2. main.py 통합
   - _execute_buy()를 _execute_split_buy()로 변경
   - 매 사이클마다 미체결 분할 매수 확인
   - 가격 조건 충족 시 자동 실행

3. 데이터베이스 스키마
   - split_buy_orders 테이블 추가
   - stage, target_price, executed, quantity 등 관리
```

**예상 효과:** 평단가 개선, AI 전략 활용도 극대화

---

### 2. **스코어링 시스템 데이터 부족 (10개 중 6개 항목 0점)**
**현재 상태:**
- 거래량 급증, 가격 모멘텀, 기술적 지표, 변동성만 점수 있음
- 기관 매수세, 호가 강도, 체결 강도, 증권사 활동, 프로그램 매매, 테마/뉴스 = 0점

**문제점:**
- AI가 "기관 매수세 0점"이라고 분석하지만 실제 데이터가 없음
- 440점 만점 중 실제로는 ~160점 만점
- 스코어 신뢰도 저하

**해결 방안:**
```
1. REST API 호출 추가
   - 투자자별 매매동향 API (기관/외국인/개인)
   - 호가잔량 API (매수/매도 호가 비율)
   - 체결강도 계산 (매수체결/매도체결)

2. 크롤링 또는 외부 API
   - 증권사 리포트/목표가 (네이버금융, 증권사 API)
   - 테마/뉴스 (뉴스 API, RSS)
   - 프로그램 매매 (거래소 데이터)

3. 단기 해결책
   - 데이터 없는 항목 제거
   - 배점 재조정 (4개 항목으로 440점 분배)
```

**예상 효과:** 스코어 정확도 향상, AI 판단 신뢰도 증가

---

### 3. **매도 전략이 너무 단순함**
**현재 상태:**
- 익절 목표만 있음 (10%)
- 손절 기준 없음
- 추세 전환, 거래량 감소, 매도 시그널 무시

**문제점:**
- 주가 하락 시 무한 보유
- 기회비용 발생 (수익 안나는 종목에 자금 묶임)
- 리스크 관리 부실

**해결 방안:**
```
1. 다층 매도 조건
   - 손절: -5% (하드 스탑)
   - 기술적 손절: 20일선 하향 돌파
   - 거래량 손절: 거래량 급감 (평균 대비 30% 이하 3일 연속)
   - 시간 손절: 7일 보유 후 -2% 이상이면 매도

2. 이익 보호 전략
   - 트레일링 스탑 (최고가 대비 -3%)
   - 분할 익절 (50% @ +10%, 나머지 @ +20%)

3. AI 매도 판단 추가
   - 보유 종목도 매일 AI 분석
   - "매도" 시그널 시 즉시 처분
```

**예상 효과:** 손실 제한, 수익 극대화, 회전율 개선

---

## ⚠️ 중요한 문제 (1-2주 내 해결)

### 4. **백테스팅 기능 없음**
**현재 상태:**
- 전략 변경 시 실전에서 바로 테스트
- 과거 데이터로 검증 불가

**문제점:**
- 리스크 큰 실험
- 전략 효과를 알 수 없음
- A/B 테스트 불가능

**해결 방안:**
```
1. 백테스팅 엔진
   - 과거 데이터 재생 (1개월 ~ 1년)
   - 모든 매수/매도 시뮬레이션
   - 성과 측정 (CAGR, MDD, Sharpe Ratio, Win Rate)

2. 전략 비교
   - 현재 전략 vs 수정된 전략
   - 매개변수 최적화 (익절 8% vs 10% vs 12%)

3. 데이터 요구사항
   - 일봉/분봉 히스토리 저장
   - 거래량, 호가, 체결 데이터 필요
```

**예상 효과:** 전략 검증, 리스크 감소, 최적화 가능

---

### 5. **실시간 알림 부족**
**현재 상태:**
- 텔레그램 알림은 있지만 제한적
- 중요한 이벤트 놓침

**필요한 알림:**
```
1. 매수/매도 알림 (현재 있음)

2. 추가 필요한 알림
   - 보유 종목 급등/급락 (±5% 이상)
   - 손절 경고 (-4% 도달 시 경고, -5% 자동 손절)
   - 익절 기회 (+9% 도달 시 경고)
   - 분할 매수 진입 시점 도래
   - AI 시그널 변경 (buy → sell)
   - 시스템 에러/재연결

3. 알림 우선순위
   - 🚨 긴급 (손절, 시스템 에러)
   - ⚠️ 중요 (익절 기회, 급등락)
   - ℹ️ 정보 (매수 완료, 스캔 결과)
```

**예상 효과:** 빠른 대응, 놓치는 기회 감소

---

### 6. **포트폴리오 밸런싱 없음**
**현재 상태:**
- 종목별 비중 관리 없음
- 특정 종목에 과도한 집중 가능

**문제점:**
- 1개 종목이 50% 차지 가능
- 분산 투자 효과 없음
- 섹터 편중 위험

**해결 방안:**
```
1. 포지션 제한
   - 종목당 최대 20%
   - 섹터당 최대 40%
   - 상위 3개 종목 합계 최대 60%

2. 리밸런싱 전략
   - 주간 1회 비중 점검
   - 편중 종목 일부 매도
   - 현금 비율 유지 (최소 20%)

3. 상관관계 분석
   - 유사한 종목 동시 보유 방지
   - (삼성전자 + SK하이닉스 같이 반도체 2개 지양)
```

**예상 효과:** 리스크 분산, 안정적 수익

---

## 📊 성능 개선 (1개월 내)

### 7. **AI 프롬프트 개선 여지**
**현재 상태:**
- 프롬프트는 개선되었지만 여전히 단순
- 시장 맥락 정보 부족

**추가 가능한 정보:**
```
1. 시장 환경
   - 코스피/코스닥 지수 변동
   - 시장 전체 거래대금
   - 섹터 강약 (반도체↑ 자동차↓)

2. 종목 심화 정보
   - 최근 5일 가격 추이 그래프 (텍스트)
   - 전일 대비 거래량 변화 추이
   - 동종 업계 타 종목 비교

3. 과거 학습
   - "이 종목 3일 전 350점이었는데 -5% 손실"
   - "유사 패턴 종목 10개 중 7개 익절 성공"
```

**예상 효과:** AI 판단 정확도 향상

---

### 8. **성과 분석 및 리포트 부족**
**현재 상태:**
- 통계는 있지만 인사이트 없음
- "왜 수익/손실 났는지" 분석 없음

**필요한 분석:**
```
1. 일일 리포트
   - 당일 거래 요약
   - 실현 손익 / 미실현 손익
   - 최고/최악 종목

2. 주간 리포트
   - 주간 수익률
   - 승률, 평균 보유 기간
   - 주요 패턴 (어떤 점수 구간이 잘 맞는지)

3. 월간 리포트
   - 월간 수익률
   - 최대 낙폭 (MDD)
   - 샤프 비율
   - 섹터별 성과
   - 전략 효과성 분석

4. 시각화
   - 수익률 그래프
   - 포트폴리오 구성 파이 차트
   - 일별 거래 히트맵
```

**예상 효과:** 전략 개선 근거, 학습 효과

---

### 9. **데이터베이스 활용도 낮음**
**현재 상태:**
- DB에 기록은 하지만 조회/분석 안함
- Trade, Position, PortfolioSnapshot 테이블 방치

**활용 방안:**
```
1. 쿼리 분석
   - 최근 30일 거래 중 승률
   - 보유 기간별 수익률 (1일 vs 3일 vs 7일)
   - 점수 구간별 성과 (300-350점 vs 350-400점)
   - 시간대별 성과 (장 초반 vs 장 후반 매수)

2. 패턴 발견
   - 수익 난 종목의 공통점
   - 손실 난 종목의 공통점
   - 어떤 조건에서 AI가 정확한지

3. 자동 최적화
   - 데이터 기반으로 매개변수 자동 조정
   - 익절/손절 비율 최적화
   - 최소 점수 기준 조정
```

**예상 효과:** 데이터 기반 의사결정, 전략 진화

---

### 10. **종목 발굴 범위 제한적**
**현재 상태:**
- 3가지 전략만 (거래량 급증, 가격 모멘텀, 신고가 돌파)
- 코스피/코스닥 일부만 스캔

**확장 가능한 전략:**
```
1. 기술적 분석 기반
   - 골든크로스 (5일선 > 20일선)
   - 볼린저밴드 하단 터치 후 반등
   - RSI 과매도 후 상승 전환
   - 거래량 동반 지지선 터치

2. 펀더멘털 기반
   - PER/PBR 저평가
   - 실적 서프라이즈 (예상 대비 호실적)
   - 배당 수익률

3. 이벤트 기반
   - 공시 (유상증자, 합병, 신제품)
   - 뉴스 (대규모 수주, 신규 사업)
   - 테마 (정부 정책, 산업 트렌드)

4. 통계적 접근
   - 평균 회귀 (급락 후 반등)
   - 페어 트레이딩 (상관관계 역행)
```

**예상 효과:** 기회 확대, 다양한 시장 환경 대응

---

## 🔧 기술 부채 (시간 날 때)

### 11. **코드 중복 많음**
- 가격 조회, 점수 계산 등 중복 코드
- 리팩토링 필요

### 12. **에러 핸들링 부족**
- API 실패 시 재시도 로직 불완전
- 예외 상황 대응 미흡

### 13. **테스트 코드 없음**
- 유닛 테스트, 통합 테스트 부재
- 수동 테스트만 의존

### 14. **설정 관리 복잡**
- config.yaml, secrets.json 분산
- 환경별 설정 어려움

### 15. **로깅 개선 필요**
- 로그 레벨 조정
- 로그 파일 로테이션
- 구조화된 로깅 (JSON)

---

## 🎯 우선순위 제안

### Phase 1: 즉시 (이번 주)
1. ✅ **분할 매수 전략 실제 구현** - 가장 시급
2. ✅ **매도 전략 개선** (손절 추가)
3. ✅ **실시간 알림 확대**

### Phase 2: 단기 (1-2주)
4. ✅ **스코어링 데이터 보강** (REST API 추가)
5. ✅ **백테스팅 엔진**
6. ✅ **포트폴리오 밸런싱**

### Phase 3: 중기 (1개월)
7. ✅ **성과 분석 대시보드**
8. ✅ **DB 활용 분석**
9. ✅ **종목 발굴 전략 확장**

### Phase 4: 장기 (2-3개월)
10. ✅ **AI 프롬프트 고도화** (시장 맥락, 과거 학습)
11. ✅ **코드 리팩토링**
12. ✅ **자동 최적화 시스템** (강화학습)

---

## 💡 핵심 요약

**당장 해야 할 것 (수익에 직접 영향):**
1. 분할 매수 실행 → AI 전략 활용
2. 손절 기준 추가 → 손실 제한
3. 스코어링 데이터 확보 → 정확도 향상

**중요하지만 급하지 않은 것:**
- 백테스팅 (전략 검증용)
- 성과 분석 (개선 방향 파악)
- 코드 품질 개선

**나중에 해도 되는 것:**
- 자동 최적화 AI
- 고급 통계 분석
- 코드 리팩토링

---

## 📝 실행 계획 예시

**Week 1:**
- [ ] SplitBuyManager 구현
- [ ] 손절 전략 추가 (-5% 하드 스탑)
- [ ] 텔레그램 알림 확대

**Week 2:**
- [ ] 투자자별 매매동향 API 연동
- [ ] 호가잔량 API 연동
- [ ] 스코어링 재배점

**Week 3:**
- [ ] 백테스팅 엔진 기본 구조
- [ ] 과거 1개월 데이터 수집
- [ ] 현재 전략 검증

**Week 4:**
- [ ] 포트폴리오 밸런싱 로직
- [ ] 주간 리포트 자동 생성
- [ ] 대시보드 개선

이후 데이터가 쌓이면 자동 최적화, AI 강화학습으로 발전 가능.
