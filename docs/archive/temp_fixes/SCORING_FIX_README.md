# 스코어링 0점 문제 해결 가이드

## 🔍 현재 상황

디버그 로그를 보니 **config.yaml이 로드되지 않고 있습니다**:
```
[DEBUG 체결강도] 018880: min_value=120, config에서 로드=120
[DEBUG 프로그램] 018880: min_net_buy=5000000, config에서 로드=5000000
```

**예상 값**: min_value=50, min_net_buy=100000
**실제 로드**: min_value=120, min_net_buy=5000000 ❌

## ✅ 해결 방법

### 1단계: main.py 완전 재시작

ConfigManager는 시작 시 한 번만 config를 로드합니다. **완전히 종료하고 재시작**해야 합니다.

```bash
# main.py가 실행 중이면 Ctrl+C로 종료
# 그리고 재시작
python main.py
```

재시작 후 디버그 로그 확인:
```
[DEBUG 체결강도] XXX: min_value=50  # ✅ 이렇게 나와야 함
[DEBUG 프로그램] XXX: min_net_buy=100000  # ✅ 이렇게 나와야 함
```

### 2단계: config.yaml 파일 확인

config.yaml이 올바르게 생성되었는지 확인:

```bash
cat config/config.yaml | grep -A2 "execution_intensity:"
cat config/config.yaml | grep -A2 "program_trading:"
```

**예상 출력**:
```yaml
execution_intensity:
  weight: 40
  min_value: 50  # % (120 → 50으로 실제 시장 데이터에 맞게 조정)

program_trading:
  weight: 40
  min_net_buy: 100000  # 원 (500만원 → 10만원으로 실제 시장 데이터에 맞게 조정)
```

### 3단계: 재시작 후 예상 결과

체결강도 79.0 → **20점** (50 이상 70 미만 = 50% 획득)
```
[DEBUG 체결강도] 018880: execution_intensity=79.0 (type=<class 'float'>)
[DEBUG 체결강도] 018880: min_value=50, config에서 로드=50
[DEBUG 체결강도] 018880: 79.0 → 20.0점  ✅
```

프로그램 2,163원 → **0점** (10만원 미만이라 정상)
```
[DEBUG 프로그램] 018880: program_net_buy=2163 (type=<class 'int'>)
[DEBUG 프로그램] 018880: min_net_buy=100000, config에서 로드=100000
[DEBUG 프로그램] 018880: 2,163원 → 0.0점  ✅
```

---

## 📊 차트 분봉 테스트

대시보드에서 일봉만 받아오는 문제를 해결하기 위해 **모든 분봉 타입을 테스트**하는 파일을 만들었습니다.

### 테스트 실행

```bash
python tests/manual_tests/test_chart_timeframes.py
```

### 테스트 내용

이 파일은 다음을 **모두 자동으로 테스트**합니다:

1. **일봉**: ka10081 (✅ 검증 완료)
2. **1분봉**: 10가지 방법으로 시도
3. **3분봉**: 10가지 방법으로 시도
4. **5분봉**: 10가지 방법으로 시도
5. **10분봉**: 10가지 방법으로 시도
6. **60분봉**: 10가지 방법으로 시도

### 시도하는 방법들

- ✅ ka10081 + 분봉 파라미터 (inq_tp, period, chart_type 등)
- ✅ 다른 API ID (ka10002, ka10003, ka10004, ka10005, ka10080, ka10082)
- ✅ 다른 path (mrkcond, stkinfo, stkprc, inquire)
- ✅ 시간 범위 지정 (fr_dt, to_dt)
- ✅ 다양한 파라미터 조합

### 결과 확인

성공한 API는 자동으로 저장됩니다:
```
tests/manual_tests/successful_chart_apis.json
```

이 파일을 열면 성공한 API ID, path, body 조합을 확인할 수 있습니다.

---

## 🔍 증권사 데이터 "순매수 없음" 문제

이건 **정상입니다**. 증권사별 매매는 모든 종목에 항상 있는 것이 아닙니다.

출력에서:
```
증권사: 순매수 없음
```

이것은 5개 주요 증권사(한국투자, 미래에셋, NH투자, 삼성, 신한)가 **모두 순매도하거나 거래가 없다**는 뜻입니다.

### 확인 방법

실제로 데이터가 있는 종목에서는 이렇게 나옵니다:
```
증권사: 순매수증권사=3개, 순매수총량=150,000주
```

데이터가 없는 것이 오류가 아니라 **실제 시장 상황**을 반영하는 것입니다.

---

## 📝 다음 단계

1. ✅ **main.py 재시작** → config 적용 확인
2. ✅ **차트 분봉 테스트 실행** → 성공하는 분봉 API 찾기
3. ✅ **successful_chart_apis.json 확인** → 성공한 API를 대시보드에 적용

---

## 🎯 최종 기대 결과

### 스코어링 (main.py 재시작 후)

```
상세: 거래량:45/60, 가격:60/60, 기관:10/60,
      호가:10/40,     # ← 0에서 10으로 증가
      체결:20/40,     # ← 0에서 20으로 증가
      증권사:0/40,    # 데이터 없어서 0 (정상)
      프로그램:0/40,  # 10만원 미만이라 0 (정상)
      기술:35/40, 테마:0/40, 변동성:14/20
```

### 차트 분봉

테스트 후 성공한 API를 찾아 대시보드에 적용합니다.

---

**문제 지속 시**: 디버그 로그를 캡처해서 보여주세요. 정확한 원인을 파악하겠습니다.
