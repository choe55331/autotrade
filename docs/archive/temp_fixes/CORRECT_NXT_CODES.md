# âš ï¸ ì¤‘ìš” ë°œê²¬: ì˜ëª»ëœ ì½”ë“œ ì‚¬ìš©!

## ë¬¸ì œ ë°œê²¬

ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ **ì˜ëª»ëœ trde_tp ì½”ë“œ**ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤!

### âŒ ì´ì „ í…ŒìŠ¤íŠ¸ (0/33 ì‹¤íŒ¨)

```python
# ì´ê²ƒë“¤ì„ í…ŒìŠ¤íŠ¸í–ˆì§€ë§Œ ëª¨ë‘ ì‹¤íŒ¨
'10': 'ë³´í†µ(IOC)',
'13': 'ì‹œì¥ê°€(IOC)',
'16': 'ìµœìœ ë¦¬(IOC)',
'20': 'ë³´í†µ(FOK)',
'23': 'ì‹œì¥ê°€(FOK)',
'26': 'ìµœìœ ë¦¬(FOK)'
```

### âœ… í‚¤ì›€ì¦ê¶Œ ê³µì‹ ë¬¸ì„œ (kiwoom_docs/ì£¼ë¬¸.md)

```python
# ì‹¤ì œ NXT ì‹œê°„ì™¸ ê±°ë˜ ì½”ë“œ
'61': 'ì¥ì‹œì‘ì „ì‹œê°„ì™¸',  # í”„ë¦¬ë§ˆì¼“ (08:00-09:00)
'62': 'ì‹œê°„ì™¸ë‹¨ì¼ê°€',     # NXT ì‹œê°„
'81': 'ì¥ë§ˆê°í›„ì‹œê°„ì™¸',   # ì• í”„í„°ë§ˆì¼“ (15:30-20:00)
```

## ğŸ” ì™œ ì‹¤íŒ¨í–ˆë‚˜?

| ì´ì „ ì½”ë“œ | ì˜ë¯¸ | ì‹¤ì œ ìš©ë„ |
|----------|------|-----------|
| 10 | ë³´í†µ(IOC) | ì •ê·œì¥ ì¦‰ì‹œ ì²´ê²°/ì·¨ì†Œ |
| 13 | ì‹œì¥ê°€(IOC) | ì •ê·œì¥ ì¦‰ì‹œ ì²´ê²°/ì·¨ì†Œ |
| 16 | ìµœìœ ë¦¬(IOC) | ì •ê·œì¥ ì¦‰ì‹œ ì²´ê²°/ì·¨ì†Œ |

â†’ **ëª¨ë‘ ì •ê·œì¥ ì „ìš©!** NXT ì‹œê°„ì— ì‚¬ìš© ë¶ˆê°€!

| ì •ë‹µ ì½”ë“œ | ì˜ë¯¸ | ì‹¤ì œ ìš©ë„ |
|----------|------|-----------|
| 61 | ì¥ì‹œì‘ì „ì‹œê°„ì™¸ | í”„ë¦¬ë§ˆì¼“ (08:00-09:00) |
| 62 | ì‹œê°„ì™¸ë‹¨ì¼ê°€ | NXT ì‹œê°„ëŒ€ |
| 81 | ì¥ë§ˆê°í›„ì‹œê°„ì™¸ | ì• í”„í„°ë§ˆì¼“ (15:30-20:00) |

â†’ **NXT ì „ìš© ì½”ë“œ!**

---

## ğŸ¯ ì •ë‹µ í…ŒìŠ¤íŠ¸

### ì¦‰ì‹œ ì‹¤í–‰ (NXT ì‹œê°„ì—):

```bash
python test_nxt_orders_correct.py
```

### ì˜ˆìƒ ì„±ê³µ ì¡°í•©

#### ì• í”„í„°ë§ˆì¼“ (15:30-20:00) - ì§€ê¸ˆ!
```python
# ê°€ì¥ ê°€ëŠ¥ì„± ë†’ìŒ
dmst_stex_tp = 'NXT'
trde_tp = '81'  # ì¥ë§ˆê°í›„ì‹œê°„ì™¸

# ë˜ëŠ”
dmst_stex_tp = 'NXT'
trde_tp = '62'  # ì‹œê°„ì™¸ë‹¨ì¼ê°€
```

#### í”„ë¦¬ë§ˆì¼“ (08:00-09:00)
```python
dmst_stex_tp = 'NXT'
trde_tp = '61'  # ì¥ì‹œì‘ì „ì‹œê°„ì™¸
```

---

## ğŸ“˜ í‚¤ì›€ì¦ê¶Œ ë¬¸ì„œ ì „ì²´ ì½”ë“œ

```python
trde_tp_codes = {
    # ì •ê·œì¥ (09:00-15:30)
    '0': 'ë³´í†µ',
    '3': 'ì‹œì¥ê°€',
    '5': 'ì¡°ê±´ë¶€ì§€ì •ê°€',
    '6': 'ìµœìœ ë¦¬ì§€ì •ê°€',
    '7': 'ìµœìš°ì„ ì§€ì •ê°€',

    # ì‹œê°„ì™¸ â­
    '61': 'ì¥ì‹œì‘ì „ì‹œê°„ì™¸',  # 08:00-09:00
    '62': 'ì‹œê°„ì™¸ë‹¨ì¼ê°€',     # NXT ì‹œê°„
    '81': 'ì¥ë§ˆê°í›„ì‹œê°„ì™¸',   # 15:30-20:00

    # IOC (Immediate or Cancel)
    '10': 'ë³´í†µ(IOC)',
    '13': 'ì‹œì¥ê°€(IOC)',
    '16': 'ìµœìœ ë¦¬(IOC)',

    # FOK (Fill or Kill)
    '20': 'ë³´í†µ(FOK)',
    '23': 'ì‹œì¥ê°€(FOK)',
    '26': 'ìµœìœ ë¦¬(FOK)',

    # ê¸°íƒ€
    '28': 'ìŠ¤í†±ì§€ì •ê°€',
    '29': 'ì¤‘ê°„ê°€',
    '30': 'ì¤‘ê°„ê°€(IOC)',
    '31': 'ì¤‘ê°„ê°€(FOK)'
}
```

---

## ğŸš€ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì§€ê¸ˆ ë°”ë¡œ)

```bash
python test_nxt_orders_correct.py
```

**í˜„ì¬ ì‹œê°ì´ ì• í”„í„°ë§ˆì¼“(15:30-20:00)ì´ë¯€ë¡œ:**
- 61, 62, 81 ì½”ë“œë§Œ í…ŒìŠ¤íŠ¸
- KRX, NXT, SOR ì¡°í•©
- ì´ 6ê°œ ì¡°í•©

### 2. ì˜ˆìƒ ê²°ê³¼

```
âœ… ì„±ê³µí•  ê²ƒìœ¼ë¡œ ì˜ˆìƒ:
   ğŸ¯ NXT + ì¥ë§ˆê°í›„ì‹œê°„ì™¸(81)
      dmst_stex_tp=NXT
      trde_tp=81
      ì£¼ë¬¸ë²ˆí˜¸: XXXXXX

   ğŸ¯ NXT + ì‹œê°„ì™¸ë‹¨ì¼ê°€(62)
      dmst_stex_tp=NXT
      trde_tp=62
      ì£¼ë¬¸ë²ˆí˜¸: XXXXXX
```

### 3. ê²°ê³¼ í™•ì¸

```bash
# í…ŒìŠ¤íŠ¸ í›„ ê²°ê³¼ í™•ì¸
dir test_results_nxt_correct_*.json

# ê°€ì¥ ìµœê·¼ ê²°ê³¼ ë³´ê¸°
python -c "import json; print(json.dumps(json.load(open(max(__import__('glob').glob('test_results_nxt_correct_*.json')))), indent=2, ensure_ascii=False))"
```

---

## ğŸ’¡ ì„±ê³µ í›„ ì ìš©

### api/order.py ìˆ˜ì •

```python
def buy_stock(self, stock_code: str, quantity: int, price: int) -> Optional[str]:
    """ì£¼ì‹ ë§¤ìˆ˜ (NXT ì‹œê°„ëŒ€ ì§€ì›)"""
    from utils.trading_date import is_nxt_hours
    from datetime import datetime

    if is_nxt_hours():
        # NXT ì‹œê°„ëŒ€
        now = datetime.now()
        hour = now.hour

        if hour == 8:
            # í”„ë¦¬ë§ˆì¼“ (08:00-09:00)
            dmst_stex_tp = "NXT"
            trde_tp = "61"  # ì¥ì‹œì‘ì „ì‹œê°„ì™¸
        else:
            # ì• í”„í„°ë§ˆì¼“ (15:30-20:00)
            dmst_stex_tp = "NXT"
            trde_tp = "81"  # ì¥ë§ˆê°í›„ì‹œê°„ì™¸ (ë˜ëŠ” "62" ì‹œê°„ì™¸ë‹¨ì¼ê°€)
    else:
        # ì •ê·œì¥ (09:00-15:30)
        dmst_stex_tp = "KRX"
        trde_tp = "0"  # ë³´í†µ

    body = {
        "dmst_stex_tp": dmst_stex_tp,
        "stk_cd": stock_code,
        "ord_qty": str(quantity),
        "ord_uv": str(price),
        "trde_tp": trde_tp
    }

    response = self.client.request(
        api_id='kt10000',
        body=body,
        path='ordr'
    )

    if response and response.get('return_code') == 0:
        return response.get('ord_no')

    return None
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `test_nxt_orders_correct.py` ì‹¤í–‰
- [ ] ì„±ê³µí•œ ì¡°í•© í™•ì¸
- [ ] `api/order.py` ìˆ˜ì •
- [ ] main.py ì¬ì‹œì‘
- [ ] ì‹¤ì œ ë§¤ìˆ˜ í…ŒìŠ¤íŠ¸
- [ ] âœ… ì„±ê³µ!

---

## ğŸ“Œ ìš”ì•½

**ë¬¸ì œ**: trde_tp ì½”ë“œë¥¼ ì˜ëª» ì‚¬ìš© (10, 13, 16 ë“±)
**ì›ì¸**: ì •ê·œì¥ ì „ìš© ì½”ë“œë¥¼ NXT ì‹œê°„ì— ì‚¬ìš©
**í•´ê²°**: ë¬¸ì„œì˜ ì •í™•í•œ ì½”ë“œ ì‚¬ìš© (61, 62, 81)

**ì¦‰ì‹œ ì‹¤í–‰**:
```bash
python test_nxt_orders_correct.py
```

ì´ì œ ì£¼ë¬¸ì´ ì„±ê³µí•  ê²ƒì…ë‹ˆë‹¤! ğŸ‰
