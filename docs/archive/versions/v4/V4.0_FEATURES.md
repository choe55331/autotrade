# AutoTrade Pro v4.0 - ê³ ê¸‰ ê¸°ëŠ¥ ê°€ì´ë“œ

## ê°œìš”

AutoTrade Pro v4.0ì€ 30ê°œ ì´ìƒì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ì „ë¬¸ì ì¸ ìë™ ë§¤ë§¤ ì‹œìŠ¤í…œìœ¼ë¡œ ì§„í™”í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ ê¸°ëŠ¥ì  ìš”ì†Œ (Functional Elements)

### 1. ê³ ê¸‰ ë°±í…ŒìŠ¤íŒ… ë¦¬í¬íŠ¸ ìƒì„±ê¸° (Advanced Backtest Report Generator)
**ìœ„ì¹˜**: `ai/backtest_report_generator.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- HTML/PDF í˜•ì‹ì˜ ìƒì„¸ ë°±í…ŒìŠ¤íŒ… ë¦¬í¬íŠ¸ ìƒì„±
- Plotly ê¸°ë°˜ ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸ (Equity Curve, Drawdown, Monthly Returns)
- ì£¼ìš” ì„±ê³¼ ì§€í‘œ (Sharpe Ratio, Max Drawdown, Win Rate, Profit Factor)

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from ai import BacktestReportGenerator

generator = BacktestReportGenerator()
html_path = generator.generate_html_report(backtest_result)
pdf_path = generator.generate_pdf_report(backtest_result)
```

---

### 2. ì „ëµ íŒŒë¼ë¯¸í„° ìë™ ìµœì í™” (Strategy Parameter Optimizer)
**ìœ„ì¹˜**: `ai/strategy_optimizer.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- Grid Search: ëª¨ë“  íŒŒë¼ë¯¸í„° ì¡°í•© íƒìƒ‰
- Random Search: ë¬´ì‘ìœ„ ìƒ˜í”Œë§
- Bayesian Optimization: Optuna ê¸°ë°˜ ì§€ëŠ¥í˜• íƒìƒ‰

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from ai import StrategyOptimizer

optimizer = StrategyOptimizer(
    objective_function=backtest_function,
    param_ranges={
        'ma_period': [5, 10, 20, 30],
        'rsi_threshold': [30, 40, 50, 60, 70]
    },
    method='bayesian',
    n_trials=50
)

result = optimizer.optimize()
print(f"Best params: {result.best_params}")
print(f"Best score: {result.best_score}")
```

---

### 3. ML ê¸°ë°˜ ì´ìƒ ê°ì§€ ì‹œìŠ¤í…œ (Anomaly Detection)
**ìœ„ì¹˜**: `ai/anomaly_detector.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- Isolation Forest ê¸°ë°˜ ì´ìƒì¹˜ íƒì§€
- API ì‘ë‹µ ì‹œê°„, ì£¼ë¬¸ ì‹¤íŒ¨ìœ¨, ì”ê³  ë³€ë™ ëª¨ë‹ˆí„°ë§
- ì‹¤ì‹œê°„ ì•Œë¦¼ ë° ë¡œê¹…

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from ai import AnomalyDetector

detector = AnomalyDetector()
anomalies = detector.check_anomalies()

for anomaly in anomalies:
    print(f"[{anomaly.anomaly_type}] {anomaly.description}")
    print(f"Severity: {anomaly.severity}")
```

---

### 4. REST API í”„ë ˆì„ì›Œí¬ (FastAPI)
**ìœ„ì¹˜**: `api_server/main.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ì™¸ë¶€ì—ì„œ ì„¤ì • ì¡°íšŒ/ë³€ê²½
- ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰
- íŒŒë¼ë¯¸í„° ìµœì í™” ì‹¤í–‰
- ì‹œì¥ ë ˆì§ ë¶„ì„
- ì´ìƒ ê°ì§€ ì¡°íšŒ

**ì—”ë“œí¬ì¸íŠ¸**:
```
GET  /api/settings              # ì„¤ì • ì¡°íšŒ
POST /api/settings              # ì„¤ì • ì €ì¥
POST /api/backtest/run          # ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰
POST /api/optimization/run      # ìµœì í™” ì‹¤í–‰
GET  /api/market-regime         # ì‹œì¥ ë ˆì§ ë¶„ì„
GET  /api/anomalies             # ì´ìƒì¹˜ ì¡°íšŒ
GET  /api/system-connections    # ì‹œìŠ¤í…œ ì—°ê²° ìƒíƒœ
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
cd api_server
uvicorn main:app --reload --port 8000
# http://localhost:8000/docs ì—ì„œ Swagger ë¬¸ì„œ í™•ì¸
```

---

### 5. ê³¼ê±° ë°ì´í„° ë¦¬í”Œë ˆì´ ì‹œë®¬ë ˆì´í„° (Replay Simulator)
**ìœ„ì¹˜**: `features/replay_simulator.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- íŠ¹ì • ë‚ ì§œ/ì‹œê°„ì˜ ì‹œì¥ ë°ì´í„° ì¬í˜„
- í˜¸ê°€ì°½, ì²´ê²° ë‚´ì—­ í¬í•¨
- ì¬ìƒ ì†ë„ ì¡°ì ˆ (1x ~ 100x)
- ì½œë°± ê¸°ë°˜ ì´ë²¤íŠ¸ ì²˜ë¦¬

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from features import ReplaySimulator

simulator = ReplaySimulator(playback_speed=10.0)
simulator.load_historical_data("005930", "2024-01-15")

def on_tick(snapshot):
    print(f"[{snapshot.timestamp}] {snapshot.stock_code}: {snapshot.price:,}ì›")

simulator.register_callback(on_tick)
simulator.play()
```

---

### 6. í¬íŠ¸í´ë¦¬ì˜¤ ìë™ ë¦¬ë°¸ëŸ°ì‹± (Portfolio Rebalancer)
**ìœ„ì¹˜**: `features/portfolio_rebalancer.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ì‹œê°„ ê¸°ë°˜ ë¦¬ë°¸ëŸ°ì‹± (ì¼/ì£¼/ì›”)
- ì„ê³„ì¹˜ ê¸°ë°˜ ë¦¬ë°¸ëŸ°ì‹± (í¸ì°¨ 5% ì´ìƒ)
- Risk Parity ì „ëµ ì§€ì›

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from features import PortfolioRebalancer, RebalancingMethod

rebalancer = PortfolioRebalancer(
    method=RebalancingMethod.TIME_BASED,
    frequency='monthly',
    threshold_pct=0.05
)

target_weights = {'005930': 0.3, '000660': 0.3, '035720': 0.4}
current_holdings = rebalancer.get_current_holdings()

if rebalancer.should_rebalance(target_weights, current_holdings):
    orders = rebalancer.calculate_rebalancing_orders(target_weights, current_holdings)
    rebalancer.execute_rebalancing(orders)
```

---

### 7. í†µí•© ì„¤ì • ê´€ë¦¬ ì‹œìŠ¤í…œ (Unified Settings Manager)
**ìœ„ì¹˜**: `config/unified_settings.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- YAML ê¸°ë°˜ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„¤ì • ê´€ë¦¬
- ì‹¤ì‹œê°„ ë³€ê²½ ê°ì§€ ë° ì½œë°±
- 7ê°€ì§€ ì¹´í…Œê³ ë¦¬ (ì‹œìŠ¤í…œ, ë¦¬ìŠ¤í¬, ì „ëµ, AI, ë°±í…ŒìŠ¤íŒ…, API, UI)

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from config import get_unified_settings

settings = get_unified_settings()

# ì„¤ì • ì¡°íšŒ
risk_settings = settings.get_category('risk_management')
print(risk_settings['max_position_size'])

# ì„¤ì • ë³€ê²½
settings.update_category('risk_management', {
    'max_position_size': 0.25
})

# ë³€ê²½ ê°ì§€ ì½œë°±
def on_settings_changed(category, old_value, new_value):
    print(f"[{category}] ì„¤ì • ë³€ê²½: {old_value} -> {new_value}")

settings.register_callback('risk_management', on_settings_changed)
```

---

## ğŸ“Š ë§¤ë§¤ ì „ëµ ìš”ì†Œ (Trading Strategies)

### 1. ë™ì  ì†ì ˆ/ìµì ˆ ê´€ë¦¬ (Trailing Stop with ATR)
**ìœ„ì¹˜**: `strategy/trailing_stop_manager.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ATR ê¸°ë°˜ ë™ì  ì†ì ˆê°€ ì¡°ì •
- ìˆ˜ìµ ë°œìƒ ì‹œ ì†ì ˆì„  ìƒí–¥ (Trailing Stop)
- ìµœì†Œ ìˆ˜ìµ ë³´í˜¸ ê¸°ëŠ¥

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from strategy import TrailingStopManager

manager = TrailingStopManager({
    'atr_multiplier': 2.0,
    'activation_pct': 0.03,  # 3% ìˆ˜ìµ ì‹œ í™œì„±í™”
    'min_profit_lock_pct': 0.50  # ìµœì†Œ ìˆ˜ìµì˜ 50% ë³´í˜¸
})

# í¬ì§€ì…˜ ì¶”ê°€
manager.add_position("005930", entry_price=70000, atr_value=1000)

# ê°€ê²© ì—…ë°ì´íŠ¸
should_sell, reason = manager.update("005930", current_price=72000)
if should_sell:
    print(f"ë§¤ë„ ì‹ í˜¸: {reason}")
```

---

### 2. ë³€ë™ì„± ëŒíŒŒ ì „ëµ (Volatility Breakout)
**ìœ„ì¹˜**: `strategy/volatility_breakout_strategy.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- Larry Williamsì˜ ë³€ë™ì„± ëŒíŒŒ ì „ëµ
- ëª©í‘œê°€ = ì‹œê°€ + (ì „ì¼ ê³ ê°€ - ì „ì¼ ì €ê°€) Ã— K
- ê±°ë˜ëŸ‰ í•„í„° ë° ì¥ì¤‘ ì²­ì‚°

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from strategy import VolatilityBreakoutStrategy

strategy = VolatilityBreakoutStrategy(
    k_value=0.5,
    volume_multiplier=1.5
)

# ì§„ì… ì‹ í˜¸ í™•ì¸
is_entry, reason = strategy.check_entry_signal(
    stock_code="005930",
    current_time=datetime.now().time(),
    today_open=70000,
    current_price=72000,
    current_volume=1000000
)

# ì²­ì‚° ì‹ í˜¸ í™•ì¸
is_exit, reason = strategy.check_exit_signal(
    stock_code="005930",
    current_time=datetime.now().time()
)
```

---

### 3. í˜ì–´ íŠ¸ë ˆì´ë”© ì „ëµ (Pairs Trading)
**ìœ„ì¹˜**: `strategy/pairs_trading_strategy.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- í†µê³„ì  ì°¨ìµê±°ë˜ (Statistical Arbitrage)
- Spread íšŒê·€ ë¶„ì„
- Z-Score ê¸°ë°˜ ì§„ì…/ì²­ì‚°

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from strategy import PairsTradingStrategy

strategy = PairsTradingStrategy(
    entry_threshold=2.0,  # Z-score 2.0 ì´ìƒ ì‹œ ì§„ì…
    exit_threshold=0.5,   # Z-score 0.5 ì´í•˜ ì‹œ ì²­ì‚°
    stop_loss_threshold=3.0
)

# í˜ì–´ ì¶”ê°€
strategy.add_pair("PAIR_1", "005930", "000660", lookback_days=60)

# ê°€ê²© ì—…ë°ì´íŠ¸
strategy.update_prices("PAIR_1", price_a=70000, price_b=140000)

# ì§„ì… ì‹ í˜¸ í™•ì¸
is_entry, direction = strategy.check_entry_signal("PAIR_1")
if is_entry:
    print(f"í˜ì–´ íŠ¸ë ˆì´ë”© ì§„ì…: {direction}")
```

---

### 4. ì‹œì¥ ë ˆì§ ë¶„ë¥˜ (Market Regime Classification)
**ìœ„ì¹˜**: `ai/market_regime_classifier.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- Bull/Bear/Sideways ì‹œì¥ ë¶„ë¥˜
- ë³€ë™ì„± ìˆ˜ì¤€ íƒì§€ (Low/Medium/High)
- ë ˆì§ë³„ ì „ëµ ì¶”ì²œ

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from ai import MarketRegimeClassifier

classifier = MarketRegimeClassifier()

regime, volatility, confidence = classifier.classify(
    price_history=[70000, 71000, 72000, ...],
    volume_history=[1000000, 1200000, ...]
)

print(f"Market Regime: {regime}")  # BULL, BEAR, SIDEWAYS
print(f"Volatility: {volatility}")  # LOW, MEDIUM, HIGH
print(f"Confidence: {confidence:.2f}")

# ì¶”ì²œ ì „ëµ
strategy_recommendation = classifier.get_strategy_recommendation(regime, volatility)
print(f"Recommended: {strategy_recommendation}")
```

---

### 5. í€€íŠ¸ íŒ©í„° ìŠ¤í¬ë¦¬ë‹ (Quant Factor Screening)
**ìœ„ì¹˜**: `research/quant_screener.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- Magic Formula (Joel Greenblatt)
- Multi-Factor Screening (Value, Quality, Momentum, Low Volatility)
- ì¢…ëª© ë­í‚¹ ë° í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from research import QuantScreener

screener = QuantScreener()

# ìƒ˜í”Œ ì¢…ëª© ë°ì´í„°
stocks = [
    StockFactors(
        stock_code="005930",
        earnings_yield=0.08,
        roc=0.15,
        pb_ratio=1.5,
        pe_ratio=12,
        momentum_12m=0.20,
        volatility=0.25
    ),
    # ... ë” ë§ì€ ì¢…ëª©
]

# Magic Formula ìŠ¤í¬ë¦¬ë‹
top_stocks = screener.magic_formula_screen(stocks, top_n=30)

# Multi-Factor ìŠ¤í¬ë¦¬ë‹
weights = {'value': 0.3, 'quality': 0.3, 'momentum': 0.2, 'low_volatility': 0.2}
top_stocks = screener.multi_factor_screen(stocks, weights, top_n=30)
```

---

### 6. Kelly Criterion ìê¸ˆ ê´€ë¦¬ (Kelly Criterion Money Management)
**ìœ„ì¹˜**: `strategy/kelly_criterion.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ìµœì  í¬ì§€ì…˜ ì‚¬ì´ì§•
- Full Kelly / Fractional Kelly
- ë¦¬ìŠ¤í¬ ì¡°ì • í¬ì§€ì…˜ í¬ê¸° ê³„ì‚°

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from strategy import KellyCriterion, KellyParameters

kelly = KellyCriterion(max_position_size=0.30)

params = KellyParameters(
    win_rate=0.55,
    avg_win=5000,
    avg_loss=3000,
    total_capital=10000000,
    kelly_fraction=0.5  # Half Kelly (ë³´ìˆ˜ì )
)

optimal_pct = kelly.calculate_kelly_percentage(params)
position_size = kelly.calculate_position_size(params)

print(f"Optimal allocation: {optimal_pct*100:.2f}%")
print(f"Position size: {position_size:,}ì›")
```

---

### 7. ê¸°ê´€/ì™¸êµ­ì¸ ì¶”ì¢… ì „ëµ (Institutional Following Strategy)
**ìœ„ì¹˜**: `strategy/institutional_following_strategy.py`

**ì£¼ìš” ê¸°ëŠ¥**:
- ê¸°ê´€/ì™¸êµ­ì¸ ìˆœë§¤ìˆ˜ ì¶”ì 
- ì—°ì† ë§¤ìˆ˜ì¼ íƒì§€
- ìµœì†Œ ë§¤ìˆ˜ ê·œëª¨ í•„í„°

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
from strategy import InstitutionalFollowingStrategy, InstitutionalData

strategy = InstitutionalFollowingStrategy(
    consecutive_days=3,
    min_net_buy_volume=100000,
    min_net_buy_amount=1000000000
)

# ê±°ë˜ ë°ì´í„° ì¶”ê°€
strategy.add_trading_data("005930", InstitutionalData(
    date="2024-01-15",
    foreign_net_buy=50000,
    institutional_net_buy=30000
))

# ë§¤ìˆ˜ ì‹ í˜¸ í™•ì¸
is_buy, reason = strategy.check_buy_signal("005930")
if is_buy:
    print(f"ê¸°ê´€/ì™¸êµ­ì¸ ì¶”ì¢… ë§¤ìˆ˜: {reason}")
```

---

## ğŸ¨ UI/UX ìš”ì†Œ (User Interface)

### 1. í†µí•© ì„¤ì • í˜ì´ì§€ (Unified Settings Page)
**ìœ„ì¹˜**: `dashboard/templates/settings_unified.html`

**ì£¼ìš” ê¸°ëŠ¥**:
- 7ê°œ ì¹´í…Œê³ ë¦¬ íƒ­ (ì‹œìŠ¤í…œ, ë¦¬ìŠ¤í¬, ì „ëµ, AI, ë°±í…ŒìŠ¤íŒ…, API, UI)
- ì‹¤ì‹œê°„ ì €ì¥/ì ìš©/ì´ˆê¸°í™”
- ë°˜ì‘í˜• ë””ìì¸

**ì ‘ì†**: `http://localhost:5000/settings`

---

### 2. ê³ ê¸‰ ê¸°ëŠ¥ í˜ì´ì§€ (Advanced Features Page)
**ìœ„ì¹˜**: `dashboard/templates/advanced_features.html`

**ì£¼ìš” ê¸°ëŠ¥**:
- TradingView Lightweight Charts (ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸)
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì „ëµ ë¹Œë”
- FullCalendar ë§¤ë§¤ ì¼ì§€
- ë¦¬í”Œë ˆì´ ì‹œë®¬ë ˆì´ì…˜ ì»¨íŠ¸ë¡¤

**ì ‘ì†**: `http://localhost:5000/advanced-features`

---

### 3. ì›¹ í‘¸ì‹œ ì•Œë¦¼ (Web Push Notifications)
**ìœ„ì¹˜**: `dashboard/static/service-worker.js`

**ì£¼ìš” ê¸°ëŠ¥**:
- Service Worker ê¸°ë°˜ PWA
- ë°±ê·¸ë¼ìš´ë“œ ì•Œë¦¼ ìˆ˜ì‹ 
- ì•Œë¦¼ í´ë¦­ ì•¡ì…˜

---

### 4. ë‹¤í¬ ëª¨ë“œ (Dark Mode)
**ìœ„ì¹˜**: `dashboard/templates/settings_unified.html`

**ì£¼ìš” ê¸°ëŠ¥**:
- ë¼ì´íŠ¸/ë‹¤í¬ í…Œë§ˆ ì „í™˜
- ì‚¬ìš©ì ì„¤ì • ì €ì¥

---

## ğŸ“ ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥

**ìœ„ì¹˜**: `database/models.py`

### ìƒˆë¡œìš´ í…Œì´ë¸”:
1. **BacktestResult**: ë°±í…ŒìŠ¤íŒ… ê²°ê³¼ ì €ì¥
2. **OptimizationResult**: íŒŒë¼ë¯¸í„° ìµœì í™” ê²°ê³¼
3. **Alert**: ì•Œë¦¼ ì´ë ¥
4. **StrategyPerformance**: ì „ëµ ì„±ê³¼ ì¶”ì 
5. **AnomalyLog**: ì´ìƒ ê°ì§€ ë¡œê·¸
6. **MarketRegime**: ì‹œì¥ ë ˆì§ ì´ë ¥

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
pip install -r requirements.txt
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
```python
from database import init_database
init_database()
```

### 3. ì„¤ì • íŒŒì¼ ìƒì„±
```bash
# config/settings.yaml ìë™ ìƒì„±ë¨
python -c "from config import get_unified_settings; get_unified_settings()"
```

### 4. ëŒ€ì‹œë³´ë“œ ì‹¤í–‰
```bash
python dashboard/app_apple.py
```

### 5. REST API ì„œë²„ ì‹¤í–‰ (ì„ íƒ)
```bash
cd api_server
uvicorn main:app --reload --port 8000
```

---

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- **API ë¬¸ì„œ**: http://localhost:8000/docs (FastAPI Swagger)
- **ëŒ€ì‹œë³´ë“œ**: http://localhost:5000
- **ì„¤ì • í˜ì´ì§€**: http://localhost:5000/settings
- **ê³ ê¸‰ ê¸°ëŠ¥**: http://localhost:5000/advanced-features

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### Q: Optunaê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ì˜¤ë¥˜
```bash
pip install optuna
```

### Q: TradingView ì°¨íŠ¸ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ
- ì¸í„°ë„· ì—°ê²° í™•ì¸ (CDN ì‚¬ìš©)
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì—ëŸ¬ í™•ì¸

### Q: Service Worker ë“±ë¡ ì‹¤íŒ¨
- HTTPS í™˜ê²½ í•„ìš” (ë¡œì»¬ì€ localhost ì˜ˆì™¸)
- ë¸Œë¼ìš°ì €ê°€ Service Workerë¥¼ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

MIT License

---

**AutoTrade Pro v4.0** - Professional Automated Trading System
